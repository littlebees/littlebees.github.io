<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>The Seasoned Schemer讀後筆記 | 記事本</title>
<meta name=keywords content="Lisp"><meta name=description content="前言 The Seasoned Schemer(TSS)的目的是補完TLS中沒有提及的狀態。 這篇筆記同樣不依照章節順序，用主題式的方式，把我心中的這本書呈現出來。
行前須知 知道什麼是?
Scheme 遞迴 accumulator parameter reverse 如果要反轉list，在有append情況下可以寫成
(define (rev l) (if (null? l) '() (append (rev (cdr l)) (cons (car l) '())))) 但我們需要一直append嗎? 如果我們可以從第一個開始就先cons出來的東西，不就是我們要的。
(define (rev l acc) (if (null? l) acc (rev (cdr l) (cons (car l) acc)))) 引入acc可以記下我們從頭到目前看過的東西。
flatten 同樣在要攤平list時，如果有append可寫成
(define (atom? x) (and (not (pair? x)) (not (null? x)))) (define (fl lol) (cond [(null? lol) '()] [(atom? (car lol)) (cons (car lol) (fl (cdr lol)))] [else (append (fl (car lol)) (fl (cdr lol)))])) 這裡是不是可以利用剛剛acc可以記下目前看過的東西的特性來改寫呢?"><meta name=author content="zhengcf"><link rel=canonical href=https://littlebees.github.io/2020/04/the-seasoned-schemer%E8%AE%80%E5%BE%8C%E7%AD%86%E8%A8%98/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://littlebees.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://littlebees.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://littlebees.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://littlebees.github.io/apple-touch-icon.png><link rel=mask-icon href=https://littlebees.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://littlebees.github.io/2020/04/the-seasoned-schemer%E8%AE%80%E5%BE%8C%E7%AD%86%E8%A8%98/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="The Seasoned Schemer讀後筆記"><meta property="og:description" content="前言 The Seasoned Schemer(TSS)的目的是補完TLS中沒有提及的狀態。 這篇筆記同樣不依照章節順序，用主題式的方式，把我心中的這本書呈現出來。
行前須知 知道什麼是?
Scheme 遞迴 accumulator parameter reverse 如果要反轉list，在有append情況下可以寫成
(define (rev l) (if (null? l) '() (append (rev (cdr l)) (cons (car l) '())))) 但我們需要一直append嗎? 如果我們可以從第一個開始就先cons出來的東西，不就是我們要的。
(define (rev l acc) (if (null? l) acc (rev (cdr l) (cons (car l) acc)))) 引入acc可以記下我們從頭到目前看過的東西。
flatten 同樣在要攤平list時，如果有append可寫成
(define (atom? x) (and (not (pair? x)) (not (null? x)))) (define (fl lol) (cond [(null? lol) '()] [(atom? (car lol)) (cons (car lol) (fl (cdr lol)))] [else (append (fl (car lol)) (fl (cdr lol)))])) 這裡是不是可以利用剛剛acc可以記下目前看過的東西的特性來改寫呢?"><meta property="og:type" content="article"><meta property="og:url" content="https://littlebees.github.io/2020/04/the-seasoned-schemer%E8%AE%80%E5%BE%8C%E7%AD%86%E8%A8%98/"><meta property="og:image" content="https://littlebees.github.io/images/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-15T23:58:57+00:00"><meta property="article:modified_time" content="2020-04-15T23:58:57+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://littlebees.github.io/images/papermod-cover.png"><meta name=twitter:title content="The Seasoned Schemer讀後筆記"><meta name=twitter:description content="前言 The Seasoned Schemer(TSS)的目的是補完TLS中沒有提及的狀態。 這篇筆記同樣不依照章節順序，用主題式的方式，把我心中的這本書呈現出來。
行前須知 知道什麼是?
Scheme 遞迴 accumulator parameter reverse 如果要反轉list，在有append情況下可以寫成
(define (rev l) (if (null? l) '() (append (rev (cdr l)) (cons (car l) '())))) 但我們需要一直append嗎? 如果我們可以從第一個開始就先cons出來的東西，不就是我們要的。
(define (rev l acc) (if (null? l) acc (rev (cdr l) (cons (car l) acc)))) 引入acc可以記下我們從頭到目前看過的東西。
flatten 同樣在要攤平list時，如果有append可寫成
(define (atom? x) (and (not (pair? x)) (not (null? x)))) (define (fl lol) (cond [(null? lol) '()] [(atom? (car lol)) (cons (car lol) (fl (cdr lol)))] [else (append (fl (car lol)) (fl (cdr lol)))])) 這裡是不是可以利用剛剛acc可以記下目前看過的東西的特性來改寫呢?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://littlebees.github.io/posts/"},{"@type":"ListItem","position":2,"name":"The Seasoned Schemer讀後筆記","item":"https://littlebees.github.io/2020/04/the-seasoned-schemer%E8%AE%80%E5%BE%8C%E7%AD%86%E8%A8%98/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The Seasoned Schemer讀後筆記","name":"The Seasoned Schemer讀後筆記","description":"前言 The Seasoned Schemer(TSS)的目的是補完TLS中沒有提及的狀態。 這篇筆記同樣不依照章節順序，用主題式的方式，把我心中的這本書呈現出來。\n行前須知 知道什麼是?\nScheme 遞迴 accumulator parameter reverse 如果要反轉list，在有append情況下可以寫成\n(define (rev l) (if (null? l) \u0026#39;() (append (rev (cdr l)) (cons (car l) \u0026#39;())))) 但我們需要一直append嗎? 如果我們可以從第一個開始就先cons出來的東西，不就是我們要的。\n(define (rev l acc) (if (null? l) acc (rev (cdr l) (cons (car l) acc)))) 引入acc可以記下我們從頭到目前看過的東西。\nflatten 同樣在要攤平list時，如果有append可寫成\n(define (atom? x) (and (not (pair? x)) (not (null? x)))) (define (fl lol) (cond [(null? lol) \u0026#39;()] [(atom? (car lol)) (cons (car lol) (fl (cdr lol)))] [else (append (fl (car lol)) (fl (cdr lol)))])) 這裡是不是可以利用剛剛acc可以記下目前看過的東西的特性來改寫呢?","keywords":["Lisp"],"articleBody":"前言 The Seasoned Schemer(TSS)的目的是補完TLS中沒有提及的狀態。 這篇筆記同樣不依照章節順序，用主題式的方式，把我心中的這本書呈現出來。\n行前須知 知道什麼是?\nScheme 遞迴 accumulator parameter reverse 如果要反轉list，在有append情況下可以寫成\n(define (rev l) (if (null? l) '() (append (rev (cdr l)) (cons (car l) '())))) 但我們需要一直append嗎? 如果我們可以從第一個開始就先cons出來的東西，不就是我們要的。\n(define (rev l acc) (if (null? l) acc (rev (cdr l) (cons (car l) acc)))) 引入acc可以記下我們從頭到目前看過的東西。\nflatten 同樣在要攤平list時，如果有append可寫成\n(define (atom? x) (and (not (pair? x)) (not (null? x)))) (define (fl lol) (cond [(null? lol) '()] [(atom? (car lol)) (cons (car lol) (fl (cdr lol)))] [else (append (fl (car lol)) (fl (cdr lol)))])) 這裡是不是可以利用剛剛acc可以記下目前看過的東西的特性來改寫呢?\n(define (flat lol acc) (cond [(null? lol) acc] [(atom? (car lol)) (flat (cdr lol) (cons (car lol) acc))] [else (flat (cdr lol) (flat (car lol) acc))])) ;;先走car，再走cdr 但是這樣出來的是反的，要記得反轉。\nlet \u0026 letrec 從TLS到現在引入變數不是用define(全域)，不然就是lambda(區域) 如果想引入區域變數，就要用lambda，且apply值，不過這樣寫起來還蠻難看的。 所以有let\n(let ((a 10)) (+ a 10)) \u003c=\u003e ((lambda (a) (+ a 10)) 10) 但這樣無法遞迴，如果要遞迴就是用Y組合子，不然就是letrec\n(letrec ((len (lambda (l) (if (null? l) 0 (+ 1 (len (cdr l))))))) len) \u003c=\u003e (define len (lambda (l) (if (null? l) 0 (+ 1 (len (cdr l)))))) let over lambda 如果把let包在lambda外面會變成像\n(let ((a ...)) (lambda (...) ...)) 這樣會變成只有這個lambda看的到a，可以用這個手法保護變數。 還可以搭配set!做出getter與setter，十分OO。\nset! 一般常見的程式語言中都有改寫變數值的方法。 Scheme也有叫set!\n(define a 10) ;; a is 10 (set! a 20) ;; a is 20 原本在同一個scope中的變數的資料都是不會變的，現在就被打破了!!\n我們必須意識到與自行安排與管理狀態與時間。\n原本用lambda可以做出List的效果\n(define ((kons a d) f) (f a d)) (define (kar c) (c (lambda (a d) a))) (define (kdr c) (c (lambda (a d) d))) 但現在把set!做到List中，我們只需要set-kdr!\n(define (bons a) (let ((d '())) (lambda (f) (f (lambda (x) (set! d x)) a d)))) (define (kar c) (c (lambda (s a d) a))) (define (kdr c) (c (lambda (s a d) d))) (define (set-kdr! c x) ((c (lambda (s a d) s)) x)) (define (kons a d) (let ((c (bons a))) (set-kdr! c d) c)) 有了set-kdr!就可以做出cycle， 要怎麼找出cycle?\n首先要找出兩個變數是不是一樣，沒有set!之前，只要值相等，這兩個變數就是一樣的． 但有了set!就不一樣了，所謂的一樣應該是來自同一個地方才對． 所以相等的也不等於一樣了，如果一樣，set!後應該會同時改變才對．\n(define (same? a b) (let ((t1 (kdr a)) (t2 (kdr b))) (set-kdr a 1) (set-kdr b 2) (let ((ans (= (kdr a) (kdr b)))) (set-kdr a t1) (set-kdr b t2) ans))) (define (same? a b) (let ((t1 (cdr a)) (t2 (cdr b))) (set-cdr! a 1) (set-cdr! b 2) (let ((ans (= (cdr a) (cdr b)))) (set-cdr! a t1) (set-cdr! b t2) ans))) 如果兩個速度不同的人在cycle中走，那速度快的一定會碰到速度慢的． 所以讓兩個變數往前走，但速度不同就好，而龜兔賽跑演算法速度給(1,2)．\n(define (finite-len p) (letcc out (letrec ((C (lambda (p q) (cond ((same? p q) (out ‘oops)) ((null? q) 0) ((null? (kdr q)) 1) (else (+ (C (kddr p) (kdr q)) 2))) (kddr (lambda (x) (kdr (kdr x)))))) (if (null? p) 0 (add1 (C p (kdr p))))))) (define (finite-len l) (call-with-current-continuation (lambda (oops) (define (F a b) (cond ((null? b) 0) ((same? a b) (oops 'no)) (else (+ 1 (F (cdr a) (cddr b)))))) (cond ((null? l) 0) ((null? (cdr l)) 1) (else (+ 1 (F l (cdr l)))))))) (0,1) - (+2,+1) -\u003e (2,2)\nletrec \u0026 let \u0026 set! 為什麼let引入的變數沒辦法遞迴?\n因為在lambda中其實看不到遞迴的那個變數。 所以在Y組合子的遞迴函數那邊才會多一個接收另一個函數的參數。\n那多了set!的現在，能不能簡單的完成遞迴?(在沒有define的狀態下)\n先引入遞迴函數的名字(let)，再用看的到該名字的lambda改寫變數(set!)\n(let ((len 'whatever)) (set! len (lambda (l) (if (null? l) 0 (+ 1 (len (cdr l)))))) len) \u003c=\u003e (define len (lambda (l) (if (null? l) 0 (+ 1 (len (cdr l)))))) \u003c=\u003e (letrec ((len (lambda (l) (if (null? l) 0 (+ 1 (len (cdr l))))))) len) Y! 有了set!可以有新的遞迴產生方法，那能不能有新的Y組合子? 從len開始看。\n(define len (lambda (l) (if (null? l) 0 (+ 1 (len (cdr l)))))) 用剛剛的方式改寫\n(define len (let ((len2 'whatever)) (set! len2 (lambda (l) (if (null? l) 0 (+ 1 (len2 (cdr l)))))) ;; !! len2)) lambda與len2綁在一起，我們必須要抽出來\n(define len (let ((len2 'whatever)) (set! len2 (lambda (f) ;; !! (lambda (l) (if (null? l) 0 (+ 1 (f (cdr l)))))) ;; !! len2)) f必須是個可以碰到len2的函數，來把參數丟進去。\n(define len (let ((len2 'whatever)) (set! len2 ((lambda (f) (lambda (l) (if (null? l) 0 (+ 1 (f (cdr l)))))) (lambda (arg) (len2 arg))) len2)) 熟悉的東西出來了，抽出來。\n(define lenMK (lambda (f) (lambda (l) (if (null? l) 0 (+ 1 (f (cdr l))))))) (define (Y! mk) (let ((len2 'whatever)) (set! len2 (mk (lambda (arg) (len2 arg))) len2))) (define len (Y! lenMK)) continuation continuation可以想像成代辦事項或是Program conuter，也許會比較好想像一點。 如果改變continuation的內容，可以讓原本的程式跑去做別的事，一去不復返，或是再回來同一個地方。\ncontinuation可以當成C語言中的label，調用continuation就是用jump。 但與label不同的是這是可以存在變數的label!!\nescape from here 連乘List中的數字\n(define (fac l) (if (null? l) 1 (* (car l) (fac (cdr l))))) 不過如果中間有0的話應該不用繼續做下去，要直接跳出去。 那我們應該可以用continuation來跳出去，只要continuation在程式的外面就ok了\n(define call/cc call-with-current-continuation) (define (fac l) (call/cc (lambda (escape) (define (fac2 l) (cond [(null? l) 1] [(zero? (car l)) (escape 0)] [else (* (car l) (fac2 (cdr l)))])) (fac2 l)))) 一旦調用了escape整個call/cc的回傳值會變成傳入escape中的資料。 如果沒有用到escape call/cc的部分就像不存在一樣。\ngo back to here (define return 0) (define resume 0) (define (walk* lol) (cond ((null? lol) 'empty) ((atom? (car lol)) (call/cc (lambda (here) (set! resume here) (return (car lol)))) (walk* (cdr lol))) (else (walk* (car lol)) (walk* (cdr lol))))) (define (get-next) (call/cc (lambda (here) (set! return here) (resume 'whatever)))) (define (loop old) (if (eq? old 'nothing) #f (let ((secend-one (get-next))) (if (eq? secend-one old) #t (loop secend-one))))) (define (two* lol) (let ((first-one (call/cc (lambda (here) (set! return here) (walk* lol) (return 'nothing))))) (loop first-one))) iteraor \u0026 set! \u0026 define define 可以當成lambda引入新的變數(參數)\nset! 視為partial apply 來自define的參數\n;; [LISTOF X] -\u003e ( -\u003e X u 'you-fell-off-the-end) (define (generate-one-element-at-a-time lst) ;; Hand the next item from a-list to \"return\" or an end-of-list marker (define (control-state return) (for-each (lambda (element) (set! return (call-with-current-continuation (lambda (resume-here) ;; Grab the current continuation (set! control-state resume-here) (return element))))) lst) (return 'you-fell-off-the-end)) ;; (-\u003e X u 'you-fell-off-the-end) ;; This is the actual generator, producing one item from a-list at a time (define (generator) (call-with-current-continuation control-state)) ;; Return the generator generator) (define generate-digit (generate-one-element-at-a-time '(0 1 2))) 陰陽謎題 (define (now) (call-with-current-continuation (lambda (c) c))) (let* ((yin (let ((cc (now))) (display #\\@) cc)) (yang (let ((cc (now))) (display #\\*) cc))) (yin yang)) 一開始會印出@*\n再來會跳回去yin的call/cc，所以此時的yin是上一次的yang(第一個)，所以新出現的yang(第二個)會apply到第一個yang去，所以會再多印一個*，所以總共印@**\n在這裏第二個yang透過原本的yin跳回去印@，再產生第三個yang再印一個*，如此重複\n在每一次的循環中產生新的yang，所以經過每一次的循環都會多一個*\n略過的部分 直譯器 直譯器等到以後打EoPL與LiSP的心得再說。 ","wordCount":"882","inLanguage":"en","image":"https://littlebees.github.io/images/papermod-cover.png","datePublished":"2020-04-15T23:58:57Z","dateModified":"2020-04-15T23:58:57Z","author":{"@type":"Person","name":"zhengcf"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://littlebees.github.io/2020/04/the-seasoned-schemer%E8%AE%80%E5%BE%8C%E7%AD%86%E8%A8%98/"},"publisher":{"@type":"Organization","name":"記事本","logo":{"@type":"ImageObject","url":"https://littlebees.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://littlebees.github.io/ accesskey=h title="記事本 (Alt + H)">記事本</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://littlebees.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://littlebees.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://littlebees.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://littlebees.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://littlebees.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">The Seasoned Schemer讀後筆記</h1><div class=post-meta><span title='2020-04-15 23:58:57 +0000 UTC'>April 15, 2020</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;zhengcf</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=前言>前言</a></li><li><a href=#%e8%a1%8c%e5%89%8d%e9%a0%88%e7%9f%a5 aria-label=行前須知>行前須知</a></li><li><a href=#accumulator-parameter aria-label="accumulator parameter">accumulator parameter</a><ul><li><a href=#reverse aria-label=reverse>reverse</a></li><li><a href=#flatten aria-label=flatten>flatten</a></li></ul></li><li><a href=#let--letrec aria-label="let & letrec">let & letrec</a></li><li><a href=#let-over-lambda aria-label="let over lambda">let over lambda</a></li><li><a href=#set aria-label=set!>set!</a><ul><li><a href=#letrec--let--set aria-label="letrec & let & set!">letrec & let & set!</a></li></ul></li><li><a href=#y aria-label=Y!>Y!</a></li><li><a href=#continuation aria-label=continuation>continuation</a><ul><li><a href=#escape-from-here aria-label="escape from here">escape from here</a></li><li><a href=#go-back-to-here aria-label="go back to here">go back to here</a></li><li><a href=#iteraor--set--define aria-label="iteraor & set! & define">iteraor & set! & define</a></li><li><a href=#%e9%99%b0%e9%99%bd%e8%ac%8e%e9%a1%8c aria-label=陰陽謎題>陰陽謎題</a></li></ul></li><li><a href=#%e7%95%a5%e9%81%8e%e7%9a%84%e9%83%a8%e5%88%86 aria-label=略過的部分>略過的部分</a></li></ul></div></details></div><div class=post-content><h2 id=前言>前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h2><p>The Seasoned Schemer(TSS)的目的是補完TLS中沒有提及的狀態。
這篇筆記同樣不依照章節順序，用主題式的方式，把我心中的這本書呈現出來。</p><h2 id=行前須知>行前須知<a hidden class=anchor aria-hidden=true href=#行前須知>#</a></h2><p>知道什麼是?</p><ul><li>Scheme</li><li>遞迴</li></ul><h2 id=accumulator-parameter>accumulator parameter<a hidden class=anchor aria-hidden=true href=#accumulator-parameter>#</a></h2><h3 id=reverse>reverse<a hidden class=anchor aria-hidden=true href=#reverse>#</a></h3><p>如果要反轉list，在有<code>append</code>情況下可以寫成</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>rev</span> <span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>&#39;</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nb>append </span><span class=p>(</span><span class=nf>rev</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))</span> <span class=p>(</span><span class=nb>cons </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=o>&#39;</span><span class=p>()))))</span>
</span></span></code></pre></div><p>但我們需要一直<code>append</code>嗎?
如果我們可以從第一個開始就先<code>cons</code>出來的東西，不就是我們要的。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>rev</span> <span class=nv>l</span> <span class=nv>acc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>acc</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>rev</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)</span> <span class=p>(</span><span class=nb>cons </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=nv>acc</span><span class=p>))))</span>
</span></span></code></pre></div><p>引入<code>acc</code>可以記下我們從頭到目前看過的東西。</p><h3 id=flatten>flatten<a hidden class=anchor aria-hidden=true href=#flatten>#</a></h3><p>同樣在要攤平list時，如果有<code>append</code>可寫成</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>atom?</span> <span class=nv>x</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>and </span><span class=p>(</span><span class=nb>not </span><span class=p>(</span><span class=nb>pair? </span><span class=nv>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl>       <span class=p>(</span><span class=nb>not </span><span class=p>(</span><span class=nb>null? </span><span class=nv>x</span><span class=p>))))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>fl</span> <span class=nv>lol</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=nb>null? </span><span class=nv>lol</span><span class=p>)</span> <span class=o>&#39;</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>lol</span><span class=p>))</span> <span class=p>(</span><span class=nb>cons </span><span class=p>(</span><span class=nb>car </span><span class=nv>lol</span><span class=p>)</span> <span class=p>(</span><span class=nf>fl</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>lol</span><span class=p>)))]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=k>else </span><span class=p>(</span><span class=nb>append </span><span class=p>(</span><span class=nf>fl</span> <span class=p>(</span><span class=nb>car </span><span class=nv>lol</span><span class=p>))</span> <span class=p>(</span><span class=nf>fl</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>lol</span><span class=p>)))]))</span>
</span></span></code></pre></div><p>這裡是不是可以利用剛剛<code>acc</code>可以記下目前看過的東西的特性來改寫呢?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>flat</span> <span class=nv>lol</span> <span class=nv>acc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=nb>null? </span><span class=nv>lol</span><span class=p>)</span> <span class=nv>acc</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>lol</span><span class=p>))</span> <span class=p>(</span><span class=nf>flat</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>lol</span><span class=p>)</span> <span class=p>(</span><span class=nb>cons </span><span class=p>(</span><span class=nb>car </span><span class=nv>lol</span><span class=p>)</span> <span class=nv>acc</span><span class=p>))]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=k>else </span><span class=p>(</span><span class=nf>flat</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>lol</span><span class=p>)</span> <span class=p>(</span><span class=nf>flat</span> <span class=p>(</span><span class=nb>car </span><span class=nv>lol</span><span class=p>)</span> <span class=nv>acc</span><span class=p>))]))</span> <span class=c1>;;先走car，再走cdr</span>
</span></span></code></pre></div><p>但是這樣出來的是反的，要記得反轉。</p><h2 id=let--letrec>let & letrec<a hidden class=anchor aria-hidden=true href=#let--letrec>#</a></h2><p>從TLS到現在引入變數不是用<code>define</code>(全域)，不然就是<code>lambda</code>(區域)
如果想引入區域變數，就要用<code>lambda</code>，且apply值，不過這樣寫起來還蠻難看的。
所以有<code>let</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>a</span> <span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>+ </span><span class=nv>a</span> <span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nv>&lt;=&gt;</span>
</span></span><span class=line><span class=cl><span class=p>((</span><span class=k>lambda </span><span class=p>(</span><span class=nf>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>+ </span><span class=nv>a</span> <span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl> <span class=mi>10</span><span class=p>)</span>
</span></span></code></pre></div><p>但這樣無法遞迴，如果要遞迴就是用Y組合子，不然就是<code>letrec</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>letrec </span><span class=p>((</span><span class=nf>len</span> <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                      <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                          <span class=mi>0</span>
</span></span><span class=line><span class=cl>                          <span class=p>(</span><span class=nb>+ </span><span class=mi>1</span> <span class=p>(</span><span class=nf>len</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)))))))</span>
</span></span><span class=line><span class=cl>          <span class=nv>len</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>&lt;=&gt;</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>len</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>+ </span><span class=mi>1</span> <span class=p>(</span><span class=nf>len</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))</span>
</span></span></code></pre></div><h2 id=let-over-lambda>let over lambda<a hidden class=anchor aria-hidden=true href=#let-over-lambda>#</a></h2><p>如果把let包在lambda外面會變成像</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>a</span> <span class=o>...</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span><span class=p>))</span>
</span></span></code></pre></div><p>這樣會變成只有這個<code>lambda</code>看的到<code>a</code>，可以用這個手法保護變數。
還可以搭配<code>set!</code>做出getter與setter，十分OO。</p><h2 id=set>set!<a hidden class=anchor aria-hidden=true href=#set>#</a></h2><p>一般常見的程式語言中都有改寫變數值的方法。
Scheme也有叫<code>set!</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>a</span> <span class=mi>10</span><span class=p>)</span> <span class=c1>;; a is 10</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>set! </span><span class=nv>a</span> <span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>;; a is 20</span>
</span></span></code></pre></div><p>原本在同一個scope中的變數的資料都是不會變的，現在就被打破了!!</p><p><strong>我們必須意識到與自行安排與管理狀態與時間。</strong></p><p>原本用<code>lambda</code>可以做出List的效果</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>((</span><span class=nf>kons</span> <span class=nv>a</span> <span class=nv>d</span><span class=p>)</span> <span class=nv>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>f</span> <span class=nv>a</span> <span class=nv>d</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>kar</span> <span class=nv>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>c</span> <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>a</span> <span class=nv>d</span><span class=p>)</span> <span class=nv>a</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>kdr</span> <span class=nv>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>c</span> <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>a</span> <span class=nv>d</span><span class=p>)</span> <span class=nv>d</span><span class=p>)))</span>
</span></span></code></pre></div><p>但現在把<code>set!</code>做到List中，我們只需要<code>set-kdr!</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>bons</span> <span class=nv>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>d</span> <span class=o>&#39;</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=p>(</span><span class=nf>f</span> <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>x</span><span class=p>)</span> <span class=p>(</span><span class=k>set! </span><span class=nv>d</span> <span class=nv>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl>              <span class=nv>a</span> <span class=nv>d</span><span class=p>))))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>kar</span> <span class=nv>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>c</span> <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>s</span> <span class=nv>a</span> <span class=nv>d</span><span class=p>)</span> <span class=nv>a</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>kdr</span> <span class=nv>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>c</span> <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>s</span> <span class=nv>a</span> <span class=nv>d</span><span class=p>)</span> <span class=nv>d</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>set-kdr!</span> <span class=nv>c</span> <span class=nv>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>((</span><span class=nf>c</span> <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>s</span> <span class=nv>a</span> <span class=nv>d</span><span class=p>)</span> <span class=nv>s</span><span class=p>))</span> <span class=nv>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>kons</span> <span class=nv>a</span> <span class=nv>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>c</span> <span class=p>(</span><span class=nf>bons</span> <span class=nv>a</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nf>set-kdr!</span> <span class=nv>c</span> <span class=nv>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nv>c</span><span class=p>))</span>
</span></span></code></pre></div><p>有了<code>set-kdr!</code>就可以做出cycle，
要怎麼找出cycle?</p><p>首先要找出兩個變數是不是一樣，沒有<code>set!</code>之前，只要值相等，這兩個變數就是一樣的．
但有了<code>set!</code>就不一樣了，所謂的一樣應該是來自同一個地方才對．
所以相等的也不等於一樣了，如果一樣，<code>set!</code>後應該會同時改變才對．</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>same?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>t1</span> <span class=p>(</span><span class=nf>kdr</span> <span class=nv>a</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=nf>t2</span> <span class=p>(</span><span class=nf>kdr</span> <span class=nv>b</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>       <span class=p>(</span><span class=nf>set-kdr</span> <span class=nv>a</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>(</span><span class=nf>set-kdr</span> <span class=nv>b</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>ans</span> <span class=p>(</span><span class=nb>= </span><span class=p>(</span><span class=nf>kdr</span> <span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nf>kdr</span> <span class=nv>b</span><span class=p>))))</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nf>set-kdr</span> <span class=nv>a</span> <span class=nv>t1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nf>set-kdr</span> <span class=nv>b</span> <span class=nv>t2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nv>ans</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>same?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>t1</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>a</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=nf>t2</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>b</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>       <span class=p>(</span><span class=nb>set-cdr! </span><span class=nv>a</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>(</span><span class=nb>set-cdr! </span><span class=nv>b</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>ans</span> <span class=p>(</span><span class=nb>= </span><span class=p>(</span><span class=nb>cdr </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>b</span><span class=p>))))</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>set-cdr! </span><span class=nv>a</span> <span class=nv>t1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>set-cdr! </span><span class=nv>b</span> <span class=nv>t2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nv>ans</span><span class=p>)))</span>
</span></span></code></pre></div><p>如果兩個速度不同的人在cycle中走，那速度快的一定會碰到速度慢的．
所以讓兩個變數往前走，但速度不同就好，而龜兔賽跑演算法速度給(1,2)．</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>finite-len</span> <span class=nv>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>letcc</span> <span class=nv>out</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=k>letrec </span><span class=p>((</span><span class=nf>C</span> <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>p</span> <span class=nv>q</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                      <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>                        <span class=p>((</span><span class=nf>same?</span> <span class=nv>p</span> <span class=nv>q</span><span class=p>)</span> <span class=p>(</span><span class=nf>out</span> <span class=err>‘</span><span class=nv>oops</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                        <span class=p>((</span><span class=nb>null? </span><span class=nv>q</span><span class=p>)</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>((</span><span class=nb>null? </span><span class=p>(</span><span class=nf>kdr</span> <span class=nv>q</span><span class=p>))</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=k>else </span><span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nf>C</span> <span class=p>(</span><span class=nf>kddr</span> <span class=nv>p</span><span class=p>)</span> <span class=p>(</span><span class=nf>kdr</span> <span class=nv>q</span><span class=p>))</span> <span class=mi>2</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>                 <span class=p>(</span><span class=nf>kddr</span> <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>x</span><span class=p>)</span> <span class=p>(</span><span class=nf>kdr</span> <span class=p>(</span><span class=nf>kdr</span> <span class=nv>x</span><span class=p>))))))</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nf>add1</span> <span class=p>(</span><span class=nf>C</span> <span class=nv>p</span> <span class=p>(</span><span class=nf>kdr</span> <span class=nv>p</span><span class=p>)))))))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>finite-len</span> <span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>call-with-current-continuation</span>
</span></span><span class=line><span class=cl>   <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>oops</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>F</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>         <span class=p>((</span><span class=nb>null? </span><span class=nv>b</span><span class=p>)</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>         <span class=p>((</span><span class=nf>same?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)</span> <span class=p>(</span><span class=nf>oops</span> <span class=ss>&#39;no</span><span class=p>))</span>
</span></span><span class=line><span class=cl>         <span class=p>(</span><span class=nf>else</span>
</span></span><span class=line><span class=cl>          <span class=p>(</span><span class=nb>+ </span><span class=mi>1</span> <span class=p>(</span><span class=nf>F</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>cddr </span><span class=nv>b</span><span class=p>))))))</span>
</span></span><span class=line><span class=cl>     <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>       <span class=p>((</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>((</span><span class=nb>null? </span><span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>(</span><span class=nf>else</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>+ </span><span class=mi>1</span> <span class=p>(</span><span class=nf>F</span> <span class=nv>l</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))))</span>
</span></span></code></pre></div><p>(0,1) - (+2,+1) -> (2,2)</p><h3 id=letrec--let--set>letrec & let & set!<a hidden class=anchor aria-hidden=true href=#letrec--let--set>#</a></h3><p>為什麼<code>let</code>引入的變數沒辦法遞迴?</p><p>因為在<code>lambda</code>中其實看不到遞迴的那個變數。
所以在Y組合子的遞迴函數那邊才會多一個接收另一個函數的參數。</p><p>那多了<code>set!</code>的現在，能不能簡單的完成遞迴?(在沒有<code>define</code>的狀態下)</p><p>先引入遞迴函數的名字(<code>let</code>)，再用看的到該名字的<code>lambda</code>改寫變數(<code>set!</code>)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>len</span> <span class=ss>&#39;whatever</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>set! </span><span class=nv>len</span> <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=mi>0</span>
</span></span><span class=line><span class=cl>                        <span class=p>(</span><span class=nb>+ </span><span class=mi>1</span> <span class=p>(</span><span class=nf>len</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))</span>
</span></span><span class=line><span class=cl>  <span class=nv>len</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>&lt;=&gt;</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>len</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>+ </span><span class=mi>1</span> <span class=p>(</span><span class=nf>len</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))</span>
</span></span><span class=line><span class=cl><span class=nv>&lt;=&gt;</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>letrec </span><span class=p>((</span><span class=nf>len</span> <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                      <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                          <span class=mi>0</span>
</span></span><span class=line><span class=cl>                          <span class=p>(</span><span class=nb>+ </span><span class=mi>1</span> <span class=p>(</span><span class=nf>len</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)))))))</span>
</span></span><span class=line><span class=cl>          <span class=nv>len</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=y>Y!<a hidden class=anchor aria-hidden=true href=#y>#</a></h2><p>有了<code>set!</code>可以有新的遞迴產生方法，那能不能有新的Y組合子?
從<code>len</code>開始看。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>len</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>+ </span><span class=mi>1</span> <span class=p>(</span><span class=nf>len</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))</span>
</span></span></code></pre></div><p>用剛剛的方式改寫</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>len</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>len2</span> <span class=ss>&#39;whatever</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>set! </span><span class=nv>len2</span> <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                      <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                          <span class=mi>0</span>
</span></span><span class=line><span class=cl>                          <span class=p>(</span><span class=nb>+ </span><span class=mi>1</span> <span class=p>(</span><span class=nf>len2</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))</span> <span class=c1>;; !!</span>
</span></span><span class=line><span class=cl>    <span class=nv>len2</span><span class=p>))</span>
</span></span></code></pre></div><p><code>lambda</code>與len2綁在一起，我們必須要抽出來</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>len</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>len2</span> <span class=ss>&#39;whatever</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>set! </span><span class=nv>len2</span> <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>f</span><span class=p>)</span> <span class=c1>;; !!</span>
</span></span><span class=line><span class=cl>                  <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                      <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                          <span class=mi>0</span>
</span></span><span class=line><span class=cl>                          <span class=p>(</span><span class=nb>+ </span><span class=mi>1</span> <span class=p>(</span><span class=nf>f</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))</span> <span class=c1>;; !!</span>
</span></span><span class=line><span class=cl>    <span class=nv>len2</span><span class=p>))</span>
</span></span></code></pre></div><p><code>f</code>必須是個可以碰到<code>len2</code>的函數，來把參數丟進去。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>len</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>len2</span> <span class=ss>&#39;whatever</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>set! </span><span class=nv>len2</span> <span class=p>((</span><span class=k>lambda </span><span class=p>(</span><span class=nf>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                  <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                      <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                          <span class=mi>0</span>
</span></span><span class=line><span class=cl>                          <span class=p>(</span><span class=nb>+ </span><span class=mi>1</span> <span class=p>(</span><span class=nf>f</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>arg</span><span class=p>)</span> <span class=p>(</span><span class=nf>len2</span> <span class=nv>arg</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=nv>len2</span><span class=p>))</span>
</span></span></code></pre></div><p>熟悉的東西出來了，抽出來。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>lenMK</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=mi>0</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=nb>+ </span><span class=mi>1</span> <span class=p>(</span><span class=nf>f</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)))))))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>Y!</span> <span class=nv>mk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>len2</span> <span class=ss>&#39;whatever</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>set! </span><span class=nv>len2</span> <span class=p>(</span><span class=nf>mk</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>arg</span><span class=p>)</span> <span class=p>(</span><span class=nf>len2</span> <span class=nv>arg</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=nv>len2</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>len</span> <span class=p>(</span><span class=nf>Y!</span> <span class=nv>lenMK</span><span class=p>))</span>
</span></span></code></pre></div><h2 id=continuation>continuation<a hidden class=anchor aria-hidden=true href=#continuation>#</a></h2><blockquote><p>continuation可以想像成代辦事項或是Program conuter，也許會比較好想像一點。
如果改變continuation的內容，可以讓原本的程式跑去做別的事，一去不復返，或是再回來同一個地方。</p></blockquote><p>continuation可以當成C語言中的label，調用continuation就是用jump。
但與label不同的是這是可以存在變數的label!!</p><h3 id=escape-from-here>escape from here<a hidden class=anchor aria-hidden=true href=#escape-from-here>#</a></h3><p>連乘List中的數字</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>fac</span> <span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=mi>1</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nb>* </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>(</span><span class=nf>fac</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)))))</span>
</span></span></code></pre></div><p>不過如果中間有0的話應該不用繼續做下去，要直接跳出去。
那我們應該可以用continuation來跳出去，只要continuation在程式的外面就ok了</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>call/cc</span> <span class=nv>call-with-current-continuation</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>fac</span> <span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>call/cc </span><span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>escape</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>fac2</span> <span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>        <span class=p>[(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>[(</span><span class=nb>zero? </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>))</span> <span class=p>(</span><span class=nf>escape</span> <span class=mi>0</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=k>else </span><span class=p>(</span><span class=nb>* </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>(</span><span class=nf>fac2</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)))]))</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>fac2</span> <span class=nv>l</span><span class=p>))))</span>
</span></span></code></pre></div><p>一旦調用了<code>escape</code>整個<code>call/cc</code>的回傳值會變成傳入<code>escape</code>中的資料。
如果沒有用到<code>escape</code> <code>call/cc</code>的部分就像不存在一樣。</p><h3 id=go-back-to-here>go back to here<a hidden class=anchor aria-hidden=true href=#go-back-to-here>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>return</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>resume</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>walk*</span> <span class=nv>lol</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>    <span class=p>((</span><span class=nb>null? </span><span class=nv>lol</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=ss>&#39;empty</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>((</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>lol</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nb>call/cc </span><span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>here</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=k>set! </span><span class=nv>resume</span> <span class=nv>here</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nf>return</span> <span class=p>(</span><span class=nb>car </span><span class=nv>lol</span><span class=p>))))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>walk*</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>lol</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>else</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>walk*</span> <span class=p>(</span><span class=nb>car </span><span class=nv>lol</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>walk*</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>lol</span><span class=p>)))))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>get-next</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>call/cc </span><span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>here</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>set! </span><span class=nv>return</span> <span class=nv>here</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>resume</span> <span class=ss>&#39;whatever</span><span class=p>))))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>loop</span> <span class=nv>old</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>eq? </span><span class=nv>old</span> <span class=ss>&#39;nothing</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=no>#f</span>
</span></span><span class=line><span class=cl>          <span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>secend-one</span> <span class=p>(</span><span class=nf>get-next</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>eq? </span><span class=nv>secend-one</span> <span class=nv>old</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=no>#t</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=nf>loop</span> <span class=nv>secend-one</span><span class=p>)))))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>two*</span> <span class=nv>lol</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>first-one</span>
</span></span><span class=line><span class=cl>          <span class=p>(</span><span class=nb>call/cc </span><span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>here</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=k>set! </span><span class=nv>return</span> <span class=nv>here</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=nf>walk*</span> <span class=nv>lol</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=nf>return</span> <span class=ss>&#39;nothing</span><span class=p>)))))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>loop</span> <span class=nv>first-one</span><span class=p>)))</span>
</span></span></code></pre></div><h3 id=iteraor--set--define>iteraor & set! & define<a hidden class=anchor aria-hidden=true href=#iteraor--set--define>#</a></h3><blockquote><p>define 可以當成lambda引入新的變數(參數)</p><p>set! 視為partial apply 來自define的參數</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=c1>;; [LISTOF X] -&gt; ( -&gt; X u &#39;you-fell-off-the-end)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>generate-one-element-at-a-time</span> <span class=nv>lst</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>;; Hand the next item from a-list to &#34;return&#34; or an end-of-list marker</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>control-state</span> <span class=nv>return</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nb>for-each </span>
</span></span><span class=line><span class=cl>     <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>element</span><span class=p>)</span>
</span></span><span class=line><span class=cl>               <span class=p>(</span><span class=k>set! </span><span class=nv>return</span> <span class=p>(</span><span class=nf>call-with-current-continuation</span>
</span></span><span class=line><span class=cl>                              <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>resume-here</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                <span class=c1>;; Grab the current continuation</span>
</span></span><span class=line><span class=cl>                               <span class=p>(</span><span class=k>set! </span><span class=nv>control-state</span> <span class=nv>resume-here</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                               <span class=p>(</span><span class=nf>return</span> <span class=nv>element</span><span class=p>)))))</span>
</span></span><span class=line><span class=cl>     <span class=nv>lst</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>return</span> <span class=ss>&#39;you-fell-off-the-end</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1>;; (-&gt; X u &#39;you-fell-off-the-end)</span>
</span></span><span class=line><span class=cl>  <span class=c1>;; This is the actual generator, producing one item from a-list at a time</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>generator</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nb>call-with-current-continuation </span><span class=nv>control-state</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>;; Return the generator </span>
</span></span><span class=line><span class=cl>  <span class=nv>generator</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>generate-digit</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>generate-one-element-at-a-time</span> <span class=o>&#39;</span><span class=p>(</span><span class=mi>0</span> <span class=mi>1</span> <span class=mi>2</span><span class=p>)))</span>
</span></span></code></pre></div><h3 id=陰陽謎題>陰陽謎題<a hidden class=anchor aria-hidden=true href=#陰陽謎題>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>now</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>call-with-current-continuation </span><span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>c</span><span class=p>)</span> <span class=nv>c</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>let* </span><span class=p>((</span><span class=nf>yin</span>
</span></span><span class=line><span class=cl>         <span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>cc</span> <span class=p>(</span><span class=nf>now</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>          <span class=p>(</span><span class=nb>display </span><span class=sc>#\@</span><span class=p>)</span>
</span></span><span class=line><span class=cl>          <span class=nv>cc</span><span class=p>))</span>
</span></span><span class=line><span class=cl>       <span class=p>(</span><span class=nf>yang</span>
</span></span><span class=line><span class=cl>          <span class=p>(</span><span class=k>let </span><span class=p>((</span><span class=nf>cc</span> <span class=p>(</span><span class=nf>now</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=nb>display </span><span class=sc>#\*</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nv>cc</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>yin</span> <span class=nv>yang</span><span class=p>))</span>
</span></span></code></pre></div><p>一開始會印出@*</p><p>再來會跳回去yin的call/cc，所以此時的yin是上一次的yang(第一個)，所以新出現的yang(第二個)會apply到第一個yang去，所以會再多印一個*，所以總共印@**</p><p>在這裏第二個yang透過原本的yin跳回去印@，再產生第三個yang再印一個*，如此重複</p><p>在每一次的循環中產生新的yang，所以經過每一次的循環都會多一個*</p><h2 id=略過的部分>略過的部分<a hidden class=anchor aria-hidden=true href=#略過的部分>#</a></h2><ul><li>直譯器
直譯器等到以後打EoPL與LiSP的心得再說。</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://littlebees.github.io/tags/lisp/>Lisp</a></li></ul><nav class=paginav><a class=prev href=https://littlebees.github.io/2020/04/rebuilding-rails%E7%9A%84%E5%BF%83%E5%BE%97/><span class=title>« Prev</span><br><span>Rebuilding Rails的心得</span>
</a><a class=next href=https://littlebees.github.io/2020/04/the-little-schemer%E8%AE%80%E5%BE%8C%E7%AD%86%E8%A8%98/><span class=title>Next »</span><br><span>The Little Schemer讀後筆記</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://littlebees.github.io/>記事本</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>