<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>k8s概念 | 記事本</title>
<meta name=keywords content="k8s"><meta name=description content="動機
可以先去看k8s筆記"><meta name=author content="zhengcf"><link rel=canonical href=https://littlebees.github.io/2022/01/k8s%E6%A6%82%E5%BF%B5/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://littlebees.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://littlebees.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://littlebees.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://littlebees.github.io/apple-touch-icon.png><link rel=mask-icon href=https://littlebees.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="k8s概念"><meta property="og:description" content="動機
可以先去看k8s筆記"><meta property="og:type" content="article"><meta property="og:url" content="https://littlebees.github.io/2022/01/k8s%E6%A6%82%E5%BF%B5/"><meta property="og:image" content="https://littlebees.github.io/images/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-17T15:17:03+00:00"><meta property="article:modified_time" content="2022-01-17T15:17:03+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://littlebees.github.io/images/papermod-cover.png"><meta name=twitter:title content="k8s概念"><meta name=twitter:description content="動機
可以先去看k8s筆記"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://littlebees.github.io/posts/"},{"@type":"ListItem","position":2,"name":"k8s概念","item":"https://littlebees.github.io/2022/01/k8s%E6%A6%82%E5%BF%B5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"k8s概念","name":"k8s概念","description":"動機 可以先去看k8s筆記\n","keywords":["k8s"],"articleBody":"動機 可以先去看k8s筆記\nk8s cluster \u0026 namespace namespace == virtual cluster cluster = master + workers k8s Volume StorageClass\na set of disk partitions (a physical disk) provisioner (What is this disk?) parameters =\u003e PersistentVolume a disk partition =\u003e PersistentVolumeClaim a folder with some limitation size What should k8s do when this pod has been deleted? common arguments\nreclaimPolicy accessModes k8s components ConfigMap \u0026 Secret dict (key-value) dict[key] = value Serect will encrypt!! ConfigMap will not dict[key] valueFrom configMapKeyRef or secretKeyRef name key DaemonSet run pods on each nodes pods are daemons for a node 每個Pods都會共用同一個掛載硬碟 no rollback 更新方面，DaemonSet更新方式為一個Pod先關閉，而後才起新的Pod StatefulSets pod有唯一編號 使用PVC時，會有各自獨立的Storage 佈署與擴展時，每個 pod 的產生都是有其順序且逐一完成 no rollback Job pods will be cleaned up after pods’ tasks have finished Ingress \u0026 Service Ingress: reverse proxy (url to service) Service: port forward \u0026 DNS (url) LoadBalancer routing (like reverse proxy, ip\u0026port to pods) NodePort port forward Deployment -\u003e ReplicaSet -\u003e Pod Health Check Rollback 每個Pods都會共用同一個掛載硬碟 k8s components management how to find a component fulfilling requests? kind other arguments label key:value namespace selector key: value chain service -\u003e deployment(s) (with configmap) -\u003e service -\u003e …\nk8s \u0026 Istio (define how to connect to pods!!) k8s: proxy on Node dispatch(by iptables) to pods in this Node istio proxy on Service (in each pod) like Ingress, but proxy control pods directly 可以實現內對外的gateway () 這裡可以順便嘴一下，k8s的pod創完後就不能加pod，所以如果conntainer出事沒辦法插入probe，這樣與kprobe有什麼不一樣(所以才有像是istio之類的東西出現) issue\nhelm yaml compiler \u0026 dict manager (control content by some conditions) with some artifacts (reuse others’ yaml) DSL (no!!) k8s’s device plugin 就是driver in traditional OS 用法就是把device mount到對應的path (/dev/xxx) Interface Container Runtime Interface (CRI) (k8s\u0026istio , docker\u0026containerd) Pod Life Cycle (Add/Delete) Pod Status Image management Container Operations (attatch/exec) Container Network Interface (CNI) 上網能力，通常都會希望能夠有連接外網的能力 mutilcast 硬體加速 (DPDK,…) 但k8s的proxy與相關功能(service discovery)都是走linux network stack!! CNI要重新實現k8s的proxy與相關功能!! 分配 IP 地址，幫每個 Pod 找一個獨立不重複的 IP Network Policy， kubernetes 內部有 Network Policy 去限制 Pod 與 Pod 之間的網路傳輸 Container Storage Interface(CSI) 支援動態配置或是靜態配置 其實對應到 k8s 就是 storageclass 以及 PersistentVolume 的概念 支援Attach，該 Node 有能力可以跟該儲存方案連接起來 支援Mount，該儲存空間給實體化後可以透過 Filesystem 去存取。 支援 Block Device (EBS) 或是可直接 Mountable Volumes (大家應該大部分都用這個) 支援本地儲存設備解決方案，譬如 (device mapper, lvm)，這些又是以前的儲存議題了 支援創建/刪除快照 可提供從先前創造的快照復原出任何空間 CreateVolume +------------+ DeleteVolume +-------------\u003e| CREATED +--------------+ | +---+----+---+ | | Controller | | Controller v +++ Publish | | Unpublish +++ |X| Volume | | Volume | | +-+ +---v----+---+ +-+ | NODE_READY | +---+----^---+ Node | | Node Stage | | Unstage Volume | | Volume +---v----+---+ | VOL_READY | +------------+ Node | | Node Publish | | Unpublish Volume | | Volume +---v----+---+ | PUBLISHED | +------------+ rdac Role, ClusterRole 就是能使用什麼資源 RoleBinding就是把Role連到User或是ServiceAccount\n這樣pod就能根據rbac的規定去操作k8s的資源，是根據餵到master的token去查權限\nkubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep ACCOUNT | awk '{print $1}') 下面是針對gitlab ci runner的rbac\nkind: ServiceAccount apiVersion: v1 metadata: name: ci namespace: ci --- kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1 metadata: name: ci rules: - apiGroups: [\"\"] resources: [\"pods\"] verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\",\"delete\"] - apiGroups: [\"\"] resources: [\"pods/binding\"] verbs: [\"get\", \"list\", \"watch\", \"create\"] - apiGroups: [\"\"] resources: [\"pods/log\"] verbs: [\"get\", \"list\", \"watch\", \"create\"] - apiGroups: [\"\"] resources: [\"pods/status\"] verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\"] - apiGroups: [\"apps\"] resources: [\"deployments\"] verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\"] - apiGroups: [\"apps\"] resources: [\"replicasets\"] verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\"] - apiGroups: [\"\"] resources: [\"secrets\"] verbs: [\"list\", \"get\", \"create\", \"delete\", \"update\"] - apiGroups: [\"\"] resources: [\"configmaps\"] verbs: [\"list\", \"get\", \"create\", \"delete\", \"update\"] - apiGroups: [\"\"] resources: [\"pods/exec\"] verbs: [\"create\"] - apiGroups: [\"\"] resources: [\"pods/attach\"] verbs: [\"list\", \"get\", \"create\", \"delete\", \"update\"] --- kind: ClusterRoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: ci subjects: - kind: ServiceAccount name: ci namespace: ci roleRef: kind: ClusterRole name: ci apiGroup: rbac.authorization.k8s.io --- kind: ClusterRoleBinding apiVersion: rbac.authorization.k8s.io/v1 metadata: name: ci-default subjects: - kind: ServiceAccount name: default namespace: ci roleRef: kind: ClusterRole name: ci apiGroup: rbac.authorization.k8s.io 多nodes 創master: kubeadm init 拿master的token: kubeadm token list join: kubeadm join --discovery-token-unsafe-skip-ca-verification --token=TOKEN MASTER_IP:6443 kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk '{print $1}') 範例 下面是用Secret, ConfigMap, Service, Deployment 簡單創一個DB\napiVersion: v1 kind: Secret metadata: name: postgres-secret type: Opaque data: POSTGRES_PASSWORD: MTIzNDU2Nzg5Cg== --- apiVersion: v1 kind: ConfigMap metadata: name: postgres-config labels: app: postgres data: POSTGRES_COMMON: pg2 POSTGRES_PASSWORD: \"123456789\" --- apiVersion: v1 kind: PersistentVolume metadata: name: postgres-pv-volume labels: type: local app: postgres spec: storageClassName: manual capacity: storage: 5Gi accessModes: - ReadWriteMany hostPath: path: \"/mnt/data\" --- apiVersion: v1 kind: PersistentVolumeClaim metadata: name: postgres-pv-claim labels: app: postgres spec: storageClassName: manual accessModes: - ReadWriteMany resources: requests: storage: 1Gi --- apiVersion: apps/v1 kind: Deployment metadata: name: postgres spec: replicas: 1 selector: matchLabels: app: postgres template: metadata: labels: app: postgres spec: containers: - name: postgres image: postgres:12.9-alpine imagePullPolicy: \"IfNotPresent\" ports: - containerPort: 5432 env: - name: POSTGRES_DB valueFrom: configMapKeyRef: name: postgres-config key: POSTGRES_COMMON - name: POSTGRES_USER valueFrom: configMapKeyRef: name: postgres-config key: POSTGRES_COMMON - name: POSTGRES_PASSWORD valueFrom: secretKeyRef: name: postgres-secret key: POSTGRES_PASSWORD volumeMounts: - mountPath: /var/lib/postgresql/data name: postgredb volumes: - name: postgredb persistentVolumeClaim: claimName: postgres-pv-claim --- apiVersion: v1 kind: Service metadata: name: postgres labels: app: postgres spec: type: NodePort ports: - port: 5432 selector: app: postgres secret as files apiVersion: v1 kind: Secret metadata: name: test-secret type: Opaque data: username: YWRtaW4= password: YTYyZmpiZDM3OTQyZGNz spec: volumes: - name: secret-volume secret: secretName: test-secret containers: - name: test-container image: alpine:latest command: [\"sleep\", \"9999\"] volumeMounts: - name: secret-volume mountPath: /etc/secret-volume 這樣在/etc/secret-volume/username就能直接cat出username\nkubectl exec shell-demo -- cat /etc/secret-volume/username kubectl exec -it my-pod main-app -- /bin/bash\nRef ","wordCount":"856","inLanguage":"en","datePublished":"2022-01-17T15:17:03Z","dateModified":"2022-01-17T15:17:03Z","author":{"@type":"Person","name":"zhengcf"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://littlebees.github.io/2022/01/k8s%E6%A6%82%E5%BF%B5/"},"publisher":{"@type":"Organization","name":"記事本","logo":{"@type":"ImageObject","url":"https://littlebees.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://littlebees.github.io/ accesskey=h title="記事本 (Alt + H)">記事本</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://littlebees.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://littlebees.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://littlebees.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://littlebees.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://littlebees.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">k8s概念</h1><div class=post-meta><span title='2022-01-17 15:17:03 +0000 UTC'>January 17, 2022</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;zhengcf</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%8b%95%e6%a9%9f aria-label=動機>動機</a></li><li><a href=#k8s-cluster--namespace aria-label="k8s cluster & namespace">k8s cluster & namespace</a></li><li><a href=#k8s-volume aria-label="k8s Volume">k8s Volume</a></li><li><a href=#k8s-components aria-label="k8s components">k8s components</a></li><li><a href=#k8s-components-management aria-label="k8s components management">k8s components management</a></li><li><a href=#chain aria-label=chain>chain</a></li><li><a href=#k8s--istio-define-how-to-connect-to-pods aria-label="k8s & Istio (define how to connect to pods!!)">k8s & Istio (define how to connect to pods!!)</a></li><li><a href=#helm aria-label=helm>helm</a></li><li><a href=#k8ss-device-plugin aria-label="k8s&rsquo;s device plugin">k8s&rsquo;s device plugin</a></li><li><a href=#interface aria-label=Interface>Interface</a></li><li><a href=#rdac aria-label=rdac>rdac</a></li><li><a href=#%e5%a4%9anodes aria-label=多nodes>多nodes</a></li><li><a href=#%e7%af%84%e4%be%8b aria-label=範例>範例</a><ul><li><a href=#secret-as-files aria-label="secret as files">secret as files</a></li></ul></li><li><a href=#ref aria-label=Ref>Ref</a></li></ul></div></details></div><div class=post-content><h2 id=動機>動機<a hidden class=anchor aria-hidden=true href=#動機>#</a></h2><p>可以先去看<a href=/2020/8/k8s-note/>k8s筆記</a></p><h2 id=k8s-cluster--namespace>k8s cluster & namespace<a hidden class=anchor aria-hidden=true href=#k8s-cluster--namespace>#</a></h2><ul><li>namespace == virtual cluster<ul><li>cluster = master + workers</li></ul></li></ul><h2 id=k8s-volume>k8s Volume<a hidden class=anchor aria-hidden=true href=#k8s-volume>#</a></h2><ul><li><p>StorageClass</p><ul><li>a set of disk partitions (a physical disk)<ul><li>provisioner (What is this disk?)<ul><li>parameters</li></ul></li></ul></li><li>=> PersistentVolume<ul><li>a disk partition</li><li>=> PersistentVolumeClaim<ul><li>a folder with some limitation<ul><li>size</li><li>What should k8s do when this pod has been deleted?</li></ul></li></ul></li></ul></li></ul></li><li><p>common arguments</p><ul><li>reclaimPolicy</li><li>accessModes</li></ul></li></ul><h2 id=k8s-components>k8s components<a hidden class=anchor aria-hidden=true href=#k8s-components>#</a></h2><ul><li>ConfigMap & Secret<ul><li>dict (key-value)</li><li><code>dict[key] = value</code><ul><li>Serect will encrypt!!</li><li>ConfigMap will not</li></ul></li><li><code>dict[key]</code><ul><li><code>valueFrom</code><ul><li><code>configMapKeyRef</code> or <code>secretKeyRef</code><ul><li><code>name</code></li><li><code>key</code></li></ul></li></ul></li></ul></li></ul></li><li>DaemonSet<ul><li>run pods on each nodes<ul><li>pods are daemons for a node</li></ul></li><li>每個Pods都會共用同一個掛載硬碟</li><li>no rollback</li><li>更新方面，DaemonSet更新方式為一個Pod先關閉，而後才起新的Pod</li></ul></li><li>StatefulSets<ul><li>pod有唯一編號</li><li>使用PVC時，會有各自獨立的Storage</li><li>佈署與擴展時，每個 pod 的產生都是有其順序且逐一完成</li><li>no rollback</li></ul></li><li>Job<ul><li>pods will be cleaned up after pods&rsquo; tasks have finished</li></ul></li><li>Ingress & Service<ul><li>Ingress: reverse proxy (url to service)</li><li>Service: port forward & DNS (url)<ul><li>LoadBalancer<ul><li>routing (like reverse proxy, ip&amp;port to pods)</li></ul></li><li>NodePort<ul><li>port forward</li></ul></li></ul></li></ul></li><li>Deployment<ul><li>-> ReplicaSet -> Pod</li><li>Health Check</li><li>Rollback</li><li>每個Pods都會共用同一個掛載硬碟</li></ul></li></ul><h2 id=k8s-components-management>k8s components management<a hidden class=anchor aria-hidden=true href=#k8s-components-management>#</a></h2><ul><li>how to find a component fulfilling requests?<ul><li>kind<ul><li>other arguments</li></ul></li><li>label<ul><li><code>key:value</code></li></ul></li><li>namespace</li></ul></li><li><code>selector</code><ul><li><code>key: value</code></li></ul></li></ul><h2 id=chain>chain<a hidden class=anchor aria-hidden=true href=#chain>#</a></h2><p>service -> deployment(s) (with configmap) -> service -> &mldr;</p><h2 id=k8s--istio-define-how-to-connect-to-pods>k8s & Istio (define how to connect to pods!!)<a hidden class=anchor aria-hidden=true href=#k8s--istio-define-how-to-connect-to-pods>#</a></h2><ul><li>k8s:<ul><li>proxy on Node<ul><li>dispatch(by iptables) to pods in this Node</li></ul></li></ul></li><li>istio<ul><li>proxy on Service (in each pod)<ul><li>like Ingress, but<ul><li>proxy control pods directly</li><li>可以實現內對外的gateway ()</li></ul></li></ul></li></ul></li></ul><p>這裡可以順便嘴一下，k8s的pod創完後就不能加pod，所以如果conntainer出事沒辦法插入probe，這樣與kprobe有什麼不一樣(所以才有像是istio之類的東西出現)
<a href=https://github.com/kubernetes/kubernetes/issues/37838#issuecomment-328853094>issue</a></p><h2 id=helm>helm<a hidden class=anchor aria-hidden=true href=#helm>#</a></h2><ul><li>yaml compiler & dict manager (control content by some conditions)<ul><li>with<ul><li>some artifacts (reuse others&rsquo; yaml)</li><li>DSL (no!!)</li></ul></li></ul></li></ul><h2 id=k8ss-device-plugin>k8s&rsquo;s device plugin<a hidden class=anchor aria-hidden=true href=#k8ss-device-plugin>#</a></h2><ul><li>就是driver in traditional OS</li><li>用法就是把device mount到對應的path (<code>/dev/xxx</code>)</li></ul><h2 id=interface>Interface<a hidden class=anchor aria-hidden=true href=#interface>#</a></h2><ul><li>Container Runtime Interface (CRI) (k8s&amp;istio , docker&amp;containerd)<ul><li>Pod Life Cycle (Add/Delete)</li><li>Pod Status</li><li>Image management</li><li>Container Operations (attatch/exec)</li></ul></li><li>Container Network Interface (CNI)<ul><li>上網能力，通常都會希望能夠有連接外網的能力<ul><li>mutilcast</li><li>硬體加速 (DPDK,&mldr;)<ul><li>但k8s的proxy與相關功能(service discovery)都是走linux network stack!!</li><li>CNI要重新實現k8s的proxy與相關功能!!</li></ul></li></ul></li><li>分配 IP 地址，幫每個 Pod 找一個獨立不重複的 IP</li><li>Network Policy， kubernetes 內部有 Network Policy 去限制 Pod 與 Pod 之間的網路傳輸</li></ul></li><li>Container Storage Interface(CSI)<ul><li>支援動態配置或是靜態配置<ul><li>其實對應到 k8s 就是 storageclass 以及 PersistentVolume 的概念</li></ul></li><li>支援Attach，該 Node 有能力可以跟該儲存方案連接起來</li><li>支援Mount，該儲存空間給實體化後可以透過 Filesystem 去存取。</li><li>支援 Block Device (EBS) 或是可直接 Mountable Volumes (大家應該大部分都用這個)</li><li>支援本地儲存設備解決方案，譬如 (device mapper, lvm)，這些又是以前的儲存議題了</li><li>支援創建/刪除快照</li><li>可提供從先前創造的快照復原出任何空間</li></ul></li></ul><pre tabindex=0><code>   CreateVolume +------------+ DeleteVolume
 +-------------&gt;|  CREATED   +--------------+
 |              +---+----+---+              |
 |       Controller |    | Controller       v
+++         Publish |    | Unpublish       +++
|X|          Volume |    | Volume          | |
+-+             +---v----+---+             +-+
                | NODE_READY |
                +---+----^---+
               Node |    | Node
              Stage |    | Unstage
             Volume |    | Volume
                +---v----+---+
                |  VOL_READY |
                +------------+
               Node |    | Node
            Publish |    | Unpublish
             Volume |    | Volume
                +---v----+---+
                | PUBLISHED  |
                +------------+
</code></pre><p><img loading=lazy src=https://i.imgur.com/Di2JZ8H.png alt></p><h2 id=rdac>rdac<a hidden class=anchor aria-hidden=true href=#rdac>#</a></h2><p>Role, ClusterRole 就是能使用什麼資源
RoleBinding就是把Role連到User或是ServiceAccount</p><p>這樣pod就能根據rbac的規定去操作k8s的資源，是根據餵到master的token去查權限</p><pre tabindex=0><code>kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep ACCOUNT | awk &#39;{print $1}&#39;)
</code></pre><p>下面是針對gitlab ci runner的rbac</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ServiceAccount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ci</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ci</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ci</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;pods&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;watch&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;create&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;update&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;patch&#34;</span><span class=p>,</span><span class=s2>&#34;delete&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;pods/binding&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;watch&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;create&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;pods/log&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;watch&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;create&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;pods/status&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;watch&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;create&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;update&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;patch&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;apps&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;deployments&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;watch&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;create&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;update&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;patch&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;apps&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;replicasets&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;watch&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;create&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;update&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;patch&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;secrets&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;create&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;delete&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;update&#34;</span><span class=p>]</span><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;configmaps&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;create&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;delete&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;update&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;pods/exec&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;create&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;pods/attach&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;list&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;get&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;create&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;delete&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;update&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRoleBinding</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ci</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>subjects</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ServiceAccount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ci</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ci</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>roleRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ci</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRoleBinding</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ci-default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>subjects</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ServiceAccount</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>ci</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>roleRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ci</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></span></span></code></pre></div><h2 id=多nodes>多nodes<a hidden class=anchor aria-hidden=true href=#多nodes>#</a></h2><ol><li>創master: <code>kubeadm init</code></li><li>拿master的token: <code>kubeadm token list</code></li><li>join: <code>kubeadm join --discovery-token-unsafe-skip-ca-verification --token=TOKEN MASTER_IP:6443</code></li></ol><pre tabindex=0><code>kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk &#39;{print $1}&#39;)
</code></pre><h2 id=範例>範例<a hidden class=anchor aria-hidden=true href=#範例>#</a></h2><p>下面是用Secret, ConfigMap, Service, Deployment
簡單創一個DB</p><pre tabindex=0><code class="language-yaml=" data-lang="yaml=">apiVersion: v1
kind: Secret
metadata:
  name: postgres-secret
type: Opaque
data:
  POSTGRES_PASSWORD: MTIzNDU2Nzg5Cg==
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-config
  labels:
    app: postgres
data:
  POSTGRES_COMMON: pg2
  POSTGRES_PASSWORD: &#34;123456789&#34;
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: postgres-pv-volume
  labels:
    type: local
    app: postgres
spec:
  storageClassName: manual
  capacity:
    storage: 5Gi
  accessModes:
    - ReadWriteMany
  hostPath:
    path: &#34;/mnt/data&#34;
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: postgres-pv-claim
  labels:
    app: postgres
spec:
  storageClassName: manual
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 1Gi
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: postgres
spec:
  replicas: 1
  selector:
    matchLabels:
      app: postgres
  template:
    metadata:
      labels:
        app: postgres
    spec:
      containers:
        - name: postgres
          image: postgres:12.9-alpine
          imagePullPolicy: &#34;IfNotPresent&#34;
          ports:
            - containerPort: 5432
          env:
            - name: POSTGRES_DB
              valueFrom:
                configMapKeyRef:
                  name: postgres-config
                  key: POSTGRES_COMMON
            - name: POSTGRES_USER
              valueFrom:
                configMapKeyRef:
                  name: postgres-config
                  key: POSTGRES_COMMON
            - name: POSTGRES_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: postgres-secret
                  key: POSTGRES_PASSWORD
          volumeMounts:
            - mountPath: /var/lib/postgresql/data
              name: postgredb
      volumes:
        - name: postgredb
          persistentVolumeClaim:
            claimName: postgres-pv-claim
---
apiVersion: v1
kind: Service
metadata:
  name: postgres
  labels:
    app: postgres
spec:
  type: NodePort
  ports:
   - port: 5432
  selector:
   app: postgres
</code></pre><h3 id=secret-as-files>secret as files<a hidden class=anchor aria-hidden=true href=#secret-as-files>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Opaque</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>username</span><span class=p>:</span><span class=w> </span><span class=l>YWRtaW4=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>YTYyZmpiZDM3OTQyZGNz</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>secret-volume</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>secret</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class=l>test-secret</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-container</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>alpine:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;sleep&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;9999&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>secret-volume</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/etc/secret-volume</span><span class=w>
</span></span></span></code></pre></div><p>這樣在<code>/etc/secret-volume/username</code>就能直接cat出username</p><p><code>kubectl exec shell-demo -- cat /etc/secret-volume/username</code>
<code>kubectl exec -it my-pod main-app -- /bin/bash</code></p><h2 id=ref>Ref<a hidden class=anchor aria-hidden=true href=#ref>#</a></h2><p><a href=https://ithelp.ithome.com.tw/users/20120317/ironman/2442></a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://littlebees.github.io/tags/k8s/>k8s</a></li></ul><nav class=paginav><a class=prev href=https://littlebees.github.io/2022/01/distributed-computing/><span class=title>« Prev</span><br><span>Distributed computing</span>
</a><a class=next href=https://littlebees.github.io/2022/01/%E5%8F%AA%E8%AE%80%E4%B8%80%E9%83%A8%E4%BB%BD%E7%9A%84yaml%E6%88%90ansible%E7%9A%84%E8%AE%8A%E6%95%B8/><span class=title>Next »</span><br><span>只讀一部份的yaml成ansible的變數</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://littlebees.github.io/>記事本</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>