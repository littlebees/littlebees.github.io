<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>The Little Schemer讀後筆記 | 記事本</title>
<meta name=keywords content="Lisp"><meta name=description content="前言 The Little Schemer(TLS)的目的是教讀者寫遞迴。 這篇筆記不依照章節順序，用主題式的方式，把我心中的這本書呈現出來。
行前須知 知道什麼是?
base 與 inductive case 在歸納法中大概的意思 快速Scheme Tutorial 調用: (<function-or-operator) <args...>) 宣告變數: (define <var-name> <value>) 條件式:
(if <predicate> <when-true> <when-false>) (cond [<predicate> <do-somthing>] ... [else <do-somthing>]) 函數:
(define <func-name> (lambda (<args...>) <do-somthing>)) ;; OR (define (<func-name> (<args...>)) <do-somthing>) 匿名函數:
(lambda (<args...>) <do-somthing>) 本書用到的資料結構介紹 Atom <line-of-characters>還有數字
List of OO 有哪些可能性(case) base case: 空 inductive case: 有東西 建構 空 的case : &lsquo;() 有東西 的case : cons 分解 有東西 的case : car 與 cdr 對應到cons有兩個參數，所以會有兩個解構子。 區分case 空 的case : null?"><meta name=author content="zhengcf"><link rel=canonical href=https://littlebees.github.io/2020/04/the-little-schemer%E8%AE%80%E5%BE%8C%E7%AD%86%E8%A8%98/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://littlebees.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://littlebees.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://littlebees.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://littlebees.github.io/apple-touch-icon.png><link rel=mask-icon href=https://littlebees.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://littlebees.github.io/2020/04/the-little-schemer%E8%AE%80%E5%BE%8C%E7%AD%86%E8%A8%98/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="The Little Schemer讀後筆記"><meta property="og:description" content="前言 The Little Schemer(TLS)的目的是教讀者寫遞迴。 這篇筆記不依照章節順序，用主題式的方式，把我心中的這本書呈現出來。
行前須知 知道什麼是?
base 與 inductive case 在歸納法中大概的意思 快速Scheme Tutorial 調用: (<function-or-operator) <args...>) 宣告變數: (define <var-name> <value>) 條件式:
(if <predicate> <when-true> <when-false>) (cond [<predicate> <do-somthing>] ... [else <do-somthing>]) 函數:
(define <func-name> (lambda (<args...>) <do-somthing>)) ;; OR (define (<func-name> (<args...>)) <do-somthing>) 匿名函數:
(lambda (<args...>) <do-somthing>) 本書用到的資料結構介紹 Atom <line-of-characters>還有數字
List of OO 有哪些可能性(case) base case: 空 inductive case: 有東西 建構 空 的case : &lsquo;() 有東西 的case : cons 分解 有東西 的case : car 與 cdr 對應到cons有兩個參數，所以會有兩個解構子。 區分case 空 的case : null?"><meta property="og:type" content="article"><meta property="og:url" content="https://littlebees.github.io/2020/04/the-little-schemer%E8%AE%80%E5%BE%8C%E7%AD%86%E8%A8%98/"><meta property="og:image" content="https://littlebees.github.io/images/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-15T17:55:27+00:00"><meta property="article:modified_time" content="2020-04-15T17:55:27+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://littlebees.github.io/images/papermod-cover.png"><meta name=twitter:title content="The Little Schemer讀後筆記"><meta name=twitter:description content="前言 The Little Schemer(TLS)的目的是教讀者寫遞迴。 這篇筆記不依照章節順序，用主題式的方式，把我心中的這本書呈現出來。
行前須知 知道什麼是?
base 與 inductive case 在歸納法中大概的意思 快速Scheme Tutorial 調用: (<function-or-operator) <args...>) 宣告變數: (define <var-name> <value>) 條件式:
(if <predicate> <when-true> <when-false>) (cond [<predicate> <do-somthing>] ... [else <do-somthing>]) 函數:
(define <func-name> (lambda (<args...>) <do-somthing>)) ;; OR (define (<func-name> (<args...>)) <do-somthing>) 匿名函數:
(lambda (<args...>) <do-somthing>) 本書用到的資料結構介紹 Atom <line-of-characters>還有數字
List of OO 有哪些可能性(case) base case: 空 inductive case: 有東西 建構 空 的case : &lsquo;() 有東西 的case : cons 分解 有東西 的case : car 與 cdr 對應到cons有兩個參數，所以會有兩個解構子。 區分case 空 的case : null?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://littlebees.github.io/posts/"},{"@type":"ListItem","position":2,"name":"The Little Schemer讀後筆記","item":"https://littlebees.github.io/2020/04/the-little-schemer%E8%AE%80%E5%BE%8C%E7%AD%86%E8%A8%98/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The Little Schemer讀後筆記","name":"The Little Schemer讀後筆記","description":"前言 The Little Schemer(TLS)的目的是教讀者寫遞迴。 這篇筆記不依照章節順序，用主題式的方式，把我心中的這本書呈現出來。\n行前須知 知道什麼是?\nbase 與 inductive case 在歸納法中大概的意思 快速Scheme Tutorial 調用: (\u0026lt;function-or-operator) \u0026lt;args...\u0026gt;) 宣告變數: (define \u0026lt;var-name\u0026gt; \u0026lt;value\u0026gt;) 條件式:\n(if \u0026lt;predicate\u0026gt; \u0026lt;when-true\u0026gt; \u0026lt;when-false\u0026gt;) (cond [\u0026lt;predicate\u0026gt; \u0026lt;do-somthing\u0026gt;] ... [else \u0026lt;do-somthing\u0026gt;]) 函數:\n(define \u0026lt;func-name\u0026gt; (lambda (\u0026lt;args...\u0026gt;) \u0026lt;do-somthing\u0026gt;)) ;; OR (define (\u0026lt;func-name\u0026gt; (\u0026lt;args...\u0026gt;)) \u0026lt;do-somthing\u0026gt;) 匿名函數:\n(lambda (\u0026lt;args...\u0026gt;) \u0026lt;do-somthing\u0026gt;) 本書用到的資料結構介紹 Atom \u0026lt;line-of-characters\u0026gt;還有數字\nList of OO 有哪些可能性(case) base case: 空 inductive case: 有東西 建構 空 的case : \u0026lsquo;() 有東西 的case : cons 分解 有東西 的case : car 與 cdr 對應到cons有兩個參數，所以會有兩個解構子。 區分case 空 的case : null?","keywords":["Lisp"],"articleBody":"前言 The Little Schemer(TLS)的目的是教讀者寫遞迴。 這篇筆記不依照章節順序，用主題式的方式，把我心中的這本書呈現出來。\n行前須知 知道什麼是?\nbase 與 inductive case 在歸納法中大概的意思 快速Scheme Tutorial 調用: (","wordCount":"1483","inLanguage":"en","image":"https://littlebees.github.io/images/papermod-cover.png","datePublished":"2020-04-15T17:55:27Z","dateModified":"2020-04-15T17:55:27Z","author":{"@type":"Person","name":"zhengcf"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://littlebees.github.io/2020/04/the-little-schemer%E8%AE%80%E5%BE%8C%E7%AD%86%E8%A8%98/"},"publisher":{"@type":"Organization","name":"記事本","logo":{"@type":"ImageObject","url":"https://littlebees.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://littlebees.github.io/ accesskey=h title="記事本 (Alt + H)">記事本</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://littlebees.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://littlebees.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://littlebees.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://littlebees.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://littlebees.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">The Little Schemer讀後筆記</h1><div class=post-meta><span title='2020-04-15 17:55:27 +0000 UTC'>April 15, 2020</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;zhengcf</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=前言>前言</a></li><li><a href=#%e8%a1%8c%e5%89%8d%e9%a0%88%e7%9f%a5 aria-label=行前須知>行前須知</a></li><li><a href=#%e5%bf%ab%e9%80%9fscheme-tutorial aria-label="快速Scheme Tutorial">快速Scheme Tutorial</a></li><li><a href=#%e6%9c%ac%e6%9b%b8%e7%94%a8%e5%88%b0%e7%9a%84%e8%b3%87%e6%96%99%e7%b5%90%e6%a7%8b%e4%bb%8b%e7%b4%b9 aria-label=本書用到的資料結構介紹>本書用到的資料結構介紹</a><ul><li><a href=#atom aria-label=Atom>Atom</a></li><li><a href=#list-of-oo aria-label="List of OO">List of OO</a><ul><li><a href=#%e6%9c%89%e5%93%aa%e4%ba%9b%e5%8f%af%e8%83%bd%e6%80%a7case aria-label=有哪些可能性(case)>有哪些可能性(case)</a></li><li><a href=#%e5%bb%ba%e6%a7%8b aria-label=建構>建構</a></li><li><a href=#%e5%88%86%e8%a7%a3 aria-label=分解>分解</a></li><li><a href=#%e5%8d%80%e5%88%86case aria-label=區分case>區分case</a></li></ul></li><li><a href=#integer aria-label=Integer>Integer</a><ul><li><a href=#%e6%9c%89%e5%93%aa%e4%ba%9b%e5%8f%af%e8%83%bd%e6%80%a7case-1 aria-label=有哪些可能性(case)>有哪些可能性(case)</a></li><li><a href=#%e5%bb%ba%e6%a7%8b-1 aria-label=建構>建構</a></li><li><a href=#%e5%88%86%e8%a7%a3-1 aria-label=分解>分解</a></li><li><a href=#%e5%8d%80%e5%88%86case-1 aria-label=區分case>區分case</a></li></ul></li><li><a href=#list-of-list--s-exp aria-label="List of List & S-Exp">List of List & S-Exp</a></li></ul></li><li><a href=#%e5%9c%a8-oo-%e4%b8%8a%e5%81%9a%e9%81%9e%e8%bf%b4 aria-label="在 OO 上做遞迴">在 OO 上做遞迴</a></li><li><a href=#equal--s-exp aria-label="equal? & s-exp">equal? & s-exp</a></li><li><a href=#first-class-function--cps aria-label="first-class function & CPS">first-class function & CPS</a><ul><li><a href=#todo aria-label=TODO>TODO</a></li></ul></li><li><a href=#y-combinator aria-label="Y combinator">Y combinator</a></li><li><a href=#%e7%95%a5%e9%81%8e%e7%9a%84%e9%83%a8%e5%88%86 aria-label=略過的部分>略過的部分</a></li></ul></div></details></div><div class=post-content><h2 id=前言>前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h2><p>The Little Schemer(TLS)的目的是教讀者寫遞迴。
這篇筆記不依照章節順序，用主題式的方式，把我心中的這本書呈現出來。</p><h2 id=行前須知>行前須知<a hidden class=anchor aria-hidden=true href=#行前須知>#</a></h2><p>知道什麼是?</p><ul><li>base 與 inductive case 在歸納法中大概的意思</li></ul><h2 id=快速scheme-tutorial>快速Scheme Tutorial<a hidden class=anchor aria-hidden=true href=#快速scheme-tutorial>#</a></h2><p>調用: <code>(&lt;function-or-operator) &lt;args...>)</code>
宣告變數: <code>(define &lt;var-name> &lt;value>)</code>
條件式:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>if </span><span class=nv>&lt;predicate&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nv>&lt;when-true&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nv>&lt;when-false&gt;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=nv>&lt;predicate&gt;</span> <span class=nv>&lt;do-somthing&gt;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=o>...</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=k>else </span><span class=nv>&lt;do-somthing&gt;</span><span class=p>])</span>
</span></span></code></pre></div><p>函數:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>&lt;func-name&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>&lt;args</span><span class=o>...</span><span class=nv>&gt;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>&lt;do-somthing&gt;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1>;; OR</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>&lt;func-name&gt;</span> <span class=p>(</span><span class=nf>&lt;args</span><span class=o>...</span><span class=nv>&gt;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=nv>&lt;do-somthing&gt;</span><span class=p>)</span>
</span></span></code></pre></div><p>匿名函數:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>&lt;args</span><span class=o>...</span><span class=nv>&gt;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nv>&lt;do-somthing&gt;</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=本書用到的資料結構介紹>本書用到的資料結構介紹<a hidden class=anchor aria-hidden=true href=#本書用到的資料結構介紹>#</a></h2><h3 id=atom>Atom<a hidden class=anchor aria-hidden=true href=#atom>#</a></h3><p><code>&lt;line-of-characters></code>還有數字</p><h3 id=list-of-oo>List of OO<a hidden class=anchor aria-hidden=true href=#list-of-oo>#</a></h3><h4 id=有哪些可能性case>有哪些可能性(case)<a hidden class=anchor aria-hidden=true href=#有哪些可能性case>#</a></h4><ul><li>base case: 空</li><li>inductive case: 有東西</li></ul><h4 id=建構>建構<a hidden class=anchor aria-hidden=true href=#建構>#</a></h4><ul><li>空 的case : &lsquo;()</li><li>有東西 的case : cons</li></ul><h4 id=分解>分解<a hidden class=anchor aria-hidden=true href=#分解>#</a></h4><ul><li>有東西 的case : car 與 cdr
對應到<code>cons</code>有兩個參數，所以會有兩個解構子。</li></ul><h4 id=區分case>區分case<a hidden class=anchor aria-hidden=true href=#區分case>#</a></h4><ul><li>空 的case : null?</li></ul><h3 id=integer>Integer<a hidden class=anchor aria-hidden=true href=#integer>#</a></h3><h4 id=有哪些可能性case-1>有哪些可能性(case)<a hidden class=anchor aria-hidden=true href=#有哪些可能性case-1>#</a></h4><ul><li>base case: 0</li><li>inductive case: 零以上</li></ul><h4 id=建構-1>建構<a hidden class=anchor aria-hidden=true href=#建構-1>#</a></h4><ul><li>0 的case : 0</li><li>零以上 的case : add1</li></ul><h4 id=分解-1>分解<a hidden class=anchor aria-hidden=true href=#分解-1>#</a></h4><ul><li>零以上 的case : sub1</li></ul><h4 id=區分case-1>區分case<a hidden class=anchor aria-hidden=true href=#區分case-1>#</a></h4><ul><li>0 的case : zero?</li></ul><h3 id=list-of-list--s-exp>List of List & S-Exp<a hidden class=anchor aria-hidden=true href=#list-of-list--s-exp>#</a></h3><p>後面再說</p><h2 id=在-oo-上做遞迴>在 OO 上做遞迴<a hidden class=anchor aria-hidden=true href=#在-oo-上做遞迴>#</a></h2><blockquote><p>遞迴就是分解資料再建構出需要的資料。</p></blockquote><p>所以在寫遞迴程式之前要先問是對什麼資料做遞迴，不同的資料有不同的分解方式。</p><p>先來看看如何分解資料，如何分解資料與資料結構的定義有關。</p><p>List只有兩種case，空的(()) 或是 有一個東西加在前面(cons x (sub-list))
所以要寫 List of Atom的函數時要區分這兩種case，同時做相對應的處理。
所以List of Atom的程式大致上都會長成</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>&lt;func-name&gt;</span> <span class=nv>l</span> <span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>&lt;when</span> <span class=nv>l</span> <span class=nv>is</span> <span class=p>()</span> <span class=nv>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nv>&lt;when</span> <span class=nv>l</span> <span class=nv>is</span> <span class=p>(</span><span class=nb>cons </span><span class=nv>x</span> <span class=p>(</span><span class=nf>sub-list</span><span class=p>))</span><span class=nv>&gt;</span><span class=p>))</span>
</span></span></code></pre></div><p>Integer與List of Atom很像，但是</p><ul><li>空的 變成 零</li><li>(cons x &mldr;) 變成 (add1 &mldr;)
與List of Atom的程式有八十七%像</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>&lt;func-name&gt;</span> <span class=nv>n</span> <span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>zero? </span><span class=nv>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>&lt;when</span> <span class=nv>n</span> <span class=nv>is</span> <span class=p>()</span> <span class=nv>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nv>&lt;when</span> <span class=nv>n</span> <span class=nv>is</span> <span class=p>(</span><span class=nb>cons </span><span class=nv>x</span> <span class=p>(</span><span class=nf>sub-list</span><span class=p>))</span><span class=nv>&gt;</span><span class=p>))</span>
</span></span></code></pre></div><p>還有一個是List of List，其實就是樹。
與List of Atom不同的是Atom沒有不同的case要處理但是List有兩種case要處理!!
因此List of List的程式還要看第一個東西是不是List</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>&lt;func-name&gt;</span> <span class=nv>l</span> <span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nv>&lt;when</span> <span class=nv>l</span> <span class=nv>is</span> <span class=p>()</span> <span class=nv>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=nv>&lt;when</span> <span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=nv>is</span> <span class=nv>atom&gt;</span>
</span></span><span class=line><span class=cl>      <span class=nv>&lt;when</span> <span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=nv>is</span> <span class=nv>list&gt;</span><span class=p>)))</span>
</span></span></code></pre></div><p>所以從上面的三個模板可以看到，遞迴程式的骨架，是與資料結構的定義綁在一起的。</p><p>接著來看怎麼重組資料，像同樣對List of Atom做遞迴可以有</p><ul><li>吃 List of Atom 回傳 該List長度 的 length</li><li>吃 List of Atom 與 某個Atom 回傳 移除該Atom的List of Atom 的 rember</li></ul><p>找著前面的List of Atom模板，可以快速寫出</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nb>length </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>rember</span> <span class=nv>l</span> <span class=nv>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span><span class=p>))</span>
</span></span></code></pre></div><p>length的回傳值是Integer，所以一定會用到建構Integer的工具，
0就是建構零這個case的工具，另一個case就是用add1。</p><p>rember的List of Atom，有兩種case，空是()，前面有東西是<code>(cons x &lt;sub-list>)</code>。
所以上面兩個程式寫成</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nb>length </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>add1</span> <span class=o>...</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>rember</span> <span class=nv>l</span> <span class=nv>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>&#39;</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>eq? </span><span class=nv>x</span> <span class=p>(</span><span class=nb>car </span><span class=nv>x</span><span class=p>))</span> <span class=c1>;; 第一項是不是x</span>
</span></span><span class=line><span class=cl>        <span class=o>...</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>cons </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=o>...</span><span class=p>))))</span>
</span></span></code></pre></div><p>接著剩下的部分要填什麼?
<strong>遞迴</strong>的時候!!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nb>length </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>add1</span> <span class=p>(</span><span class=nb>length </span><span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)))))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>rember</span> <span class=nv>l</span> <span class=nv>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>&#39;</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>eq? </span><span class=nv>x</span> <span class=p>(</span><span class=nb>car </span><span class=nv>x</span><span class=p>))</span> <span class=c1>;; 第一項是不是x</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nf>rember</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)</span> <span class=nv>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>cons </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>(</span><span class=nf>rember</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)</span> <span class=nv>x</span><span class=p>)))))</span>
</span></span></code></pre></div><p>基本上，遞迴只要確定要遞迴的資料結構，就很簡單。
依據輸入的資料結構分解，依循回傳的資料結構建構資料。</p><p>但是還是有一些奇耙的遞迴，像河內塔與阿克曼函數。</p><p>本書介紹的遞迴都是原始遞迴函數(primitive recursive function)。
也就是說，每次遞迴時只有一個參數與遞迴有關，同時參數只縮小一個單位，其他參數保持不變。</p><p>像斐波那契就不是原始遞迴函數，詳細的可以去<a href=https://plato.stanford.edu/entries/recursive-functions>這裡</a>看。</p><h2 id=equal--s-exp>equal? & s-exp<a hidden class=anchor aria-hidden=true href=#equal--s-exp>#</a></h2><p>來試著寫寫相等吧，先從Atom開始。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>eqAtom?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nb>number? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>number? </span><span class=nv>b</span><span class=p>))</span> <span class=p>(</span><span class=nb>= </span><span class=nv>a</span> <span class=nv>b</span><span class=p>)]</span> <span class=c1>;; 都是數字用 =</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>or </span><span class=p>(</span><span class=nb>number? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>number? </span><span class=nv>b</span><span class=p>))</span> <span class=no>#f</span><span class=p>]</span> <span class=c1>;; 連type都不一樣就一定不一樣</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=k>else </span><span class=p>(</span><span class=nb>eq? </span><span class=nv>a</span> <span class=nv>b</span><span class=p>)]))</span> <span class=c1>;; 都是symbol用eq?</span>
</span></span></code></pre></div><p>接著寫List of List的。
先把所有可能性列出來
3*3 = 9
3是List of List的case數</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>eqList?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nb>null? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#t</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nb>null? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>)))</span> <span class=c1>;; !!</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=nb>null? </span><span class=nv>a</span><span class=p>)</span> <span class=c1>;; !!</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>))</span> <span class=p>(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>))</span> <span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>and </span><span class=p>(</span><span class=nf>eqAtom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>b</span><span class=p>)))]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nv>else</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>and </span><span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>b</span><span class=p>)))]))</span>
</span></span></code></pre></div><p>只要有<code>(null? a)</code>就是錯，所以可以合起來，讓下面的吃掉上面的，
因為下面的可以cover上面的情形。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>eqList?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nb>null? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#t</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=nb>null? </span><span class=nv>a</span><span class=p>)</span> <span class=c1>;; !!1</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>))</span> <span class=p>(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>))</span> <span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>and </span><span class=p>(</span><span class=nf>eqAtom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>b</span><span class=p>)))]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>))</span> <span class=c1>;; !! 2</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>)</span> <span class=c1>;; !!1</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>)))</span> <span class=c1>;; !!2</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nv>else</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>and </span><span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>b</span><span class=p>)))]))</span>
</span></span></code></pre></div><p>回答都是錯，同時條件之間，不會互相影響，在<code>and</code>後做都ok，
所以用<code>or</code>合起來。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>eqList?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nb>null? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#t</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>or </span><span class=p>(</span><span class=nb>null? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>))</span> <span class=p>(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>))</span> <span class=c1>;; !!</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>))</span> <span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>and </span><span class=p>(</span><span class=nf>eqAtom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>b</span><span class=p>)))]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>or </span><span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>))</span> <span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>))))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nv>else</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>and </span><span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>b</span><span class=p>)))]))</span>
</span></span></code></pre></div><p>過了第2條式子，代表a與b皆不為空，在後面的式子與檢查a或b是空的都沒有用。
可以刪掉。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>eqList?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nb>null? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#t</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>or </span><span class=p>(</span><span class=nb>null? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>))</span> <span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>and </span><span class=p>(</span><span class=nf>eqAtom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>)))]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>or </span><span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>))</span> <span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nv>else</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>and </span><span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>b</span><span class=p>)))]))</span>
</span></span></code></pre></div><p>其實寫的時候要遵照，先<code>and</code>再<code>or</code>，從最小的case開始到後面的case，
就可以直接寫出最終版了。</p><p>接著寫個萬用的<code>equal?</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nb>equal? </span><span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>	  <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nf>atom?</span> <span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nf>atom?</span> <span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>eqAtom?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>	  <span class=p>[(</span><span class=k>or </span><span class=p>(</span><span class=nf>atom?</span> <span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nf>atom?</span> <span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	  <span class=p>[</span><span class=nv>else</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>eqList?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)]))</span>
</span></span></code></pre></div><p>先把相關的程式列出來看看。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>eqAtom?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nb>number? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>number? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nb>= </span><span class=nv>a</span> <span class=nv>b</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>or </span><span class=p>(</span><span class=nb>number? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>number? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nv>else</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nb>eq? </span><span class=nv>a</span> <span class=nv>b</span><span class=p>)]))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>eqList?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nb>null? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#t</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>or </span><span class=p>(</span><span class=nb>null? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>))</span> <span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>)))</span> <span class=c1>;; !!</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>and </span><span class=p>(</span><span class=nf>eqAtom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>)))]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>or </span><span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>))</span> <span class=p>(</span><span class=nf>atom?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>)))</span> <span class=c1>;; !!</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nv>else</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>and </span><span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>))</span> <span class=c1>;; !!</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>b</span><span class=p>)))]))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nb>equal? </span><span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>	  <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nf>atom?</span> <span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nf>atom?</span> <span class=nv>b</span><span class=p>))</span> <span class=c1>;; !!</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>eqAtom?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>	  <span class=p>[(</span><span class=k>or </span><span class=p>(</span><span class=nf>atom?</span> <span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nf>atom?</span> <span class=nv>b</span><span class=p>))</span> <span class=c1>;; !!</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	  <span class=p>[</span><span class=nv>else</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>eqList?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)]))</span> <span class=c1>;; !!</span>
</span></span></code></pre></div><p><code>eqList?</code>與<code>equal?</code>的後三條式子好像!!
有沒有辦法用<code>equal?</code>來縮減<code>eqList?</code>?
如果用<code>equal?</code>先求<code>(car a)</code>是否等於<code>(car b)</code>的話&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>eqList?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nb>null? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#t</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>or </span><span class=p>(</span><span class=nb>null? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nv>else</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>and </span><span class=p>(</span><span class=nb>equal? </span><span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>b</span><span class=p>)))]))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nb>equal? </span><span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>	  <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nf>atom?</span> <span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nf>atom?</span> <span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>eqAtom?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>	  <span class=p>[(</span><span class=k>or </span><span class=p>(</span><span class=nf>atom?</span> <span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nf>atom?</span> <span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	  <span class=p>[</span><span class=nv>else</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>eqList?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)]))</span>
</span></span></code></pre></div><p>最後，再把所有式子列出來吧。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>eqAtom?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nb>number? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>number? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nb>= </span><span class=nv>a</span> <span class=nv>b</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>or </span><span class=p>(</span><span class=nb>number? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>number? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nv>else</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nb>eq? </span><span class=nv>a</span> <span class=nv>b</span><span class=p>)]))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>eqList?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nb>null? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#t</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[(</span><span class=k>or </span><span class=p>(</span><span class=nb>null? </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>null? </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nv>else</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>and </span><span class=p>(</span><span class=nb>equal? </span><span class=p>(</span><span class=nb>car </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>car </span><span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=nf>eqList?</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>b</span><span class=p>)))]))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nb>equal? </span><span class=nv>a</span> <span class=nv>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>cond</span>
</span></span><span class=line><span class=cl>	  <span class=p>[(</span><span class=k>and </span><span class=p>(</span><span class=nf>atom?</span> <span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nf>atom?</span> <span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>eqAtom?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>	  <span class=p>[(</span><span class=k>or </span><span class=p>(</span><span class=nf>atom?</span> <span class=nv>a</span><span class=p>)</span> <span class=p>(</span><span class=nf>atom?</span> <span class=nv>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>      <span class=no>#f</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	  <span class=p>[</span><span class=nv>else</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>eqList?</span> <span class=nv>a</span> <span class=nv>b</span><span class=p>)]))</span>
</span></span></code></pre></div><p>到這裡就可以看出Lisp的s-exp的定義了。</p><ul><li>S-Exp<ul><li>Atom<ul><li>Number</li><li>Symbol</li></ul></li><li>List<ul><li>Null</li><li>Cons <s-exp>List</li></ul></li></ul></li></ul><h2 id=first-class-function--cps>first-class function & CPS<a hidden class=anchor aria-hidden=true href=#first-class-function--cps>#</a></h2><p>一級函數可以捕捉變數，與當成資料丟來丟去，所以可以用它來做一些噁心的事。</p><p>像我們可以試著替下面這個函數加入C語言中的<code>return</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>sum</span> <span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>(</span><span class=nf>sum</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)))))</span>
</span></span></code></pre></div><p>0可以直接<code>return</code>，但是<code>return</code>要從哪裡來?
我們可以多加一個參數，叫<code>return</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>sum</span> <span class=nv>l</span> <span class=nv>return</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>return</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>return</span> <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>(</span><span class=nf>sum</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))</span>
</span></span></code></pre></div><p>等等，<code>(sum (cdr l))</code>是不是少了一個參數，要給他什麼?</p><p>痾&mldr;，直接傳入<code>return</code>?
但是這樣接不起來&mldr;</p><p><code>(return 0)</code>應該要回到，<code>(+ (car l) 0)</code>才對
所以<code>(return 0)</code>的<code>return</code>應該是</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=nv>n</span><span class=p>))</span>
</span></span></code></pre></div><p>這個加總應該要<code>return</code>才對，所以再改成</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=nf>return</span> <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=nv>n</span><span class=p>)))</span>
</span></span></code></pre></div><p>可以回到原本的sum了</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>sum</span> <span class=nv>l</span> <span class=nv>return</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>return</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>return</span> <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>(</span><span class=nf>sum</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                              <span class=p>(</span><span class=nf>return</span> <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=nv>n</span><span class=p>))))))))</span>
</span></span></code></pre></div><p>痾&mldr;，那個最外層的<code>(return (+ ...))</code>不是在lambda中嗎
應該要刪掉吧</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>sum</span> <span class=nv>l</span> <span class=nv>return</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>return</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>sum</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>         <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=nf>return</span> <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=nv>n</span><span class=p>))))))</span>
</span></span></code></pre></div><p>這個就是cps版本的sum，觀察這個程式會發現</p><ol><li>他從遞迴變成迴圈了</li><li>每過一次迴圈，<code>return</code>會變多變長，所以</li><li>雖然說是迴圈，但是遞迴的成本還在</li><li>這<code>return</code>是函數，所以應該可以有(回傳)多個參數</li></ol><p>像是說再sum中加入看有沒有0的功能</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>sum</span> <span class=nv>l</span> <span class=nv>return</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>return</span> <span class=mi>0</span> <span class=no>#f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>sum</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>         <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>n</span> <span class=nv>z</span><span class=p>)</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=nf>return</span> <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=nv>n</span><span class=p>)</span> <span class=p>(</span><span class=k>or </span><span class=p>(</span><span class=nb>zero? </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>))</span> <span class=nv>z</span><span class=p>))))))</span>
</span></span></code></pre></div><p>完成了cps版本的程式，那有沒有辦法直接轉出cps的作法?
先看無cps與cps的對比</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>sum</span> <span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>(</span><span class=nf>sum</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)))))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>sum</span> <span class=nv>l</span> <span class=nv>return</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>return</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>sum</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>         <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>           <span class=p>(</span><span class=nf>return</span> <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=nv>n</span><span class=p>))))))</span>
</span></span></code></pre></div><p>看到參數列，他多了<code>return</code>
看到base case，直接調用<code>return</code>
看到inductive case，</p><ol><li>遞迴的部分被拉出來了</li><li>跳回來要做的事，被放到lambda中</li><li>在lambda因為完成了計算，所以調用了<code>return</code></li></ol><p>根據剛剛的觀察，我們可以找到手工轉cps的方法</p><ol><li>參數列加入<code>return</code></li><li>base case直接調用<code>return</code></li><li>把遞迴的部分拉到最外面</li><li>在lambda完成原本跳回來的計算，並調用<code>return</code></li></ol><p>來試試轉<code>fib</code>吧</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>fib</span> <span class=nv>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>&lt; </span><span class=nv>n</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nf>fib</span> <span class=p>(</span><span class=nb>- </span><span class=nv>n</span> <span class=mi>1</span><span class=p>))</span> <span class=p>(</span><span class=nf>fib</span> <span class=p>(</span><span class=nb>- </span><span class=nv>n</span> <span class=mi>2</span><span class=p>)))))</span>
</span></span></code></pre></div><p>先加<code>return</code>與base case調用<code>return</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>fib</span> <span class=nv>n</span> <span class=nv>return</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>&lt; </span><span class=nv>n</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>return</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nf>fib</span> <span class=p>(</span><span class=nb>- </span><span class=nv>n</span> <span class=mi>1</span><span class=p>))</span> <span class=p>(</span><span class=nf>fib</span> <span class=p>(</span><span class=nb>- </span><span class=nv>n</span> <span class=mi>2</span><span class=p>)))))</span>
</span></span></code></pre></div><p>接著要把遞迴拉出來，但是這有兩個遞迴，要怎麼辦?
如果用C語言來寫原本的<code>fib</code>可以寫成</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=nf>fib</span><span class=p>(</span><span class=kt>int</span> <span class=n>n</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span><span class=p>(</span><span class=n>n</span> <span class=o>&lt;</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>tmp1</span> <span class=o>=</span> <span class=nf>fin</span><span class=p>(</span><span class=n>n</span><span class=o>-</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>tmp2</span> <span class=o>=</span> <span class=nf>fib</span><span class=p>(</span><span class=n>n</span><span class=o>-</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>tmp1</span> <span class=o>+</span> <span class=n>tmp2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>所以我們應該也可以像<code>tmp1</code>與<code>tmp2</code>一樣，一次處理一個，在最後再調用<code>return</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=p>(</span><span class=nf>fib</span> <span class=nv>n</span> <span class=nv>return</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>&lt; </span><span class=nv>n</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>return</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>fin</span> <span class=p>(</span><span class=nb>- </span><span class=nv>n</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>         <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>tmp1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=nf>fib</span> <span class=p>(</span><span class=nb>- </span><span class=nv>n</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                 <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>tmp2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=p>(</span><span class=nf>return</span> <span class=p>(</span><span class=nb>+ </span><span class=nv>tmp1</span> <span class=nv>tmp2</span><span class=p>))))))))</span>
</span></span></code></pre></div><p>應該要修修前面的手工方法</p><ol><li>參數列加入<code>return</code></li><li>base case直接調用<code>return</code></li><li><strong>一次</strong>把<strong>一個</strong>遞迴的部分拉到最外面</li><li>在lambda完成原本跳回來的計算，並調用<code>return</code></li></ol><p>到這裡終於可以來說明什麼是cps了!!
cps是continuation-passing-style的簡稱。
continuation中文叫延續。</p><p>雖然上面都是用<code>return</code>來代稱，但是continuation能做的事不只是<code>return</code>而已。</p><p>continuation可以想像成代辦事項或是Program conuter，也許會比較好思考一點。</p><p>如果改變continuation的內容，可以讓原本的程式跑去做別的事，一去不復返，或是再回來同一個地方。</p><p>可以用continuation實現像prolog的DSL、exception的catch-throw與簡單的thread等神奇的應用。</p><p>有機會可以等The Seasoned Schemer的心得寫完，來整理continuation的應用與在邏輯上的意義。</p><p>題外話，其實再多一點推導，可以推出continuation的monad，但是monad的推導與整理，也是之後再拉一篇文章來寫。</p><h3 id=todo>TODO<a hidden class=anchor aria-hidden=true href=#todo>#</a></h3><p>Y combinator的CPS版是?</p><h2 id=y-combinator>Y combinator<a hidden class=anchor aria-hidden=true href=#y-combinator>#</a></h2><p>我們從sum開始</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>sum</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=mi>0</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>(</span><span class=nf>sum</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))</span>
</span></span></code></pre></div><p>假設我們沒有define來做遞迴了，但是要做出sum的效果。</p><p>可以多加一層來引入能做出sum效果的函數</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>sum-cant-work</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>sum1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>(</span><span class=nf>sum1</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)))))))</span>
</span></span></code></pre></div><p>那原本的sum要給什麼，不然不會動
把整個lambda再丟到，sum的參數中就可以用了</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>sum-still-cant-work</span>
</span></span><span class=line><span class=cl>  <span class=p>((</span><span class=k>lambda </span><span class=p>(</span><span class=nf>sum1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>(</span><span class=nf>sum1</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))</span>  <span class=c1>;; sum1需要sum1!!</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>sum1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>(</span><span class=nf>sum1</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))))</span> <span class=c1>;; sum1需要sum1!!</span>
</span></span></code></pre></div><p>等等還是不能動，看到遞迴的sum，應該要先把sum1丟到sum1中</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>sum-can-work-but-ugly</span>
</span></span><span class=line><span class=cl>  <span class=p>((</span><span class=k>lambda </span><span class=p>(</span><span class=nf>sum1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>((</span><span class=nf>sum1</span> <span class=nv>sum1</span><span class=p>)</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>sum1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>((</span><span class=nf>sum1</span> <span class=nv>sum1</span><span class=p>)</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))))</span>
</span></span></code></pre></div><p>好醜，抽象重複的部分</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>sum-can-work-but-wierd</span>
</span></span><span class=line><span class=cl>  <span class=p>((</span><span class=k>lambda </span><span class=p>(</span><span class=nf>mk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>mk</span> <span class=nv>mk</span><span class=p>))</span>
</span></span><span class=line><span class=cl>   <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>sum1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>((</span><span class=nf>sum1</span> <span class=nv>sum1</span><span class=p>)</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))))</span> <span class=c1>;; (sum1 sum1) 能不能改成 像 sum 這樣</span>
</span></span></code></pre></div><p>現在就是<code>(sum1 sum1)</code>怪怪的
能不能把他抽掉嗎?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>sum-can-work</span>
</span></span><span class=line><span class=cl>  <span class=p>((</span><span class=k>lambda </span><span class=p>(</span><span class=nf>mk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=nf>mk</span> <span class=nv>mk</span><span class=p>))</span>
</span></span><span class=line><span class=cl>   <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>sum1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>((</span><span class=k>lambda </span><span class=p>(</span><span class=nf>sum</span><span class=p>)</span>                   <span class=c1>;; 從這裡到 ...</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>(</span><span class=nf>sum</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>))))))</span> <span class=c1>;; 這裡與原本的sum好像</span>
</span></span><span class=line><span class=cl>     <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>arg</span><span class=p>)</span> <span class=p>((</span><span class=nf>sum1</span> <span class=nv>sum1</span><span class=p>)</span> <span class=nv>arg</span><span class=p>)))))</span>
</span></span></code></pre></div><p>sum好像浮出來了
試著把他拉出去</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>sum-mk</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>sum</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>       <span class=p>(</span><span class=k>if </span><span class=p>(</span><span class=nb>null? </span><span class=nv>l</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>+ </span><span class=p>(</span><span class=nb>car </span><span class=nv>l</span><span class=p>)</span> <span class=p>(</span><span class=nf>sum</span> <span class=p>(</span><span class=nb>cdr </span><span class=nv>l</span><span class=p>)))))))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>sum-can-work</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>sum-mk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>((</span><span class=k>lambda </span><span class=p>(</span><span class=nf>mk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>mk</span> <span class=nv>mk</span><span class=p>))</span>
</span></span><span class=line><span class=cl>     <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>sum1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>sum-mk</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>arg</span><span class=p>)</span> <span class=p>((</span><span class=nf>sum1</span> <span class=nv>sum1</span><span class=p>)</span> <span class=nv>arg</span><span class=p>)))))))</span>
</span></span></code></pre></div><p>這sum-can-work好像可以產生sum以外的遞迴函數，應該換個名字</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-scheme data-lang=scheme><span class=line><span class=cl><span class=p>(</span><span class=k>define </span><span class=nv>Y</span>
</span></span><span class=line><span class=cl>  <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>mk</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>((</span><span class=k>lambda </span><span class=p>(</span><span class=nf>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>f</span> <span class=nv>f</span><span class=p>))</span>
</span></span><span class=line><span class=cl>     <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>g</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>(</span><span class=nf>mk</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=k>lambda </span><span class=p>(</span><span class=nf>arg</span><span class=p>)</span> <span class=p>((</span><span class=nf>g</span> <span class=nv>g</span><span class=p>)</span> <span class=nv>arg</span><span class=p>)))))))</span>
</span></span></code></pre></div><p>這就是Y combinator嚴格求值版。
還有惰性求值版與set!版。
set!版在The Seasoned Schemer有介紹，而惰性求值版之後會在Y combinator的專文中補完。</p><h2 id=略過的部分>略過的部分<a hidden class=anchor aria-hidden=true href=#略過的部分>#</a></h2><ul><li>直譯器</li><li>set & relation</li><li>停機問題
直譯器等到以後打EoPL與LiSP的心得再說。
set與relation的部分直接去看就好。
停機問題等摸熟計算理論再說吧。</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://littlebees.github.io/tags/lisp/>Lisp</a></li></ul><nav class=paginav><a class=prev href=https://littlebees.github.io/2020/04/the-seasoned-schemer%E8%AE%80%E5%BE%8C%E7%AD%86%E8%A8%98/><span class=title>« Prev</span><br><span>The Seasoned Schemer讀後筆記</span>
</a><a class=next href=https://littlebees.github.io/2020/04/ubuntu-mirror/><span class=title>Next »</span><br><span>ubuntu-mirror</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://littlebees.github.io/>記事本</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>