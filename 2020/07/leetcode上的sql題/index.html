<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>leetcode上的sql題 | 記事本</title>
<meta name=keywords content="SQL,SQL"><meta name=description content="動機
leetcode 上解 sql，潮
同時熟悉sql怎麼用"><meta name=author content="zhengcf"><link rel=canonical href=https://littlebees.github.io/2020/07/leetcode%E4%B8%8A%E7%9A%84sql%E9%A1%8C/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://littlebees.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://littlebees.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://littlebees.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://littlebees.github.io/apple-touch-icon.png><link rel=mask-icon href=https://littlebees.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://littlebees.github.io/2020/07/leetcode%E4%B8%8A%E7%9A%84sql%E9%A1%8C/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="leetcode上的sql題"><meta property="og:description" content="動機
leetcode 上解 sql，潮
同時熟悉sql怎麼用"><meta property="og:type" content="article"><meta property="og:url" content="https://littlebees.github.io/2020/07/leetcode%E4%B8%8A%E7%9A%84sql%E9%A1%8C/"><meta property="og:image" content="https://littlebees.github.io/images/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-07-26T20:54:48+00:00"><meta property="article:modified_time" content="2020-07-26T20:54:48+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://littlebees.github.io/images/papermod-cover.png"><meta name=twitter:title content="leetcode上的sql題"><meta name=twitter:description content="動機
leetcode 上解 sql，潮
同時熟悉sql怎麼用"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://littlebees.github.io/posts/"},{"@type":"ListItem","position":2,"name":"leetcode上的sql題","item":"https://littlebees.github.io/2020/07/leetcode%E4%B8%8A%E7%9A%84sql%E9%A1%8C/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"leetcode上的sql題","name":"leetcode上的sql題","description":"動機 leetcode 上解 sql，潮\n同時熟悉sql怎麼用\n","keywords":["SQL","SQL"],"articleBody":"動機 leetcode 上解 sql，潮\n同時熟悉sql怎麼用\n一些常用的工具 CTE (Common Table Expression) 就是把subquery抽到前面去\n但比起subquery，cte的table可以reference to self 可以遞迴！！\nwindow function 可以把table的部分資料割出來做計數與排名\n常用的是 rank與dense_rank\n兩個的差別是在重複的資料出現時 rank不會列在同一名 dense_rank會列在同一名\n手法 消除重複 group by window function distinct 列舉 self join void empty table =\u003e 所有條件式沒一個符合 null =\u003e left join 時沒有相對應的值 把empty table轉成null case + exists max() 題目 沒有鎖的一共19題\n175. Combine Two Tables left join\nselect a.FirstName, a.LastName, b.City, b.State from Person a left join Address b on a.PersonId = b.PersonId; 176. Second Highest Salary 用rank對每一區排序找出第二名 但是題目有要求如果為空要是null 但如果where找不到東西的話，整個表是空的！！\n所以還要在所以還要再包一層max，如果沒東西就會自動轉成null！！\nselect max(a.Salary) SecondHighestSalary from (select Salary from (select id, Salary, rank () OVER (ORDER BY Salary desc) rk from Employee) b where rk = 2) a; 177. Nth Highest Salary 上一題的延續，但是排名是要可以重複的 所以要改成dense_rank\nCREATE FUNCTION getNthHighestSalary(N INT) RETURNS INT BEGIN RETURN ( # Write your MySQL query statement below. select max(a.Salary) from (select Salary from (select id, Salary, dense_rank () OVER (ORDER BY Salary desc) rk from Employee) b where rk = N) a ); END 178. Rank Scores 都寫著rank了 就是用rank 不過因為是要重複排名所以要用dense_rank\nselect score, dense_rank () over (order by score desc) `Rank` from Scores; 180. Consecutive Numbers 這裡點出sql的programming想法\n用組合出所有需要的資料在同一個row 再用條件篩掉 再從中產生新的資料，丟到新的table 反覆放資料到table讓下一個table使用\n這裡的條件是 兩個row的\n數字 id 要一樣 但我們需要至少三個row同時成立 所以就join兩次這樣就有三個row了\nselect distinct a.Num ConsecutiveNums from Logs a join Logs b on a.Num = b.Num and a.Id = b.Id+1 join Logs c on a.Num = c.Num and a.Id = c.Id+2 181. Employees Earning More Than Their Managers 就是join\nselect A.Name Employee from Employee A join Employee B on A.ManagerId = B.Id where A.Salary \u003e B.Salary 182. Duplicate Emails group by可以把同樣的column的集合在一起 再看集合在一起的row有多少個\nselect Email from Person group by Email having count(Email) \u003e 1 183. Customers Who Never Order left join才會有null!!\nselect name Customers from Customers left join Orders on Orders.CustomerId = Customers.id where CustomerId is null 184. Department Highest Salary 先生出有rk的表 再挑出rk是1的\nwith a as ( select Id, Name, Salary, DepartmentId, dense_rank () over (partition by DepartmentId order by Salary desc) rk from Employee ) select B.Name Department, A.Name Employee, A.Salary from A join Department B on B.Id = A.DepartmentId where A.rk = 1 185. Department Top Three Salaries 與前一題差不多 但我寫了兩個版本\nver.1 用or去組出來\nwith a as ( select *, dense_rank () over (partition by DepartmentId order by Salary desc) rk from Employee ) select b.Name Department , a.Name Employee, a.Salary from a join Department b on b.Id = a.DepartmentId where a.rk =1 or a.rk = 2 or a.rk = 3 ver.2 小於3\n理所當然的，這個效能比較好\nwith a as ( select *, dense_rank () over (partition by DepartmentId order by Salary desc) rk from Employee ) select b.Name Department , a.Name Employee, a.Salary from a join Department b on b.Id = a.DepartmentId where a.rk \u003c= 3 196. Delete Duplicate Emails 用rank來結合同樣的email同時標上rank 之後把rk大於1的delete就好了\nwith A as (select Id, ROW_NUMBER() OVER (PARTITION BY Email order by Id) AS rk from Person) delete from Person where Id = Any(select Id from A where A.rk \u003e 1) 197. Rising Temperature 與180很像\nselect A.Id from Weather A join Weather B on B.RecordDate = subdate(A.RecordDate,1) where A.Temperature \u003e B.Temperature 262. Trips and Users 把沒有ban的與在期限內的row找出來 分別算 同一天的總交易數 與 同一天的完成交易數 算比率，處理當天沒有任何完成交易的狀態 with ts as ( select Trips.Status, Trips.Request_at from Trips join Users a on Trips.Client_Id = a.Users_Id join Users b on Trips.Driver_Id = b.Users_Id where a.Banned = 'No' and b.Banned = 'No' and Trips.Request_at BETWEEN '2013-10-01' AND '2013-10-03' ), a as ( select *, count(*) cnt from ts group by Status, Request_at ), base as ( select sum(cnt) cnt, Request_at from a group by Request_at ), comp as ( select * from a where Status = 'completed' ) select base.Request_at Day, IF(comp.cnt is not null, cast(1.0- (comp.cnt/base.cnt) as decimal(10,2)), 1.00) `Cancellation Rate` from base left join comp on base.Request_at = comp.Request_at 595. Big Countries 複習基本sql用\nselect name, population ,area from World where area \u003e 3000000 or population \u003e 25000000 596. Classes More Than 5 Students 先用student與class group在一起 排除同一個學生在同一個class有兩個以上的學生\n在group class找出題目要的東西\nwith a as (select * from courses group by student, class ) select class from a group by class having count(*) \u003e= 5 601. Human Traffic of Stadium 與180很像但是這次要table中符合條件的row 所以如果用與180同樣的做法還要多一個步驟是 把join完的row拆回去原本的row\nwith a as ( select * from stadium where people \u003e= 100 ), b as ( select x.id id1, x.visit_date visit_date1, x.people people1, y.id id2, y.visit_date visit_date2, y.people people2, z.id id3, z.visit_date visit_date3, z.people people3 from a x join a y on x.id = y.id+1 join a z on y.id = z.id+1 ), c as ( select id1 id, visit_date1 visit_date, people1 people from b union all select id2, visit_date2, people2 from b union all select id3, visit_date3, people3 from b ) select distinct * from c order by id 620. Not Boring Movies 複習基本sql\nselect id, movie, description , rating from cinema where id % 2 = 1 and description != 'boring' order by rating desc 626. Exchange Seats 這題應該是所有sql題中讓我最愉悅的一題\nver.1 把奇數的id加一再把偶數的id減1 但這樣有問題如果row總數是奇數的話最後一筆會出事 所以要特別處理！！\nwith a as ( select id+1 id, student from seat where id%2 = 1 union all select id-1, student from seat where id%2 = 0 ), b as ( select * from a where id = 1 union all select x.id, x.student from a x, a y where x.id = y.id+1 union all select (select count(id) from a), a.student from a where id = (case when ((select count(id) from a) % 2) = 1 then (select max(id) from a) else 0 end) ) select * from b order by id ver.2 ver1把奇數的id與偶數的id分成兩個table 再用union all接起來\n但其實只要針對id做case就好了…\nwith a as ( select count(*) total from seat ) select (case when ((seat.id%2)=1) and seat.id != a.total then seat.id+1 when ((seat.id%2)=1) and seat.id = a.total then seat.id else seat.id-1 end) id, seat.student from seat, a order by id 627. Swap Salary 延續626的想法針對想要的欄位做case 這裡對sex做case就可以了\nupdate salary set sex = (case sex when 'm' then 'f' else 'm' end) ","wordCount":"935","inLanguage":"en","image":"https://littlebees.github.io/images/papermod-cover.png","datePublished":"2020-07-26T20:54:48Z","dateModified":"2020-07-26T20:54:48Z","author":{"@type":"Person","name":"zhengcf"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://littlebees.github.io/2020/07/leetcode%E4%B8%8A%E7%9A%84sql%E9%A1%8C/"},"publisher":{"@type":"Organization","name":"記事本","logo":{"@type":"ImageObject","url":"https://littlebees.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://littlebees.github.io/ accesskey=h title="記事本 (Alt + H)">記事本</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://littlebees.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://littlebees.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://littlebees.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://littlebees.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://littlebees.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">leetcode上的sql題</h1><div class=post-meta><span title='2020-07-26 20:54:48 +0000 UTC'>July 26, 2020</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;zhengcf</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%8b%95%e6%a9%9f aria-label=動機>動機</a></li><li><a href=#%e4%b8%80%e4%ba%9b%e5%b8%b8%e7%94%a8%e7%9a%84%e5%b7%a5%e5%85%b7 aria-label=一些常用的工具>一些常用的工具</a><ul><li><a href=#cte-common-table-expression aria-label="CTE (Common Table Expression)">CTE (Common Table Expression)</a></li><li><a href=#window-function aria-label="window function">window function</a></li></ul></li><li><a href=#%e6%89%8b%e6%b3%95 aria-label=手法>手法</a><ul><li><a href=#%e6%b6%88%e9%99%a4%e9%87%8d%e8%a4%87 aria-label=消除重複>消除重複</a></li><li><a href=#%e5%88%97%e8%88%89 aria-label=列舉>列舉</a></li><li><a href=#void aria-label=void>void</a><ul><li><a href=#%e6%8a%8aempty-table%e8%bd%89%e6%88%90null aria-label="把empty table轉成null">把empty table轉成null</a></li></ul></li></ul></li><li><a href=#%e9%a1%8c%e7%9b%ae aria-label=題目>題目</a><ul><li><a href=#175-combine-two-tables aria-label="175. Combine Two Tables">175. Combine Two Tables</a></li><li><a href=#176-second-highest-salary aria-label="176. Second Highest Salary">176. Second Highest Salary</a></li><li><a href=#177-nth-highest-salary aria-label="177. Nth Highest Salary">177. Nth Highest Salary</a></li><li><a href=#178-rank-scores aria-label="178. Rank Scores">178. Rank Scores</a></li><li><a href=#180-consecutive-numbers aria-label="180. Consecutive Numbers">180. Consecutive Numbers</a></li><li><a href=#181-employees-earning-more-than-their-managers aria-label="181. Employees Earning More Than Their Managers">181. Employees Earning More Than Their Managers</a></li><li><a href=#182-duplicate-emails aria-label="182. Duplicate Emails">182. Duplicate Emails</a></li><li><a href=#183-customers-who-never-order aria-label="183. Customers Who Never Order">183. Customers Who Never Order</a></li><li><a href=#184-department-highest-salary aria-label="184. Department Highest Salary">184. Department Highest Salary</a></li><li><a href=#185-department-top-three-salaries aria-label="185. Department Top Three Salaries">185. Department Top Three Salaries</a><ul><li><a href=#ver1 aria-label=ver.1>ver.1</a></li><li><a href=#ver2 aria-label=ver.2>ver.2</a></li></ul></li><li><a href=#196-delete-duplicate-emails aria-label="196. Delete Duplicate Emails">196. Delete Duplicate Emails</a></li><li><a href=#197-rising-temperature aria-label="197. Rising Temperature">197. Rising Temperature</a></li><li><a href=#262-trips-and-users aria-label="262. Trips and Users">262. Trips and Users</a></li><li><a href=#595-big-countries aria-label="595. Big Countries">595. Big Countries</a></li><li><a href=#596-classes-more-than-5-students aria-label="596. Classes More Than 5 Students">596. Classes More Than 5 Students</a></li><li><a href=#601-human-traffic-of-stadium aria-label="601. Human Traffic of Stadium">601. Human Traffic of Stadium</a></li><li><a href=#620-not-boring-movies aria-label="620. Not Boring Movies">620. Not Boring Movies</a></li><li><a href=#626-exchange-seats aria-label="626. Exchange Seats">626. Exchange Seats</a><ul><li><a href=#ver1-1 aria-label=ver.1>ver.1</a></li><li><a href=#ver2-1 aria-label=ver.2>ver.2</a></li></ul></li><li><a href=#627-swap-salary aria-label="627. Swap Salary">627. Swap Salary</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=動機>動機<a hidden class=anchor aria-hidden=true href=#動機>#</a></h2><p>leetcode 上解 sql，潮</p><p>同時熟悉sql怎麼用</p><h2 id=一些常用的工具>一些常用的工具<a hidden class=anchor aria-hidden=true href=#一些常用的工具>#</a></h2><h3 id=cte-common-table-expression>CTE (Common Table Expression)<a hidden class=anchor aria-hidden=true href=#cte-common-table-expression>#</a></h3><p>就是把subquery抽到前面去</p><p>但比起subquery，cte的table可以reference to self
可以遞迴！！</p><h3 id=window-function>window function<a hidden class=anchor aria-hidden=true href=#window-function>#</a></h3><p>可以把table的部分資料割出來做計數與排名</p><p>常用的是
rank與dense_rank</p><p>兩個的差別是在重複的資料出現時
rank不會列在同一名
dense_rank會列在同一名</p><h2 id=手法>手法<a hidden class=anchor aria-hidden=true href=#手法>#</a></h2><h3 id=消除重複>消除重複<a hidden class=anchor aria-hidden=true href=#消除重複>#</a></h3><ol><li>group by</li><li>window function</li><li>distinct</li></ol><h3 id=列舉>列舉<a hidden class=anchor aria-hidden=true href=#列舉>#</a></h3><ol><li>self join</li></ol><h3 id=void>void<a hidden class=anchor aria-hidden=true href=#void>#</a></h3><ol><li>empty table => 所有條件式沒一個符合</li><li>null => left join 時沒有相對應的值</li></ol><h4 id=把empty-table轉成null>把empty table轉成null<a hidden class=anchor aria-hidden=true href=#把empty-table轉成null>#</a></h4><ol><li>case + exists</li><li>max(<any column>)</li></ol><h2 id=題目>題目<a hidden class=anchor aria-hidden=true href=#題目>#</a></h2><p>沒有鎖的一共19題</p><h3 id=175-combine-two-tables>175. Combine Two Tables<a hidden class=anchor aria-hidden=true href=#175-combine-two-tables>#</a></h3><p>left join</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>FirstName</span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>LastName</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>City</span><span class=p>,</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=k>State</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>Person</span><span class=w> </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>left</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=n>Address</span><span class=w> </span><span class=n>b</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>on</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>PersonId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>PersonId</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=176-second-highest-salary>176. Second Highest Salary<a hidden class=anchor aria-hidden=true href=#176-second-highest-salary>#</a></h3><p>用rank對每一區排序找出第二名
但是題目有要求如果為空要是null
但如果where找不到東西的話，整個表是空的！！</p><p>所以還要在所以還要再包一層max，如果沒東西就會自動轉成null！！</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>Salary</span><span class=p>)</span><span class=w> </span><span class=n>SecondHighestSalary</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>Salary</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>Salary</span><span class=p>,</span><span class=w> </span><span class=n>rank</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>Salary</span><span class=w> </span><span class=k>desc</span><span class=p>)</span><span class=w> </span><span class=n>rk</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Employee</span><span class=p>)</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>rk</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=n>a</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=177-nth-highest-salary>177. Nth Highest Salary<a hidden class=anchor aria-hidden=true href=#177-nth-highest-salary>#</a></h3><p>上一題的延續，但是排名是要可以重複的
所以要改成dense_rank</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=n>getNthHighestSalary</span><span class=p>(</span><span class=n>N</span><span class=w> </span><span class=nb>INT</span><span class=p>)</span><span class=w> </span><span class=k>RETURNS</span><span class=w> </span><span class=nb>INT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>RETURN</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=o>#</span><span class=w> </span><span class=k>Write</span><span class=w> </span><span class=n>your</span><span class=w> </span><span class=n>MySQL</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=k>statement</span><span class=w> </span><span class=n>below</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>select</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>Salary</span><span class=p>)</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>Salary</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>Salary</span><span class=p>,</span><span class=w> </span><span class=n>dense_rank</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>Salary</span><span class=w> </span><span class=k>desc</span><span class=p>)</span><span class=w> </span><span class=n>rk</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Employee</span><span class=p>)</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>rk</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>N</span><span class=p>)</span><span class=w> </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w>
</span></span></span></code></pre></div><h3 id=178-rank-scores>178. Rank Scores<a hidden class=anchor aria-hidden=true href=#178-rank-scores>#</a></h3><p>都寫著rank了
就是用rank
不過因為是要重複排名所以要用dense_rank</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>score</span><span class=p>,</span><span class=w> </span><span class=n>dense_rank</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=n>over</span><span class=w> </span><span class=p>(</span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>score</span><span class=w> </span><span class=k>desc</span><span class=p>)</span><span class=w> </span><span class=o>`</span><span class=n>Rank</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>Scores</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=180-consecutive-numbers>180. Consecutive Numbers<a hidden class=anchor aria-hidden=true href=#180-consecutive-numbers>#</a></h3><p>這裡點出sql的programming想法</p><p>用組合出所有需要的資料在同一個row
再用條件篩掉
再從中產生新的資料，丟到新的table
反覆放資料到table讓下一個table使用</p><p>這裡的條件是 兩個row的</p><ol><li>數字</li><li>id
要一樣</li></ol><p>但我們需要至少三個row同時成立
所以就join兩次這樣就有三個row了</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=k>distinct</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>Num</span><span class=w> </span><span class=n>ConsecutiveNums</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>Logs</span><span class=w> </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>join</span><span class=w> </span><span class=n>Logs</span><span class=w> </span><span class=n>b</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>on</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>Num</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>Num</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>Id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>Id</span><span class=o>+</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>join</span><span class=w> </span><span class=n>Logs</span><span class=w> </span><span class=k>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>on</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>Num</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>Num</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>Id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>c</span><span class=p>.</span><span class=n>Id</span><span class=o>+</span><span class=mi>2</span><span class=w>
</span></span></span></code></pre></div><h3 id=181-employees-earning-more-than-their-managers>181. Employees Earning More Than Their Managers<a hidden class=anchor aria-hidden=true href=#181-employees-earning-more-than-their-managers>#</a></h3><p>就是join</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>A</span><span class=p>.</span><span class=n>Name</span><span class=w> </span><span class=n>Employee</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>Employee</span><span class=w> </span><span class=n>A</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>join</span><span class=w> </span><span class=n>Employee</span><span class=w> </span><span class=n>B</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>on</span><span class=w> </span><span class=n>A</span><span class=p>.</span><span class=n>ManagerId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>B</span><span class=p>.</span><span class=n>Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>A</span><span class=p>.</span><span class=n>Salary</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>B</span><span class=p>.</span><span class=n>Salary</span><span class=w> 
</span></span></span></code></pre></div><h3 id=182-duplicate-emails>182. Duplicate Emails<a hidden class=anchor aria-hidden=true href=#182-duplicate-emails>#</a></h3><p>group by可以把同樣的column的集合在一起
再看集合在一起的row有多少個</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>Email</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>Person</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Email</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>having</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>Email</span><span class=p>)</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></div><h3 id=183-customers-who-never-order>183. Customers Who Never Order<a hidden class=anchor aria-hidden=true href=#183-customers-who-never-order>#</a></h3><p>left join才會有null!!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=n>Customers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>Customers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>left</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=n>Orders</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>on</span><span class=w> </span><span class=n>Orders</span><span class=p>.</span><span class=n>CustomerId</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Customers</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>CustomerId</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=k>null</span><span class=w>
</span></span></span></code></pre></div><h3 id=184-department-highest-salary>184. Department Highest Salary<a hidden class=anchor aria-hidden=true href=#184-department-highest-salary>#</a></h3><p>先生出有rk的表
再挑出rk是1的</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>with</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=n>Id</span><span class=p>,</span><span class=w> </span><span class=n>Name</span><span class=p>,</span><span class=w> </span><span class=n>Salary</span><span class=p>,</span><span class=w> </span><span class=n>DepartmentId</span><span class=p>,</span><span class=w> </span><span class=n>dense_rank</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=n>over</span><span class=w> </span><span class=p>(</span><span class=n>partition</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>DepartmentId</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Salary</span><span class=w> </span><span class=k>desc</span><span class=p>)</span><span class=w> </span><span class=n>rk</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>Employee</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>B</span><span class=p>.</span><span class=n>Name</span><span class=w> </span><span class=n>Department</span><span class=p>,</span><span class=w> </span><span class=n>A</span><span class=p>.</span><span class=n>Name</span><span class=w> </span><span class=n>Employee</span><span class=p>,</span><span class=w> </span><span class=n>A</span><span class=p>.</span><span class=n>Salary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>A</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>join</span><span class=w> </span><span class=n>Department</span><span class=w> </span><span class=n>B</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>on</span><span class=w> </span><span class=n>B</span><span class=p>.</span><span class=n>Id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>A</span><span class=p>.</span><span class=n>DepartmentId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>A</span><span class=p>.</span><span class=n>rk</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></div><h3 id=185-department-top-three-salaries>185. Department Top Three Salaries<a hidden class=anchor aria-hidden=true href=#185-department-top-three-salaries>#</a></h3><p>與前一題差不多
但我寫了兩個版本</p><h4 id=ver1>ver.1<a hidden class=anchor aria-hidden=true href=#ver1>#</a></h4><p>用or去組出來</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>with</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=n>dense_rank</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=n>over</span><span class=w> </span><span class=p>(</span><span class=n>partition</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>DepartmentId</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Salary</span><span class=w> </span><span class=k>desc</span><span class=p>)</span><span class=w> </span><span class=n>rk</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>Employee</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>Name</span><span class=w> </span><span class=n>Department</span><span class=w> </span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>Name</span><span class=w> </span><span class=n>Employee</span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>Salary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>join</span><span class=w> </span><span class=n>Department</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>Id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>DepartmentId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>rk</span><span class=w> </span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>rk</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>rk</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>3</span><span class=w>
</span></span></span></code></pre></div><h4 id=ver2>ver.2<a hidden class=anchor aria-hidden=true href=#ver2>#</a></h4><p>小於3</p><p>理所當然的，這個效能比較好</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>with</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=n>dense_rank</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=n>over</span><span class=w> </span><span class=p>(</span><span class=n>partition</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>DepartmentId</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Salary</span><span class=w> </span><span class=k>desc</span><span class=p>)</span><span class=w> </span><span class=n>rk</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>Employee</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>Name</span><span class=w> </span><span class=n>Department</span><span class=w> </span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>Name</span><span class=w> </span><span class=n>Employee</span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>Salary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>join</span><span class=w> </span><span class=n>Department</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>Id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>DepartmentId</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>rk</span><span class=w> </span><span class=o>&lt;=</span><span class=w> </span><span class=mi>3</span><span class=w>
</span></span></span></code></pre></div><h3 id=196-delete-duplicate-emails>196. Delete Duplicate Emails<a hidden class=anchor aria-hidden=true href=#196-delete-duplicate-emails>#</a></h3><p>用rank來結合同樣的email同時標上rank
之後把rk大於1的delete就好了</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>with</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>Id</span><span class=p>,</span><span class=w> </span><span class=n>ROW_NUMBER</span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>Email</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Id</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>rk</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Person</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>delete</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Person</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>Id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>Any</span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=n>Id</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>A</span><span class=p>.</span><span class=n>rk</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div><h3 id=197-rising-temperature>197. Rising Temperature<a hidden class=anchor aria-hidden=true href=#197-rising-temperature>#</a></h3><p>與180很像</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>A</span><span class=p>.</span><span class=n>Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>Weather</span><span class=w> </span><span class=n>A</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>join</span><span class=w> </span><span class=n>Weather</span><span class=w> </span><span class=n>B</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>on</span><span class=w> </span><span class=n>B</span><span class=p>.</span><span class=n>RecordDate</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>subdate</span><span class=p>(</span><span class=n>A</span><span class=p>.</span><span class=n>RecordDate</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>where</span><span class=w> </span><span class=n>A</span><span class=p>.</span><span class=n>Temperature</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=n>B</span><span class=p>.</span><span class=n>Temperature</span><span class=w>
</span></span></span></code></pre></div><h3 id=262-trips-and-users>262. Trips and Users<a hidden class=anchor aria-hidden=true href=#262-trips-and-users>#</a></h3><ol><li>把沒有ban的與在期限內的row找出來</li><li>分別算 同一天的總交易數 與 同一天的完成交易數</li><li>算比率，處理當天沒有任何完成交易的狀態</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>with</span><span class=w> </span><span class=n>ts</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=n>Trips</span><span class=p>.</span><span class=n>Status</span><span class=p>,</span><span class=w> </span><span class=n>Trips</span><span class=p>.</span><span class=n>Request_at</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>Trips</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>join</span><span class=w> </span><span class=n>Users</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>Trips</span><span class=p>.</span><span class=n>Client_Id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>Users_Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>join</span><span class=w> </span><span class=n>Users</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>Trips</span><span class=p>.</span><span class=n>Driver_Id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>Users_Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>where</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>Banned</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;No&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>b</span><span class=p>.</span><span class=n>Banned</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;No&#39;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>Trips</span><span class=p>.</span><span class=n>Request_at</span><span class=w> </span><span class=k>BETWEEN</span><span class=w> </span><span class=s1>&#39;2013-10-01&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=s1>&#39;2013-10-03&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>a</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>cnt</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>ts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Status</span><span class=p>,</span><span class=w> </span><span class=n>Request_at</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>base</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=k>sum</span><span class=p>(</span><span class=n>cnt</span><span class=p>)</span><span class=w> </span><span class=n>cnt</span><span class=p>,</span><span class=w> </span><span class=n>Request_at</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Request_at</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>comp</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>where</span><span class=w> </span><span class=n>Status</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;completed&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=n>base</span><span class=p>.</span><span class=n>Request_at</span><span class=w> </span><span class=k>Day</span><span class=p>,</span><span class=w> </span><span class=k>IF</span><span class=p>(</span><span class=n>comp</span><span class=p>.</span><span class=n>cnt</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=k>null</span><span class=p>,</span><span class=w> </span><span class=k>cast</span><span class=p>(</span><span class=mi>1</span><span class=p>.</span><span class=mi>0</span><span class=o>-</span><span class=w> </span><span class=p>(</span><span class=n>comp</span><span class=p>.</span><span class=n>cnt</span><span class=o>/</span><span class=n>base</span><span class=p>.</span><span class=n>cnt</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=nb>decimal</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span><span class=mi>2</span><span class=p>)),</span><span class=w> </span><span class=mi>1</span><span class=p>.</span><span class=mi>00</span><span class=p>)</span><span class=w> </span><span class=o>`</span><span class=n>Cancellation</span><span class=w> </span><span class=n>Rate</span><span class=o>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>base</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>left</span><span class=w> </span><span class=k>join</span><span class=w> </span><span class=n>comp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>on</span><span class=w> </span><span class=n>base</span><span class=p>.</span><span class=n>Request_at</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>comp</span><span class=p>.</span><span class=n>Request_at</span><span class=w>
</span></span></span></code></pre></div><h3 id=595-big-countries>595. Big Countries<a hidden class=anchor aria-hidden=true href=#595-big-countries>#</a></h3><p>複習基本sql用</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>population</span><span class=w> </span><span class=p>,</span><span class=n>area</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>World</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>area</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>3000000</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>population</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>25000000</span><span class=w>
</span></span></span></code></pre></div><h3 id=596-classes-more-than-5-students>596. Classes More Than 5 Students<a hidden class=anchor aria-hidden=true href=#596-classes-more-than-5-students>#</a></h3><p>先用student與class group在一起
排除同一個學生在同一個class有兩個以上的學生</p><p>在group class找出題目要的東西</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>with</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>courses</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>student</span><span class=p>,</span><span class=w> </span><span class=k>class</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>class</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=k>class</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>having</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>5</span><span class=w>
</span></span></span></code></pre></div><h3 id=601-human-traffic-of-stadium>601. Human Traffic of Stadium<a hidden class=anchor aria-hidden=true href=#601-human-traffic-of-stadium>#</a></h3><p>與180很像但是這次要table中符合條件的row
所以如果用與180同樣的做法還要多一個步驟是
把join完的row拆回去原本的row</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>with</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>stadium</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>where</span><span class=w> </span><span class=n>people</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>b</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=n>id1</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=n>visit_date</span><span class=w> </span><span class=n>visit_date1</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=n>people</span><span class=w> </span><span class=n>people1</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=n>y</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=n>id2</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=n>visit_date</span><span class=w> </span><span class=n>visit_date2</span><span class=p>,</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=n>people</span><span class=w> </span><span class=n>people2</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=n>z</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=n>id3</span><span class=p>,</span><span class=w> </span><span class=n>z</span><span class=p>.</span><span class=n>visit_date</span><span class=w> </span><span class=n>visit_date3</span><span class=p>,</span><span class=w> </span><span class=n>z</span><span class=p>.</span><span class=n>people</span><span class=w> </span><span class=n>people3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>x</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>join</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=n>id</span><span class=o>+</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>join</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>z</span><span class=w> </span><span class=k>on</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>z</span><span class=p>.</span><span class=n>id</span><span class=o>+</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>c</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=n>id1</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>visit_date1</span><span class=w> </span><span class=n>visit_date</span><span class=p>,</span><span class=w> </span><span class=n>people1</span><span class=w> </span><span class=n>people</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>b</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>union</span><span class=w> </span><span class=k>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=n>id2</span><span class=p>,</span><span class=w> </span><span class=n>visit_date2</span><span class=p>,</span><span class=w> </span><span class=n>people2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>b</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>union</span><span class=w> </span><span class=k>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=n>id3</span><span class=p>,</span><span class=w> </span><span class=n>visit_date3</span><span class=p>,</span><span class=w> </span><span class=n>people3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>b</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=k>distinct</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=k>c</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>id</span><span class=w>
</span></span></span></code></pre></div><h3 id=620-not-boring-movies>620. Not Boring Movies<a hidden class=anchor aria-hidden=true href=#620-not-boring-movies>#</a></h3><p>複習基本sql</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>movie</span><span class=p>,</span><span class=w> </span><span class=n>description</span><span class=w> </span><span class=p>,</span><span class=w> </span><span class=n>rating</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>cinema</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>description</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=s1>&#39;boring&#39;</span><span class=w> </span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>rating</span><span class=w> </span><span class=k>desc</span><span class=w>
</span></span></span></code></pre></div><h3 id=626-exchange-seats>626. Exchange Seats<a hidden class=anchor aria-hidden=true href=#626-exchange-seats>#</a></h3><p>這題應該是所有sql題中讓我最愉悅的一題</p><h4 id=ver1-1>ver.1<a hidden class=anchor aria-hidden=true href=#ver1-1>#</a></h4><p>把奇數的id加一再把偶數的id減1
但這樣有問題如果row總數是奇數的話最後一筆會出事
所以要特別處理！！</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>with</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=o>+</span><span class=mi>1</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>student</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>seat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>%</span><span class=mi>2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>union</span><span class=w> </span><span class=k>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=n>id</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=n>student</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>seat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=o>%</span><span class=mi>2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>),</span><span class=w> </span><span class=n>b</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>union</span><span class=w> </span><span class=k>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=n>student</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>x</span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=n>y</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>where</span><span class=w> </span><span class=n>x</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>y</span><span class=p>.</span><span class=n>id</span><span class=o>+</span><span class=mi>1</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>union</span><span class=w> </span><span class=k>all</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>a</span><span class=p>),</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>student</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>where</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>case</span><span class=w> </span><span class=k>when</span><span class=w> </span><span class=p>((</span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>a</span><span class=p>)</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=k>then</span><span class=w> </span><span class=p>(</span><span class=k>select</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>a</span><span class=p>)</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=k>end</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>b</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>id</span><span class=w>
</span></span></span></code></pre></div><h4 id=ver2-1>ver.2<a hidden class=anchor aria-hidden=true href=#ver2-1>#</a></h4><p>ver1把奇數的id與偶數的id分成兩個table
再用union all接起來</p><p>但其實只要針對id做case就好了&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>with</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>select</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=n>total</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>from</span><span class=w> </span><span class=n>seat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=p>(</span><span class=k>case</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>when</span><span class=w> </span><span class=p>((</span><span class=n>seat</span><span class=p>.</span><span class=n>id</span><span class=o>%</span><span class=mi>2</span><span class=p>)</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>seat</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>total</span><span class=w> </span><span class=k>then</span><span class=w> </span><span class=n>seat</span><span class=p>.</span><span class=n>id</span><span class=o>+</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>when</span><span class=w> </span><span class=p>((</span><span class=n>seat</span><span class=p>.</span><span class=n>id</span><span class=o>%</span><span class=mi>2</span><span class=p>)</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>seat</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>total</span><span class=w> </span><span class=k>then</span><span class=w> </span><span class=n>seat</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>else</span><span class=w> </span><span class=n>seat</span><span class=p>.</span><span class=n>id</span><span class=o>-</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>end</span><span class=p>)</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>seat</span><span class=p>.</span><span class=n>student</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>from</span><span class=w> </span><span class=n>seat</span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>id</span><span class=w>
</span></span></span></code></pre></div><h3 id=627-swap-salary>627. Swap Salary<a hidden class=anchor aria-hidden=true href=#627-swap-salary>#</a></h3><p>延續626的想法針對想要的欄位做case
這裡對sex做case就可以了</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>update</span><span class=w> </span><span class=n>salary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>set</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>(</span><span class=k>case</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=k>when</span><span class=w> </span><span class=s1>&#39;m&#39;</span><span class=w> </span><span class=k>then</span><span class=w> </span><span class=s1>&#39;f&#39;</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=s1>&#39;m&#39;</span><span class=w> </span><span class=k>end</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://littlebees.github.io/tags/sql/>SQL</a></li></ul><nav class=paginav><a class=prev href=https://littlebees.github.io/2020/07/seven-concurrency-models-in-seven-weeks-%E9%83%A8%E5%88%86%E7%AD%86%E8%A8%98/><span class=title>« Prev</span><br><span>Seven-Concurrency-Models-in-Seven-Weeks 部分筆記</span>
</a><a class=next href=https://littlebees.github.io/2020/07/design-pattern%E9%9A%A8%E4%BE%BF%E7%AD%86%E8%A8%98/><span class=title>Next »</span><br><span>design pattern隨便筆記</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://littlebees.github.io/>記事本</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>