<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>隨便的sql筆記 | 記事本</title>
<meta name=keywords content><meta name=description content="動機 整理一些sql的用法
把SQL當成一種奇怪的PL 與awk有點像，SQL的溝通單位只有類似matrix的資料結構 不過這個matrix沒辦法用index取值
同時每家DBMS的實作又有點差別像是CTE的部分就差很多
產生matrix(table) subquery 最基本的產生matrix的手段 最好都要替每個subquery加命名
SELECT P_Name FROM products_taiwan WHERE P_Name NOT IN (SELECT P_Name FROM products_china) china; view 當成matrix的抽象
CREATE VIEW V_Customer AS (SELECT First_Name, Last_Name, Country FROM Customer); function (& stored procedure) 可以產生table也可以產生value
CREATE FUNCTION Sales.ufn_SalesByStore (@storeid int) RETURNS TABLE AS RETURN ( SELECT P.ProductID, P.Name, SUM(SD.LineTotal) AS 'Total' FROM Production.Product AS P JOIN Sales.SalesOrderDetail AS SD ON SD.ProductID = P.ProductID JOIN Sales.SalesOrderHeader AS SH ON SH."><meta name=author content="zhengcf"><link rel=canonical href=https://littlebees.github.io/2020/07/%E9%9A%A8%E4%BE%BF%E7%9A%84sql%E7%AD%86%E8%A8%98/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://littlebees.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://littlebees.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://littlebees.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://littlebees.github.io/apple-touch-icon.png><link rel=mask-icon href=https://littlebees.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://littlebees.github.io/2020/07/%E9%9A%A8%E4%BE%BF%E7%9A%84sql%E7%AD%86%E8%A8%98/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="隨便的sql筆記"><meta property="og:description" content="動機 整理一些sql的用法
把SQL當成一種奇怪的PL 與awk有點像，SQL的溝通單位只有類似matrix的資料結構 不過這個matrix沒辦法用index取值
同時每家DBMS的實作又有點差別像是CTE的部分就差很多
產生matrix(table) subquery 最基本的產生matrix的手段 最好都要替每個subquery加命名
SELECT P_Name FROM products_taiwan WHERE P_Name NOT IN (SELECT P_Name FROM products_china) china; view 當成matrix的抽象
CREATE VIEW V_Customer AS (SELECT First_Name, Last_Name, Country FROM Customer); function (& stored procedure) 可以產生table也可以產生value
CREATE FUNCTION Sales.ufn_SalesByStore (@storeid int) RETURNS TABLE AS RETURN ( SELECT P.ProductID, P.Name, SUM(SD.LineTotal) AS 'Total' FROM Production.Product AS P JOIN Sales.SalesOrderDetail AS SD ON SD.ProductID = P.ProductID JOIN Sales.SalesOrderHeader AS SH ON SH."><meta property="og:type" content="article"><meta property="og:url" content="https://littlebees.github.io/2020/07/%E9%9A%A8%E4%BE%BF%E7%9A%84sql%E7%AD%86%E8%A8%98/"><meta property="og:image" content="https://littlebees.github.io/images/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-07-18T18:30:42+00:00"><meta property="article:modified_time" content="2020-07-18T18:30:42+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://littlebees.github.io/images/papermod-cover.png"><meta name=twitter:title content="隨便的sql筆記"><meta name=twitter:description content="動機 整理一些sql的用法
把SQL當成一種奇怪的PL 與awk有點像，SQL的溝通單位只有類似matrix的資料結構 不過這個matrix沒辦法用index取值
同時每家DBMS的實作又有點差別像是CTE的部分就差很多
產生matrix(table) subquery 最基本的產生matrix的手段 最好都要替每個subquery加命名
SELECT P_Name FROM products_taiwan WHERE P_Name NOT IN (SELECT P_Name FROM products_china) china; view 當成matrix的抽象
CREATE VIEW V_Customer AS (SELECT First_Name, Last_Name, Country FROM Customer); function (& stored procedure) 可以產生table也可以產生value
CREATE FUNCTION Sales.ufn_SalesByStore (@storeid int) RETURNS TABLE AS RETURN ( SELECT P.ProductID, P.Name, SUM(SD.LineTotal) AS 'Total' FROM Production.Product AS P JOIN Sales.SalesOrderDetail AS SD ON SD.ProductID = P.ProductID JOIN Sales.SalesOrderHeader AS SH ON SH."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://littlebees.github.io/posts/"},{"@type":"ListItem","position":2,"name":"隨便的sql筆記","item":"https://littlebees.github.io/2020/07/%E9%9A%A8%E4%BE%BF%E7%9A%84sql%E7%AD%86%E8%A8%98/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"隨便的sql筆記","name":"隨便的sql筆記","description":"動機 整理一些sql的用法\n把SQL當成一種奇怪的PL 與awk有點像，SQL的溝通單位只有類似matrix的資料結構 不過這個matrix沒辦法用index取值\n同時每家DBMS的實作又有點差別像是CTE的部分就差很多\n產生matrix(table) subquery 最基本的產生matrix的手段 最好都要替每個subquery加命名\nSELECT P_Name FROM products_taiwan WHERE P_Name NOT IN (SELECT P_Name FROM products_china) china; view 當成matrix的抽象\nCREATE VIEW V_Customer AS (SELECT First_Name, Last_Name, Country FROM Customer); function (\u0026amp; stored procedure) 可以產生table也可以產生value\nCREATE FUNCTION Sales.ufn_SalesByStore (@storeid int) RETURNS TABLE AS RETURN ( SELECT P.ProductID, P.Name, SUM(SD.LineTotal) AS \u0026#39;Total\u0026#39; FROM Production.Product AS P JOIN Sales.SalesOrderDetail AS SD ON SD.ProductID = P.ProductID JOIN Sales.SalesOrderHeader AS SH ON SH.","keywords":[],"articleBody":"動機 整理一些sql的用法\n把SQL當成一種奇怪的PL 與awk有點像，SQL的溝通單位只有類似matrix的資料結構 不過這個matrix沒辦法用index取值\n同時每家DBMS的實作又有點差別像是CTE的部分就差很多\n產生matrix(table) subquery 最基本的產生matrix的手段 最好都要替每個subquery加命名\nSELECT P_Name FROM products_taiwan WHERE P_Name NOT IN (SELECT P_Name FROM products_china) china; view 當成matrix的抽象\nCREATE VIEW V_Customer AS (SELECT First_Name, Last_Name, Country FROM Customer); function (\u0026 stored procedure) 可以產生table也可以產生value\nCREATE FUNCTION Sales.ufn_SalesByStore (@storeid int) RETURNS TABLE AS RETURN ( SELECT P.ProductID, P.Name, SUM(SD.LineTotal) AS 'Total' FROM Production.Product AS P JOIN Sales.SalesOrderDetail AS SD ON SD.ProductID = P.ProductID JOIN Sales.SalesOrderHeader AS SH ON SH.SalesOrderID = SD.SalesOrderID JOIN Sales.Customer AS C ON SH.CustomerID = C.CustomerID WHERE C.StoreID = @storeid GROUP BY P.ProductID, P.Name ); procedure基本上就是把指令打包在一起 但沒有回傳值\nCREATE PROCEDURE HumanResources.uspGetEmployeesTest2 @LastName nvarchar(50), @FirstName nvarchar(50) AS SELECT FirstName, LastName, Department FROM HumanResources.vEmployeeDepartmentHistory WHERE FirstName = @FirstName AND LastName = @LastName AND EndDate IS NULL; GO 從python來看sql assign EmpIDVariable = max([row['EmployeeID'] for row in HumanResources.Employee]) DECLARE @EmpIDVariable int; SELECT @EmpIDVariable = MAX(EmployeeID) FROM HumanResources.Employee; while MyCounter = 0 TestTable = [] # queue while MyCounter \u003c 26: TestTable.append((MyCounter,char(int('a')+MyCounter))) MyCounter += 1 DECLARE @MyCounter int; SET @MyCounter = 0; WHILE (@MyCounter \u003c 26) BEGIN; INSERT INTO TestTable VALUES (@MyCounter, CHAR((@MyCounter + ASCII('a')))); SET @MyCounter = @MyCounter + 1; END; cursor 基本款 vend_cursor = iter(Purchasing.Vendor) next(vend_cursor) DECLARE vend_cursor CURSOR FOR SELECT * FROM Purchasing.Vendor OPEN vend_cursor FETCH NEXT FROM vend_cursor; 兩個iterator 為什麼要提兩個的iterator? 因為sql的has_next是變數 所以比較特別 所以再貼一個例子\nvendor_id, vendor_name, message, product = (0,'','','') print('-------- Vendor Products Report --------') vendor_cursor = iter(sorted([{'VendorID': row['VendorID'], 'Name': row['Name']} for row in Purchasing.Vendor if row['PreferredVendorStatus'] == 1],key=lambda row: row['VendorID'])) vendor_id, vendor_name = next(vendor_cursor) # it's tedious to access each element by key, so imagine it can be done by deconstruct \u003e_! while has_next(vendor_cursor): ''' In fact, WHILE @@FETCH_STATUS = 0 is euqal to while hasnext(vendor_cursor). However, python don't have hasnext for its iterator. Instead, python iterator will throw an exception at the end of iteration. Here, imagine we have has_next() in python, okay. ''' print(' ') message = '----- Products From Vendor: ' + vendor_name print(message) product_cursor = iter([...]) # it's tedious to implement this, so skip it product = next(product_cursor) for product in product_cursor: message = ' ' + product # python iterator need not to be deallocated, after it accomplish its purpose vendor_id, vendor_name = next(vendor_cursor) # python iterator need not to be deallocated, after it accomplish its purpose DECLARE @vendor_id int, @vendor_name nvarchar(50), @message varchar(80), @product nvarchar(50); PRINT '-------- Vendor Products Report --------'; DECLARE vendor_cursor CURSOR FOR SELECT VendorID, Name FROM Purchasing.Vendor WHERE PreferredVendorStatus = 1 ORDER BY VendorID; OPEN vendor_cursor FETCH NEXT FROM vendor_cursor INTO @vendor_id, @vendor_name WHILE @@FETCH_STATUS = 0 BEGIN PRINT ' ' SELECT @message = '----- Products From Vendor: ' + @vendor_name PRINT @message DECLARE product_cursor CURSOR FOR SELECT v.Name FROM Purchasing.ProductVendor pv, Production.Product v WHERE pv.ProductID = v.ProductID AND pv.VendorID = @vendor_id -- Variable value from the outer cursor OPEN product_cursor FETCH NEXT FROM product_cursor INTO @product IF @@FETCH_STATUS \u003c\u003e 0 PRINT ' \u003c\u003e' WHILE @@FETCH_STATUS = 0 BEGIN SELECT @message = ' ' + @product PRINT @message FETCH NEXT FROM product_cursor INTO @product END CLOSE product_cursor DEALLOCATE product_cursor FETCH NEXT FROM vendor_cursor INTO @vendor_id, @vendor_name END CLOSE vendor_cursor; DEALLOCATE vendor_cursor; case 有趣的部份是除了回傳data外，還可以回傳column name\nSELECT OrderID, Quantity, CASE WHEN Quantity \u003e 30 THEN 'The quantity is greater than 30' WHEN Quantity = 30 THEN 'The quantity is 30' ELSE 'The quantity is under 30' END AS QuantityText FROM OrderDetails; SELECT CustomerName, City, Country FROM Customers ORDER BY (CASE WHEN City IS NULL THEN Country ELSE City END); 遞迴 (table as queue) When we iterate a tbale in sql, the only element we can access is the first row of its table. And then, the second, the third and so on.\nWhen we want to insert a new row to a table, this row will be inserted at the tail of the table.\nWait, it’s like something we are familiar with.\nQueue!!\nWITH node AS --queue declare ( SELECT id,parentid,num FROM testtable AS TREE WHERE parentid = 0 UNION ALL /* init argument where we start bfs */ -- enqueue the neighbors SELECT TREE.id,TREE.parentid,TREE.num FROM testtable AS TREE INNER JOIN node AS QUEUE ON QUEUE.id = TREE.parentid /*從bfs的節點找下一個node，推到queue*/ ) SELECT QUEUE.id,Count(TREE.id) AS subnode FROM node AS QUEUE LEFT JOIN testtable AS TREE ON QUEUE.id = TREE.parentid GROUP BY QUEUE.id 最短路徑 source\nWITH paths (node, path, cost, rnk, lev) AS ( -- priority queue SELECT a.dst, a.src || ',' || a.dst, a.distance, 1, 1 FROM arcs a WHERE a.src = :SRC UNION ALL SELECT a.dst, p.path || ',' || a.dst, p.cost + a.distance, Rank () OVER (PARTITION BY a.dst ORDER BY p.cost + a.distance), -- tree被更新就sort一次quere(part of this table) p.lev + 1 FROM paths p JOIN arcs a ON a.src = p.node AND p.rnk = 1 ) SEARCH DEPTH FIRST BY node SET line_no -- oracle DB的CTE特別語法: 用什麼方式traversal -- 這邊改成bfs應該沒關係，但沒試驗過 CYCLE node SET lp TO '*' DEFAULT ' ' -- oracle DB的CTE特別語法: 要判斷cycle -- 上面把所有路線都展開，在展開同時對目前找到的做sort , paths_ranked AS ( SELECT lev, node, path, cost, Rank () OVER (PARTITION BY node ORDER BY cost) rnk_t, lp, line_no FROM paths WHERE rnk = 1 ) -- 從每個queue挑出最好的結果 SELECT LPad (node, 1 + 2* (lev - 1), '.') node, lev, path, cost, lp FROM paths_ranked WHERE rnk_t = 1 ORDER BY line_no -- print result ","wordCount":"855","inLanguage":"en","image":"https://littlebees.github.io/images/papermod-cover.png","datePublished":"2020-07-18T18:30:42Z","dateModified":"2020-07-18T18:30:42Z","author":{"@type":"Person","name":"zhengcf"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://littlebees.github.io/2020/07/%E9%9A%A8%E4%BE%BF%E7%9A%84sql%E7%AD%86%E8%A8%98/"},"publisher":{"@type":"Organization","name":"記事本","logo":{"@type":"ImageObject","url":"https://littlebees.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://littlebees.github.io/ accesskey=h title="記事本 (Alt + H)">記事本</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://littlebees.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://littlebees.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://littlebees.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://littlebees.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://littlebees.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">隨便的sql筆記</h1><div class=post-meta><span title='2020-07-18 18:30:42 +0000 UTC'>July 18, 2020</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;zhengcf</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%8b%95%e6%a9%9f aria-label=動機>動機</a></li><li><a href=#%e6%8a%8asql%e7%95%b6%e6%88%90%e4%b8%80%e7%a8%ae%e5%a5%87%e6%80%aa%e7%9a%84pl aria-label=把SQL當成一種奇怪的PL>把SQL當成一種奇怪的PL</a></li><li><a href=#%e7%94%a2%e7%94%9fmatrixtable aria-label=產生matrix(table)>產生matrix(table)</a><ul><li><a href=#subquery aria-label=subquery>subquery</a></li><li><a href=#view aria-label=view>view</a></li><li><a href=#function--stored-procedure aria-label="function (& stored procedure)">function (& stored procedure)</a></li></ul></li><li><a href=#%e5%be%9epython%e4%be%86%e7%9c%8bsql aria-label=從python來看sql>從python來看sql</a><ul><li><a href=#assign aria-label=assign>assign</a></li><li><a href=#while aria-label=while>while</a></li><li><a href=#cursor aria-label=cursor>cursor</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e6%ac%be aria-label=基本款>基本款</a></li><li><a href=#%e5%85%a9%e5%80%8biterator aria-label=兩個iterator>兩個iterator</a></li></ul></li><li><a href=#case aria-label=case>case</a></li></ul></li><li><a href=#%e9%81%9e%e8%bf%b4-table-as-queue aria-label="遞迴 (table as queue)">遞迴 (table as queue)</a><ul><li><a href=#%e6%9c%80%e7%9f%ad%e8%b7%af%e5%be%91 aria-label=最短路徑>最短路徑</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=動機>動機<a hidden class=anchor aria-hidden=true href=#動機>#</a></h2><p>整理一些sql的用法</p><h2 id=把sql當成一種奇怪的pl>把SQL當成一種奇怪的PL<a hidden class=anchor aria-hidden=true href=#把sql當成一種奇怪的pl>#</a></h2><p>與awk有點像，SQL的溝通單位只有類似matrix的資料結構
不過這個matrix沒辦法用index取值</p><p>同時每家DBMS的實作又有點差別像是CTE的部分就差很多</p><h2 id=產生matrixtable>產生matrix(table)<a hidden class=anchor aria-hidden=true href=#產生matrixtable>#</a></h2><h3 id=subquery>subquery<a hidden class=anchor aria-hidden=true href=#subquery>#</a></h3><p>最基本的產生matrix的手段
最好都要替每個subquery加命名</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>P_Name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>products_taiwan</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>P_Name</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=k>IN</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>P_Name</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>products_china</span><span class=p>)</span><span class=w> </span><span class=n>china</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=view>view<a hidden class=anchor aria-hidden=true href=#view>#</a></h3><p>當成matrix的抽象</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>VIEW</span><span class=w> </span><span class=n>V_Customer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=k>SELECT</span><span class=w> </span><span class=n>First_Name</span><span class=p>,</span><span class=w> </span><span class=n>Last_Name</span><span class=p>,</span><span class=w> </span><span class=n>Country</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Customer</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h3 id=function--stored-procedure>function (& stored procedure)<a hidden class=anchor aria-hidden=true href=#function--stored-procedure>#</a></h3><p>可以產生table也可以產生value</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>FUNCTION</span><span class=w> </span><span class=n>Sales</span><span class=p>.</span><span class=n>ufn_SalesByStore</span><span class=w> </span><span class=p>(</span><span class=o>@</span><span class=n>storeid</span><span class=w> </span><span class=nb>int</span><span class=p>)</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>RETURNS</span><span class=w> </span><span class=k>TABLE</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AS</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>RETURN</span><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>P</span><span class=p>.</span><span class=n>ProductID</span><span class=p>,</span><span class=w> </span><span class=n>P</span><span class=p>.</span><span class=n>Name</span><span class=p>,</span><span class=w> </span><span class=k>SUM</span><span class=p>(</span><span class=n>SD</span><span class=p>.</span><span class=n>LineTotal</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s1>&#39;Total&#39;</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>Production</span><span class=p>.</span><span class=n>Product</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>P</span><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>JOIN</span><span class=w> </span><span class=n>Sales</span><span class=p>.</span><span class=n>SalesOrderDetail</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>SD</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>SD</span><span class=p>.</span><span class=n>ProductID</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>P</span><span class=p>.</span><span class=n>ProductID</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>JOIN</span><span class=w> </span><span class=n>Sales</span><span class=p>.</span><span class=n>SalesOrderHeader</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>SH</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>SH</span><span class=p>.</span><span class=n>SalesOrderID</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SD</span><span class=p>.</span><span class=n>SalesOrderID</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>JOIN</span><span class=w> </span><span class=n>Sales</span><span class=p>.</span><span class=n>Customer</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=k>C</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>SH</span><span class=p>.</span><span class=n>CustomerID</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>C</span><span class=p>.</span><span class=n>CustomerID</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=k>C</span><span class=p>.</span><span class=n>StoreID</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>@</span><span class=n>storeid</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>P</span><span class=p>.</span><span class=n>ProductID</span><span class=p>,</span><span class=w> </span><span class=n>P</span><span class=p>.</span><span class=n>Name</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>);</span><span class=w>  
</span></span></span></code></pre></div><p>procedure基本上就是把指令打包在一起
但沒有回傳值</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>PROCEDURE</span><span class=w> </span><span class=n>HumanResources</span><span class=p>.</span><span class=n>uspGetEmployeesTest2</span><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>@</span><span class=n>LastName</span><span class=w> </span><span class=n>nvarchar</span><span class=p>(</span><span class=mi>50</span><span class=p>),</span><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>@</span><span class=n>FirstName</span><span class=w> </span><span class=n>nvarchar</span><span class=p>(</span><span class=mi>50</span><span class=p>)</span><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>AS</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>FirstName</span><span class=p>,</span><span class=w> </span><span class=n>LastName</span><span class=p>,</span><span class=w> </span><span class=n>Department</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>HumanResources</span><span class=p>.</span><span class=n>vEmployeeDepartmentHistory</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>FirstName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>@</span><span class=n>FirstName</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>LastName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>@</span><span class=n>LastName</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>EndDate</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NULL</span><span class=p>;</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GO</span><span class=w>  
</span></span></span></code></pre></div><h2 id=從python來看sql>從python來看sql<a hidden class=anchor aria-hidden=true href=#從python來看sql>#</a></h2><h3 id=assign>assign<a hidden class=anchor aria-hidden=true href=#assign>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>EmpIDVariable</span> <span class=o>=</span> <span class=nb>max</span><span class=p>([</span><span class=n>row</span><span class=p>[</span><span class=s1>&#39;EmployeeID&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>HumanResources</span><span class=o>.</span><span class=n>Employee</span><span class=p>])</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DECLARE</span><span class=w> </span><span class=o>@</span><span class=n>EmpIDVariable</span><span class=w> </span><span class=nb>int</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=o>@</span><span class=n>EmpIDVariable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>MAX</span><span class=p>(</span><span class=n>EmployeeID</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>HumanResources</span><span class=p>.</span><span class=n>Employee</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=while>while<a hidden class=anchor aria-hidden=true href=#while>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>MyCounter</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>TestTable</span> <span class=o>=</span> <span class=p>[]</span> <span class=c1># queue</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>MyCounter</span> <span class=o>&lt;</span> <span class=mi>26</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>TestTable</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>MyCounter</span><span class=p>,</span><span class=n>char</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=p>)</span><span class=o>+</span><span class=n>MyCounter</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=n>MyCounter</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DECLARE</span><span class=w> </span><span class=o>@</span><span class=n>MyCounter</span><span class=w> </span><span class=nb>int</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SET</span><span class=w> </span><span class=o>@</span><span class=n>MyCounter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>WHILE</span><span class=w> </span><span class=p>(</span><span class=o>@</span><span class=n>MyCounter</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>26</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=k>INSERT</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=n>TestTable</span><span class=w> </span><span class=k>VALUES</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=p>(</span><span class=o>@</span><span class=n>MyCounter</span><span class=p>,</span><span class=w> </span><span class=nb>CHAR</span><span class=p>((</span><span class=o>@</span><span class=n>MyCounter</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>ASCII</span><span class=p>(</span><span class=s1>&#39;a&#39;</span><span class=p>))));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=k>SET</span><span class=w> </span><span class=o>@</span><span class=n>MyCounter</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>@</span><span class=n>MyCounter</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><h3 id=cursor>cursor<a hidden class=anchor aria-hidden=true href=#cursor>#</a></h3><h4 id=基本款>基本款<a hidden class=anchor aria-hidden=true href=#基本款>#</a></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>vend_cursor</span> <span class=o>=</span> <span class=nb>iter</span><span class=p>(</span><span class=n>Purchasing</span><span class=o>.</span><span class=n>Vendor</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>next</span><span class=p>(</span><span class=n>vend_cursor</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DECLARE</span><span class=w> </span><span class=n>vend_cursor</span><span class=w> </span><span class=k>CURSOR</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FOR</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>Purchasing</span><span class=p>.</span><span class=n>Vendor</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>OPEN</span><span class=w> </span><span class=n>vend_cursor</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FETCH</span><span class=w> </span><span class=k>NEXT</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>vend_cursor</span><span class=p>;</span><span class=w>  
</span></span></span></code></pre></div><h4 id=兩個iterator>兩個iterator<a hidden class=anchor aria-hidden=true href=#兩個iterator>#</a></h4><p>為什麼要提兩個的iterator?
因為sql的has_next是變數
所以比較特別 所以再貼一個例子</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>vendor_id</span><span class=p>,</span> <span class=n>vendor_name</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>product</span> <span class=o>=</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;-------- Vendor Products Report --------&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>vendor_cursor</span> <span class=o>=</span> <span class=nb>iter</span><span class=p>(</span><span class=nb>sorted</span><span class=p>([{</span><span class=s1>&#39;VendorID&#39;</span><span class=p>:</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;VendorID&#39;</span><span class=p>],</span> <span class=s1>&#39;Name&#39;</span><span class=p>:</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;Name&#39;</span><span class=p>]}</span> <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>Purchasing</span><span class=o>.</span><span class=n>Vendor</span> <span class=k>if</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;PreferredVendorStatus&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=mi>1</span><span class=p>],</span><span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>row</span><span class=p>:</span> <span class=n>row</span><span class=p>[</span><span class=s1>&#39;VendorID&#39;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl><span class=n>vendor_id</span><span class=p>,</span> <span class=n>vendor_name</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>vendor_cursor</span><span class=p>)</span> <span class=c1># it&#39;s tedious to access each element by key, so imagine it can be done by deconstruct &gt;_!</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>has_next</span><span class=p>(</span><span class=n>vendor_cursor</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>    In fact, WHILE @@FETCH_STATUS = 0  is euqal to while hasnext(vendor_cursor).
</span></span></span><span class=line><span class=cl><span class=s1>    However, python don&#39;t have hasnext for its iterator.
</span></span></span><span class=line><span class=cl><span class=s1>    Instead, python iterator will throw an exception at the end of iteration.
</span></span></span><span class=line><span class=cl><span class=s1>    Here, imagine we have has_next() in python, okay.
</span></span></span><span class=line><span class=cl><span class=s1>    &#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=s1>&#39;----- Products From Vendor: &#39;</span> <span class=o>+</span> <span class=n>vendor_name</span> 
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>product_cursor</span> <span class=o>=</span> <span class=nb>iter</span><span class=p>([</span><span class=o>...</span><span class=p>])</span> <span class=c1># it&#39;s tedious to implement this, so skip it</span>
</span></span><span class=line><span class=cl>    <span class=n>product</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>product_cursor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>product</span> <span class=ow>in</span> <span class=n>product_cursor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span> <span class=o>=</span> <span class=s1>&#39;         &#39;</span> <span class=o>+</span> <span class=n>product</span>
</span></span><span class=line><span class=cl>    <span class=c1># python iterator need not to be deallocated, after it accomplish its purpose</span>
</span></span><span class=line><span class=cl>    <span class=n>vendor_id</span><span class=p>,</span> <span class=n>vendor_name</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>vendor_cursor</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># python iterator need not to be deallocated, after it accomplish its purpose</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>DECLARE</span><span class=w> </span><span class=o>@</span><span class=n>vendor_id</span><span class=w> </span><span class=nb>int</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>vendor_name</span><span class=w> </span><span class=n>nvarchar</span><span class=p>(</span><span class=mi>50</span><span class=p>),</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=o>@</span><span class=n>message</span><span class=w> </span><span class=nb>varchar</span><span class=p>(</span><span class=mi>80</span><span class=p>),</span><span class=w> </span><span class=o>@</span><span class=n>product</span><span class=w> </span><span class=n>nvarchar</span><span class=p>(</span><span class=mi>50</span><span class=p>);</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>PRINT</span><span class=w> </span><span class=s1>&#39;-------- Vendor Products Report --------&#39;</span><span class=p>;</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DECLARE</span><span class=w> </span><span class=n>vendor_cursor</span><span class=w> </span><span class=k>CURSOR</span><span class=w> </span><span class=k>FOR</span><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>VendorID</span><span class=p>,</span><span class=w> </span><span class=n>Name</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>Purchasing</span><span class=p>.</span><span class=n>Vendor</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>PreferredVendorStatus</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>VendorID</span><span class=p>;</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>OPEN</span><span class=w> </span><span class=n>vendor_cursor</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FETCH</span><span class=w> </span><span class=k>NEXT</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>vendor_cursor</span><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>INTO</span><span class=w> </span><span class=o>@</span><span class=n>vendor_id</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>vendor_name</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>WHILE</span><span class=w> </span><span class=o>@@</span><span class=n>FETCH_STATUS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>BEGIN</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PRINT</span><span class=w> </span><span class=s1>&#39; &#39;</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=o>@</span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;----- Products From Vendor: &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=o>@</span><span class=n>vendor_name</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PRINT</span><span class=w> </span><span class=o>@</span><span class=n>message</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>DECLARE</span><span class=w> </span><span class=n>product_cursor</span><span class=w> </span><span class=k>CURSOR</span><span class=w> </span><span class=k>FOR</span><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>Name</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FROM</span><span class=w> </span><span class=n>Purchasing</span><span class=p>.</span><span class=n>ProductVendor</span><span class=w> </span><span class=n>pv</span><span class=p>,</span><span class=w> </span><span class=n>Production</span><span class=p>.</span><span class=n>Product</span><span class=w> </span><span class=n>v</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>pv</span><span class=p>.</span><span class=n>ProductID</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>v</span><span class=p>.</span><span class=n>ProductID</span><span class=w> </span><span class=k>AND</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>pv</span><span class=p>.</span><span class=n>VendorID</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>@</span><span class=n>vendor_id</span><span class=w>  </span><span class=c1>-- Variable value from the outer cursor  
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>OPEN</span><span class=w> </span><span class=n>product_cursor</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FETCH</span><span class=w> </span><span class=k>NEXT</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>product_cursor</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>@</span><span class=n>product</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>IF</span><span class=w> </span><span class=o>@@</span><span class=n>FETCH_STATUS</span><span class=w> </span><span class=o>&lt;&gt;</span><span class=w> </span><span class=mi>0</span><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PRINT</span><span class=w> </span><span class=s1>&#39;         &lt;&lt;None&gt;&gt;&#39;</span><span class=w>       
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>WHILE</span><span class=w> </span><span class=o>@@</span><span class=n>FETCH_STATUS</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>BEGIN</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>SELECT</span><span class=w> </span><span class=o>@</span><span class=n>message</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;         &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=o>@</span><span class=n>product</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>PRINT</span><span class=w> </span><span class=o>@</span><span class=n>message</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>FETCH</span><span class=w> </span><span class=k>NEXT</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>product_cursor</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>@</span><span class=n>product</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>END</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>CLOSE</span><span class=w> </span><span class=n>product_cursor</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>DEALLOCATE</span><span class=w> </span><span class=n>product_cursor</span><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>FETCH</span><span class=w> </span><span class=k>NEXT</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>vendor_cursor</span><span class=w> </span><span class=k>INTO</span><span class=w> </span><span class=o>@</span><span class=n>vendor_id</span><span class=p>,</span><span class=w> </span><span class=o>@</span><span class=n>vendor_name</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w>   
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CLOSE</span><span class=w> </span><span class=n>vendor_cursor</span><span class=p>;</span><span class=w>  
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>DEALLOCATE</span><span class=w> </span><span class=n>vendor_cursor</span><span class=p>;</span><span class=w>  
</span></span></span></code></pre></div><h3 id=case>case<a hidden class=anchor aria-hidden=true href=#case>#</a></h3><p>有趣的部份是除了回傳data外，還可以回傳column name</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>OrderID</span><span class=p>,</span><span class=w> </span><span class=n>Quantity</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>CASE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHEN</span><span class=w> </span><span class=n>Quantity</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>30</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>&#39;The quantity is greater than 30&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHEN</span><span class=w> </span><span class=n>Quantity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>30</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=s1>&#39;The quantity is 30&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>ELSE</span><span class=w> </span><span class=s1>&#39;The quantity is under 30&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>QuantityText</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>OrderDetails</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>CustomerName</span><span class=p>,</span><span class=w> </span><span class=n>City</span><span class=p>,</span><span class=w> </span><span class=n>Country</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>Customers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=k>CASE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHEN</span><span class=w> </span><span class=n>City</span><span class=w> </span><span class=k>IS</span><span class=w> </span><span class=k>NULL</span><span class=w> </span><span class=k>THEN</span><span class=w> </span><span class=n>Country</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>ELSE</span><span class=w> </span><span class=n>City</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>END</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><h2 id=遞迴-table-as-queue>遞迴 (table as queue)<a hidden class=anchor aria-hidden=true href=#遞迴-table-as-queue>#</a></h2><p><img loading=lazy src=https://dotblogsfile.blob.core.windows.net/user/justforgood/1401/201412821616233.png alt>
<img loading=lazy src=https://dotblogsfile.blob.core.windows.net/user/justforgood/1401/201412821141782.png alt>
When we iterate a tbale in sql, the only element we can access is the first row of its table.
And then, the second, the third and so on.</p><p>When we want to insert a new row to a table, this row will be inserted at the tail of the table.</p><p>Wait, it&rsquo;s like something we are familiar with.</p><p>Queue!!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>WITH</span><span class=w> </span><span class=n>node</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=c1>--queue declare
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=n>parentid</span><span class=p>,</span><span class=n>num</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>testtable</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>TREE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>WHERE</span><span class=w> </span><span class=n>parentid</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=k>UNION</span><span class=w> </span><span class=k>ALL</span><span class=w> </span><span class=cm>/* init argument where we start bfs */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>-- enqueue the neighbors
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>    </span><span class=k>SELECT</span><span class=w> </span><span class=n>TREE</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=n>TREE</span><span class=p>.</span><span class=n>parentid</span><span class=p>,</span><span class=n>TREE</span><span class=p>.</span><span class=n>num</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>testtable</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>TREE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>INNER</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>node</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>QUEUE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>ON</span><span class=w> </span><span class=n>QUEUE</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TREE</span><span class=p>.</span><span class=n>parentid</span><span class=w> </span><span class=cm>/*從bfs的節點找下一個node，推到queue*/</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>QUEUE</span><span class=p>.</span><span class=n>id</span><span class=p>,</span><span class=k>Count</span><span class=p>(</span><span class=n>TREE</span><span class=p>.</span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>subnode</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>node</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>QUEUE</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>LEFT</span><span class=w> </span><span class=k>JOIN</span><span class=w> </span><span class=n>testtable</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=n>TREE</span><span class=w> </span><span class=k>ON</span><span class=w> </span><span class=n>QUEUE</span><span class=p>.</span><span class=n>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>TREE</span><span class=p>.</span><span class=n>parentid</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>GROUP</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>QUEUE</span><span class=p>.</span><span class=n>id</span><span class=w>
</span></span></span></code></pre></div><h3 id=最短路徑>最短路徑<a hidden class=anchor aria-hidden=true href=#最短路徑>#</a></h3><p><a href="http://aprogrammerwrites.eu/?p=1391">source</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>WITH</span><span class=w> </span><span class=n>paths</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>path</span><span class=p>,</span><span class=w> </span><span class=n>cost</span><span class=p>,</span><span class=w> </span><span class=n>rnk</span><span class=p>,</span><span class=w> </span><span class=n>lev</span><span class=p>)</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w> </span><span class=c1>-- priority queue
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>	</span><span class=k>SELECT</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>dst</span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>src</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s1>&#39;,&#39;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>dst</span><span class=p>,</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>distance</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=n>arcs</span><span class=w> </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>WHERE</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>src</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>:</span><span class=n>SRC</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 	</span><span class=k>UNION</span><span class=w> </span><span class=k>ALL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>SELECT</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>dst</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>p</span><span class=p>.</span><span class=n>path</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=s1>&#39;,&#39;</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>dst</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>p</span><span class=p>.</span><span class=n>cost</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>distance</span><span class=p>,</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=n>Rank</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>dst</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>cost</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>distance</span><span class=p>),</span><span class=w> </span><span class=c1>-- tree被更新就sort一次quere(part of this table)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=w>		</span><span class=n>p</span><span class=p>.</span><span class=n>lev</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>FROM</span><span class=w> </span><span class=n>paths</span><span class=w> </span><span class=n>p</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>JOIN</span><span class=w> </span><span class=n>arcs</span><span class=w> </span><span class=n>a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>ON</span><span class=w> </span><span class=n>a</span><span class=p>.</span><span class=n>src</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>node</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>AND</span><span class=w> </span><span class=n>p</span><span class=p>.</span><span class=n>rnk</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>  </span><span class=k>SEARCH</span><span class=w> </span><span class=n>DEPTH</span><span class=w> </span><span class=k>FIRST</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>node</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>line_no</span><span class=w> </span><span class=c1>-- oracle DB的CTE特別語法: 用什麼方式traversal -- 這邊改成bfs應該沒關係，但沒試驗過
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>CYCLE</span><span class=w> </span><span class=n>node</span><span class=w> </span><span class=k>SET</span><span class=w> </span><span class=n>lp</span><span class=w> </span><span class=k>TO</span><span class=w> </span><span class=s1>&#39;*&#39;</span><span class=w> </span><span class=k>DEFAULT</span><span class=w> </span><span class=s1>&#39; &#39;</span><span class=w> </span><span class=c1>-- oracle DB的CTE特別語法: 要判斷cycle 
</span></span></span><span class=line><span class=cl><span class=c1>-- 上面把所有路線都展開，在展開同時對目前找到的做sort
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>,</span><span class=w> </span><span class=n>paths_ranked</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>SELECT</span><span class=w> </span><span class=n>lev</span><span class=p>,</span><span class=w> </span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>path</span><span class=p>,</span><span class=w> </span><span class=n>cost</span><span class=p>,</span><span class=w> </span><span class=n>Rank</span><span class=w> </span><span class=p>()</span><span class=w> </span><span class=n>OVER</span><span class=w> </span><span class=p>(</span><span class=n>PARTITION</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>node</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>cost</span><span class=p>)</span><span class=w> </span><span class=n>rnk_t</span><span class=p>,</span><span class=w> </span><span class=n>lp</span><span class=p>,</span><span class=w> </span><span class=n>line_no</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>FROM</span><span class=w> </span><span class=n>paths</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>WHERE</span><span class=w> </span><span class=n>rnk</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- 從每個queue挑出最好的結果
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>SELECT</span><span class=w> </span><span class=n>LPad</span><span class=w> </span><span class=p>(</span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=mi>2</span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=n>lev</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=mi>1</span><span class=p>),</span><span class=w> </span><span class=s1>&#39;.&#39;</span><span class=p>)</span><span class=w> </span><span class=n>node</span><span class=p>,</span><span class=w> </span><span class=n>lev</span><span class=p>,</span><span class=w> </span><span class=n>path</span><span class=p>,</span><span class=w> </span><span class=n>cost</span><span class=p>,</span><span class=w> </span><span class=n>lp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>FROM</span><span class=w> </span><span class=n>paths_ranked</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>WHERE</span><span class=w> </span><span class=n>rnk_t</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=n>line_no</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>-- print result
</span></span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://littlebees.github.io/2020/07/%E9%9A%A8%E6%84%8Fiptables%E7%AD%86%E8%A8%98/><span class=title>« Prev</span><br><span>隨意iptables筆記</span>
</a><a class=next href=https://littlebees.github.io/2020/07/leetcode%E7%9A%84bash%E9%A1%8C%E7%9B%AE%E5%80%91/><span class=title>Next »</span><br><span>leetcode的bash題目們</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://littlebees.github.io/>記事本</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>