<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>The Little MLer 筆記 | 記事本</title>
<meta name=keywords content><meta name=description content="ch0: 執行環境 想用wsl來跑sml的話，poly/ml是不錯的選項
ch1: 定義type datatype num = ZERO | ONE_MORE of num datatype ‘a Slist = NIL of ‘a | SCONS of ‘a Slist ch2: 寫function datatype Abc = A | B of Abc | C of Abc fun only_B(A) = true | only_B(B(x)) = only_B(x) | only_B(C(x)) = false (only_B : Abc -> bool) datatype ‘a Xyz = X of ‘a | Y of ‘a Xyz | Z of ‘a Xyz fun is_xy(X(x)) = true | is_xy(Y(x)) = is_xy(x) | is_xy(Z(x)) = false (is_xy : ‘a Xyz -> bool) ch3: 在list上遞迴 fun rem_B(A) = A | rem_B(B(x)) = rem_B(x) | rem_B(C(x)) = C(rem_B(x)) fun C_in_fron_of_B(A) = A | C_in_fron_of_B(B(x)) = C(B(C_in_fron_of_B(x))) | C_in_fron_of_B(C(x)) = C(C_in_fron_of_B(x)) fun subst_B_C(x) = rem_B(C_in_fron_of_B(x)) (* OR *) fun subst_B_C(A) = A | subst_B_C(B(x)) = C(subst_B_C(x)) | subst_B_C(C(x)) = C(subst_B_C(x)) (* 都是走訪同一list故可以用同一種走訪，把兩個式子結合起來(map fusion) *) ch4: tuple & 多參數function (A,X,A) :: (Abc * Xyz * Abc) datatype Abc = A | B | C fun add_a(A) = (A,A) | add_a(B) = (B,A) | add_a = (C,A) (add_a : Abc -> (Abc * Abc)) 可以利用type variable來打少一點字"><meta name=author content="zhengcf"><link rel=canonical href=https://littlebees.github.io/2020/05/the-little-mler-%E7%AD%86%E8%A8%98/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://littlebees.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://littlebees.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://littlebees.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://littlebees.github.io/apple-touch-icon.png><link rel=mask-icon href=https://littlebees.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://littlebees.github.io/2020/05/the-little-mler-%E7%AD%86%E8%A8%98/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="The Little MLer 筆記"><meta property="og:description" content="ch0: 執行環境 想用wsl來跑sml的話，poly/ml是不錯的選項
ch1: 定義type datatype num = ZERO | ONE_MORE of num datatype ‘a Slist = NIL of ‘a | SCONS of ‘a Slist ch2: 寫function datatype Abc = A | B of Abc | C of Abc fun only_B(A) = true | only_B(B(x)) = only_B(x) | only_B(C(x)) = false (only_B : Abc -> bool) datatype ‘a Xyz = X of ‘a | Y of ‘a Xyz | Z of ‘a Xyz fun is_xy(X(x)) = true | is_xy(Y(x)) = is_xy(x) | is_xy(Z(x)) = false (is_xy : ‘a Xyz -> bool) ch3: 在list上遞迴 fun rem_B(A) = A | rem_B(B(x)) = rem_B(x) | rem_B(C(x)) = C(rem_B(x)) fun C_in_fron_of_B(A) = A | C_in_fron_of_B(B(x)) = C(B(C_in_fron_of_B(x))) | C_in_fron_of_B(C(x)) = C(C_in_fron_of_B(x)) fun subst_B_C(x) = rem_B(C_in_fron_of_B(x)) (* OR *) fun subst_B_C(A) = A | subst_B_C(B(x)) = C(subst_B_C(x)) | subst_B_C(C(x)) = C(subst_B_C(x)) (* 都是走訪同一list故可以用同一種走訪，把兩個式子結合起來(map fusion) *) ch4: tuple & 多參數function (A,X,A) :: (Abc * Xyz * Abc) datatype Abc = A | B | C fun add_a(A) = (A,A) | add_a(B) = (B,A) | add_a = (C,A) (add_a : Abc -> (Abc * Abc)) 可以利用type variable來打少一點字"><meta property="og:type" content="article"><meta property="og:url" content="https://littlebees.github.io/2020/05/the-little-mler-%E7%AD%86%E8%A8%98/"><meta property="og:image" content="https://littlebees.github.io/images/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-24T23:07:10+00:00"><meta property="article:modified_time" content="2020-05-24T23:07:10+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://littlebees.github.io/images/papermod-cover.png"><meta name=twitter:title content="The Little MLer 筆記"><meta name=twitter:description content="ch0: 執行環境 想用wsl來跑sml的話，poly/ml是不錯的選項
ch1: 定義type datatype num = ZERO | ONE_MORE of num datatype ‘a Slist = NIL of ‘a | SCONS of ‘a Slist ch2: 寫function datatype Abc = A | B of Abc | C of Abc fun only_B(A) = true | only_B(B(x)) = only_B(x) | only_B(C(x)) = false (only_B : Abc -> bool) datatype ‘a Xyz = X of ‘a | Y of ‘a Xyz | Z of ‘a Xyz fun is_xy(X(x)) = true | is_xy(Y(x)) = is_xy(x) | is_xy(Z(x)) = false (is_xy : ‘a Xyz -> bool) ch3: 在list上遞迴 fun rem_B(A) = A | rem_B(B(x)) = rem_B(x) | rem_B(C(x)) = C(rem_B(x)) fun C_in_fron_of_B(A) = A | C_in_fron_of_B(B(x)) = C(B(C_in_fron_of_B(x))) | C_in_fron_of_B(C(x)) = C(C_in_fron_of_B(x)) fun subst_B_C(x) = rem_B(C_in_fron_of_B(x)) (* OR *) fun subst_B_C(A) = A | subst_B_C(B(x)) = C(subst_B_C(x)) | subst_B_C(C(x)) = C(subst_B_C(x)) (* 都是走訪同一list故可以用同一種走訪，把兩個式子結合起來(map fusion) *) ch4: tuple & 多參數function (A,X,A) :: (Abc * Xyz * Abc) datatype Abc = A | B | C fun add_a(A) = (A,A) | add_a(B) = (B,A) | add_a = (C,A) (add_a : Abc -> (Abc * Abc)) 可以利用type variable來打少一點字"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://littlebees.github.io/posts/"},{"@type":"ListItem","position":2,"name":"The Little MLer 筆記","item":"https://littlebees.github.io/2020/05/the-little-mler-%E7%AD%86%E8%A8%98/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The Little MLer 筆記","name":"The Little MLer 筆記","description":"ch0: 執行環境 想用wsl來跑sml的話，poly/ml是不錯的選項\nch1: 定義type datatype num = ZERO | ONE_MORE of num datatype ‘a Slist = NIL of ‘a | SCONS of ‘a Slist ch2: 寫function datatype Abc = A | B of Abc | C of Abc fun only_B(A) = true | only_B(B(x)) = only_B(x) | only_B(C(x)) = false (only_B : Abc -\u0026gt; bool) datatype ‘a Xyz = X of ‘a | Y of ‘a Xyz | Z of ‘a Xyz fun is_xy(X(x)) = true | is_xy(Y(x)) = is_xy(x) | is_xy(Z(x)) = false (is_xy : ‘a Xyz -\u0026gt; bool) ch3: 在list上遞迴 fun rem_B(A) = A | rem_B(B(x)) = rem_B(x) | rem_B(C(x)) = C(rem_B(x)) fun C_in_fron_of_B(A) = A | C_in_fron_of_B(B(x)) = C(B(C_in_fron_of_B(x))) | C_in_fron_of_B(C(x)) = C(C_in_fron_of_B(x)) fun subst_B_C(x) = rem_B(C_in_fron_of_B(x)) (* OR *) fun subst_B_C(A) = A | subst_B_C(B(x)) = C(subst_B_C(x)) | subst_B_C(C(x)) = C(subst_B_C(x)) (* 都是走訪同一list故可以用同一種走訪，把兩個式子結合起來(map fusion) *) ch4: tuple \u0026amp; 多參數function (A,X,A) :: (Abc * Xyz * Abc) datatype Abc = A | B | C fun add_a(A) = (A,A) | add_a(B) = (B,A) | add_a = (C,A) (add_a : Abc -\u0026gt; (Abc * Abc)) 可以利用type variable來打少一點字","keywords":[],"articleBody":"ch0: 執行環境 想用wsl來跑sml的話，poly/ml是不錯的選項\nch1: 定義type datatype num = ZERO | ONE_MORE of num datatype ‘a Slist = NIL of ‘a | SCONS of ‘a Slist ch2: 寫function datatype Abc = A | B of Abc | C of Abc fun only_B(A) = true | only_B(B(x)) = only_B(x) | only_B(C(x)) = false (only_B : Abc -\u003e bool) datatype ‘a Xyz = X of ‘a | Y of ‘a Xyz | Z of ‘a Xyz fun is_xy(X(x)) = true | is_xy(Y(x)) = is_xy(x) | is_xy(Z(x)) = false (is_xy : ‘a Xyz -\u003e bool) ch3: 在list上遞迴 fun rem_B(A) = A | rem_B(B(x)) = rem_B(x) | rem_B(C(x)) = C(rem_B(x)) fun C_in_fron_of_B(A) = A | C_in_fron_of_B(B(x)) = C(B(C_in_fron_of_B(x))) | C_in_fron_of_B(C(x)) = C(C_in_fron_of_B(x)) fun subst_B_C(x) = rem_B(C_in_fron_of_B(x)) (* OR *) fun subst_B_C(A) = A | subst_B_C(B(x)) = C(subst_B_C(x)) | subst_B_C(C(x)) = C(subst_B_C(x)) (* 都是走訪同一list故可以用同一種走訪，把兩個式子結合起來(map fusion) *) ch4: tuple \u0026 多參數function (A,X,A) :: (Abc * Xyz * Abc) datatype Abc = A | B | C fun add_a(A) = (A,A) | add_a(B) = (B,A) | add_a = (C,A) (add_a : Abc -\u003e (Abc * Abc)) 可以利用type variable來打少一點字\nfun add_a(x) = (x * A) (add_a : ‘a -\u003e (‘a * Abc)) 這個比較抽象，但是比較詳細的(照著datatype產生的fun)可以找出更多可能的錯誤\nfun has_a(a:Xyz, A, b:Xyz) = true | has_a(a:Xyz, b, b:Xyz)) = false (has_a : (Xyz * Abc * Xyz) -\u003e bool) ch5: type的參數可以不只一個 type的參數可以不只一個 datatype ‘a De = D | E of (‘a * (‘a De)) datatype Abc = A | B | C fun rem_a(D) = D | rem_a(E(A,x)) = rem_a(x) | rem_a(E(B,x)) = E(B,rem_a(x)) | rem_a(E(C,x)) = E(C,rem_a(x)) (* shorter version *) fun rem_a(D) = D | rem_a(E(A,x)) = rem_a(x) | rem_a(E(y,x)) = E(y,rem_a(x)) 抽象與組合數 輸入的維度上升，pattern的數量(組合數)上升\nfun rem(x,D) = D | rem(A,E(A,y)) = rem(A, y) | rem(A,E(x,y)) = E(x,rem(A, y)) | rem(B,E(A,y)) = rem(B, y) | rem(B,E(x,y)) = E(x,rem(B, y)) | rem(C,E(C,y)) = rem(C, y) | rem(C,E(x,y)) = E(x,rem(C, y)) (rem : (Abc * Abc De) -\u003e Abc De) 把其中一個維度抽出來，像\nfun eq_Abc(A,A) = true | eq_Abc(B,B) = true | eq_Abc(C,C) = true | eq_Abc(x,y) = false fun rem(x,D) = D | rem(x,E(y,z)) = if eq_Abc(x,y) then rem(x,z) else E(y,rem(x,z)) ch6: 樹形遞迴 datatype tree = E | L of Abc * tree | S of tree * tree datatype ‘a tree = E | F of ‘a * ‘a tree | S of ‘a tree * ‘a tree fun occur_Abc(a,E) = 0 | occur_Abc(a,L(b,x)) = if eq_Abc(a,b) then 1+occur_Abc(a,x) else occur_Abc(a,x) | occur_Abc(a,S(x,y)) = occur_Abc(a,x) + occur_Abc(a,y) sexp \u0026 slist datatype ‘a SList = NIL | SCONS of ‘a Sexp * ‘a SList and ‘a Sexp = ATOM of ‘a | SLIST of ‘a SList fun occur_Abc_SL(a,Nil) = 0 | occur_Abc_SL(a,SCons(x,y)) = occur_abc_SE(a,x) + occur_abc_SL(a,y) and fun occur_Abc_SE(a,Atom(b)) = if eq_Abc(a,b) then 1 else 0 | occur_Abc_SE(a,Slist(x)) = occur_Abc_SL(a,x) 先展開occur_Abc_SE\nfun occur_Abc_SL(a,Nil) = 0 | occur_Abc_SL(a,SCons(Atom(x),y)) = if eq_Abc(a,b) then 1 + occur_abc_SL(a,y) else 0 + occur_abc_SL(a,y) | occur_Abc_SL(a,SCons(Slist(x),y)) = occur_abc_SL(a,x) + occur_abc_SL(a,y) 其實SCons的部分都長的很像，做 抽象與合併 !!\nfun eq_Abc_atom(a,Atom(b)) = eq_Abc(a,b) | eq_Abc_atom(a,Slist(b)) = false fun occur_Abc_SL(a,Nil) = 0 | occur_Abc_SL(a,SCons(x,y)) = if eq_Abc_atom(a,x) then 1+occur_abc_SL(a,y) else occur_Abc_SE(a,x) + occur_abc_SL(a,y) and fun occur_Abc_SE(a,Atom(b)) = 0 | occur_Abc_SE(a,Slist(x)) = occur_Abc_SL(a,x) ch7: first-order function \u0026 stream first-order function \u0026 type inference fun true_mk(x) = true (true_mk : ‘a -\u003e bool) datatype B_or_I = HOT of bool | COLD of int fun help(f) = Hot(true_mk( if true_mk(__) then f else true_mk)) (help : ? -\u003e B_or_I) f的type是什麼? then part與else part的type要一樣，故f的type是’a -\u003e bool\nstream datatype chain = LINK of (int * (int -\u003e chain)) 這裡是把function包上datatype，這樣可以把遞迴藏起來，因為是datatype的關係，在使用時一定要先打開來，才可以做下一個動作。\nfun ints(n) = LINK(n+1, ints) fun skips(n) = LINK(n+2, skips) fun some_ints(n) = if is_mod_5_or_7(n+1) then LINK(n+1, some_ints) else some_ints(n+1) 上面是產生stream的起點，接著要get stream的值\nfun chain_item(n,Link(x,f)) = if eq_1(n) then x else chain_item(n-1,f(n)) 如果有個is_prime\nfun primes(n) = if is_prime(n+1) then LINK(n+1, primes) else primes(n+1) fib 是一定要的\nfun fibs(n)(m) = LINK(n+m, fibs(m)) (fibs : int -\u003e (int -\u003e chain)) fun fibs_1(m) = LINK(1 + m, fibs(m)) ( == fibs(1)) ch8: curried fun in_range_c(s,l)(x) = if less_then(s,x) then less_than(x,l) else false (in_range_c : (int * int) -\u003e (int -\u003e bool)) fun combine(Nil,Nil) = Nil | combine(Nil,Cons(a,x)) = Cons(a,x) | combine(Cons(a,x),Nil) = Cons(a,x) | combine(Cons(a,x)),Cons(b,y)) = Cons(a,combine(x,Cons(b,y)) fun combine(Nil,y) = y | combine(Cons(a,x)),y) = Cons(a,combine(x,y)) 第一種寫法把所有組合列出來 而第二種是只處理一個維度，剩下遞迴\n而curried後\nfun combine_c(Nil)(y) = y | combine_c(Cons(a,x))(y) = Cons(a,combine_c(x)(y)) 可以想像成\ncombine_c(Cons(1,Cons(2,Nil))) =\u003e \\y -\u003e Cons(1,combine_c(Cons(2,Nil))(y)) 所以curried的另一種寫法\nfun combine_s(Nil) = fn l2 =\u003e l2 | combine_s(Cons(a,x)) = fn l2 =\u003e Cons(a, combine_s(x)(l2)) ch9: exception datatype box = Bacon | lx of Int exception No_bacon of int fun where_is(Nil) = raise No_bacon(0) | where_is(Cons(a,x)) = if is_bacon(a) then 1 else 1+where_is(x) (* where_is(..) handle No_bacon(n) =\u003e n *) exception Out_of_range fun list_item(n,Nil) = raise Out_of_range | list_item(n,Cons(b,rest)) = if eq_int(n,1) then b else list_item(n-1,rest) fun find(n, boxes) = (check(n,boxes,list_item(n,boxes)) handle Out_of_range =\u003e find(n div 2, boxes)) and check(n,boxes,Bacon) = n | check(n,boxes,lx(i)) = find(i,boxes) fun path(n, boxes) = Cons(n,(check(n,boxes,list_item(n,boxes)) handle Out_of_range =\u003e path(n div 2, boxes))) and check(n,boxes,Bacon) = n | check(n,boxes,lx(i)) = path(i,boxes) 這裡的重點是 [X.. (A.. handle _ =\u003e B)]，當excepption發生時被接住時，此時會變成[X.. B]。\nch10: module system in ML (* interface *) signature N = sig type number exception Too_small val succ : number -\u003e number val pred : number -\u003e number val is_zero : number -\u003e bool end; (* class *) functor NumberAsNum() (* 傳入functor需要的參數(structure)與一些constraint(對內的type暴露) *) :\u003e (* implements *) N = struct (private and implement signatrue) datatype num = Zero | One_more_than of num type number = num exception Too_small fun succ(n) = One_more_than(n) fun pred(Zero) = raise Too_small | pred(One_more_than(n)) = n fun is_zero(Zero) = true | is_zero(foo) = false; end; (* object *) structure NumStruct = NumberAsNum(); 另一個plus\nsignature P = sig type number val plus : number*number -\u003e number end; functor PON(structure a_N : N) :\u003e P = struct type number = a_N.number fun plus(n,m) = if a_N.is_zero(n) then m else a_N.succ(plus(a_N.pred(n),m)) end; structure NumArith = PON(structure a_N = NumStruct); 哪兩個可以一起用嗎?\nNumArith.plus(Zero, One_more_than(Zero)); 我們不知道NumArith的number是什麼!!\n要處理這個問題有三個方法\n加入box與unbox的function signature N_C_R = sig type number exception Too_small val conceal : int -\u003e number val succ : number -\u003e number val pred : number -\u003e number val is_zero : number -\u003e bool val reveal : number -\u003e int end; (* NumStruct.reveal( NumArith.plus( NumStruct.conceal(1), NumStruct.conceal(2))); *) 用where把type暴露出來 functor PON(structure a_N : N) :\u003e P where type number = a_N.number = struct type number = a_N.number fun plus(n,m) = if a_N.is_zero(n) then m else a_N.succ(plus(a_N.pred(n),m)) end; functor NumberAsInt2() :\u003e N where type number = int (* 這邊的int是refer到外面的env，不會碰到struct .. end 中的東西，*) = struct type number = int exception Too_small fun succ(n) = n + 1 fun pred(n) = if n=0 then raise Too_small else n-1 fun is_zero(n) = n=0 end; sharing type標出兩個type要一樣 signature J = sig val new_plus : int*int -\u003e int end; functor NP(structure a_N : N_C_R structure a_P : P sharing type a_N.number = a_P.number) :\u003e J = struct fun new_plus(x,y) = a_N.reveal( a_P.plus( a_N.conceal(x), a_N.conceal(y))) end; structure NPStruct = NP(structure a_N = NumberAsNum() structure a_P = PON(structure a_N = a_N)); 小總結 functor \u003c\u003e(args with some relations(A.b is equal to B.c, 這也是為什麼fuctor的參數要named的理由)) :\u003e \u003c\u003e = struct code end; Y in ML Y的重點是有一個(g g)這是無限遞迴的，所以要中斷他。 在第七章的stream(chain)中就利用datatype來打斷無限遞迴，所以這裡也要用相同的技巧。 與chain不同的是，我們的函數的參數是自己，所以不用像chain要多一格來存apply到函數的參數。 所以只要存自己就夠了\ndatatype 'a T = INTO of 'a T -\u003e 'a fun Y(f)= H(f)(INTO(H(f))) and H(f)(a) = f(G(a)) and G(INTO(a))(x) = a(INTO(a))(x); fun mk_fact(fact)(n) = if n=0 then 1 else n*fact(n-1); ","wordCount":"1198","inLanguage":"en","image":"https://littlebees.github.io/images/papermod-cover.png","datePublished":"2020-05-24T23:07:10Z","dateModified":"2020-05-24T23:07:10Z","author":{"@type":"Person","name":"zhengcf"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://littlebees.github.io/2020/05/the-little-mler-%E7%AD%86%E8%A8%98/"},"publisher":{"@type":"Organization","name":"記事本","logo":{"@type":"ImageObject","url":"https://littlebees.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://littlebees.github.io/ accesskey=h title="記事本 (Alt + H)">記事本</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://littlebees.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://littlebees.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://littlebees.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://littlebees.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://littlebees.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">The Little MLer 筆記</h1><div class=post-meta><span title='2020-05-24 23:07:10 +0000 UTC'>May 24, 2020</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;zhengcf</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#ch0-%e5%9f%b7%e8%a1%8c%e7%92%b0%e5%a2%83 aria-label="ch0: 執行環境">ch0: 執行環境</a></li><li><a href=#ch1-%e5%ae%9a%e7%be%a9type aria-label="ch1: 定義type">ch1: 定義type</a></li><li><a href=#ch2-%e5%af%abfunction aria-label="ch2: 寫function">ch2: 寫function</a></li><li><a href=#ch3-%e5%9c%a8list%e4%b8%8a%e9%81%9e%e8%bf%b4 aria-label="ch3: 在list上遞迴">ch3: 在list上遞迴</a></li><li><a href=#ch4-tuple--%e5%a4%9a%e5%8f%83%e6%95%b8function aria-label="ch4: tuple & 多參數function">ch4: tuple & 多參數function</a></li><li><a href=#ch5-type%e7%9a%84%e5%8f%83%e6%95%b8%e5%8f%af%e4%bb%a5%e4%b8%8d%e5%8f%aa%e4%b8%80%e5%80%8b aria-label="ch5: type的參數可以不只一個">ch5: type的參數可以不只一個</a><ul><li><a href=#type%e7%9a%84%e5%8f%83%e6%95%b8%e5%8f%af%e4%bb%a5%e4%b8%8d%e5%8f%aa%e4%b8%80%e5%80%8b aria-label=type的參數可以不只一個>type的參數可以不只一個</a></li><li><a href=#%e6%8a%bd%e8%b1%a1%e8%88%87%e7%b5%84%e5%90%88%e6%95%b8 aria-label=抽象與組合數>抽象與組合數</a></li></ul></li><li><a href=#ch6-%e6%a8%b9%e5%bd%a2%e9%81%9e%e8%bf%b4 aria-label="ch6: 樹形遞迴">ch6: 樹形遞迴</a><ul><li><a href=#sexp--slist aria-label="sexp & slist">sexp & slist</a></li></ul></li><li><a href=#ch7-first-order-function--stream aria-label="ch7: first-order function & stream">ch7: first-order function & stream</a><ul><li><a href=#first-order-function--type-inference aria-label="first-order function & type inference">first-order function & type inference</a></li><li><a href=#stream aria-label=stream>stream</a></li></ul></li><li><a href=#ch8-curried aria-label="ch8: curried">ch8: curried</a></li><li><a href=#ch9-exception aria-label="ch9: exception">ch9: exception</a></li><li><a href=#ch10-module-system-in-ml aria-label="ch10: module system in ML">ch10: module system in ML</a><ul><li><a href=#%e5%b0%8f%e7%b8%bd%e7%b5%90 aria-label=小總結>小總結</a></li></ul></li><li><a href=#y-in-ml aria-label="Y in ML">Y in ML</a></li></ul></div></details></div><div class=post-content><h2 id=ch0-執行環境>ch0: 執行環境<a hidden class=anchor aria-hidden=true href=#ch0-執行環境>#</a></h2><p>想用wsl來跑sml的話，poly/ml是不錯的選項</p><h2 id=ch1-定義type>ch1: 定義type<a hidden class=anchor aria-hidden=true href=#ch1-定義type>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>datatype</span> <span class=kt>num</span> <span class=p>=</span> <span class=nc>ZERO</span> <span class=p>|</span> <span class=nc>ONE_MORE</span> <span class=kr>of</span> <span class=n>num</span>
</span></span><span class=line><span class=cl><span class=kr>datatype</span> <span class=err>‘a</span> <span class=n>Slist</span> <span class=n>=</span> <span class=n>NIL</span> <span class=kr>of</span> <span class=err>‘a</span> <span class=n>|</span> <span class=n>SCONS</span> <span class=kr>of</span> <span class=err>‘a</span> <span class=n>Slist</span>
</span></span></code></pre></div><h2 id=ch2-寫function>ch2: 寫function<a hidden class=anchor aria-hidden=true href=#ch2-寫function>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>datatype</span> <span class=kt>Abc</span> <span class=p>=</span> <span class=nc>A</span> <span class=p>|</span> <span class=nc>B</span> <span class=kr>of</span> <span class=n>Abc</span> <span class=p>|</span> <span class=nc>C</span> <span class=kr>of</span> <span class=n>Abc</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>only_B</span><span class=p>(</span><span class=n>A</span><span class=p>)</span> <span class=n>=</span> <span class=n>true</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>only_B</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>only_B</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>only_B</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>false</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>only_B</span> <span class=n>:</span> <span class=n>Abc</span> <span class=n>-&gt;</span> <span class=n>bool</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>datatype</span> <span class=err>‘a</span> <span class=n>Xyz</span> <span class=n>=</span> <span class=n>X</span> <span class=kr>of</span> <span class=err>‘a</span> <span class=p>|</span> <span class=nf>Y</span> <span class=kr>of</span> <span class=err>‘a</span> <span class=n>Xyz</span> <span class=p>|</span> <span class=nf>Z</span> <span class=kr>of</span> <span class=err>‘a</span> <span class=n>Xyz</span>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>is_xy</span><span class=p>(</span><span class=n>X</span><span class=p>(</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>true</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>is_xy</span><span class=p>(</span><span class=n>Y</span><span class=p>(</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>is_xy</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>is_xy</span><span class=p>(</span><span class=n>Z</span><span class=p>(</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>false</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>is_xy</span> <span class=n>:</span> <span class=err>‘a</span> <span class=n>Xyz</span> <span class=n>-&gt;</span> <span class=n>bool</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=ch3-在list上遞迴>ch3: 在list上遞迴<a hidden class=anchor aria-hidden=true href=#ch3-在list上遞迴>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>rem_B</span><span class=p>(</span><span class=n>A</span><span class=p>)</span> <span class=n>=</span> <span class=n>A</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>rem_B</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>rem_B</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>rem_B</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>C</span><span class=p>(</span><span class=n>rem_B</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>C_in_fron_of_B</span><span class=p>(</span><span class=n>A</span><span class=p>)</span> <span class=n>=</span> <span class=n>A</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>C_in_fron_of_B</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>C</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>C_in_fron_of_B</span><span class=p>(</span><span class=n>x</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>C_in_fron_of_B</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>C</span><span class=p>(</span><span class=n>C_in_fron_of_B</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>subst_B_C</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=n>=</span> <span class=n>rem_B</span><span class=p>(</span><span class=n>C_in_fron_of_B</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=cm>(* OR *)</span>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>subst_B_C</span><span class=p>(</span><span class=n>A</span><span class=p>)</span> <span class=n>=</span> <span class=n>A</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>subst_B_C</span><span class=p>(</span><span class=n>B</span><span class=p>(</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>C</span><span class=p>(</span><span class=n>subst_B_C</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>subst_B_C</span><span class=p>(</span><span class=n>C</span><span class=p>(</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>C</span><span class=p>(</span><span class=n>subst_B_C</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=cm>(* 都是走訪同一list故可以用同一種走訪，把兩個式子結合起來(map fusion) *)</span>
</span></span></code></pre></div><h2 id=ch4-tuple--多參數function>ch4: tuple & 多參數function<a hidden class=anchor aria-hidden=true href=#ch4-tuple--多參數function>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=p>(</span><span class=n>A</span><span class=p>,</span><span class=n>X</span><span class=p>,</span><span class=n>A</span><span class=p>)</span> <span class=n>::</span> <span class=p>(</span><span class=n>Abc</span> <span class=n>*</span> <span class=n>Xyz</span> <span class=n>*</span> <span class=n>Abc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>datatype</span> <span class=kt>Abc</span> <span class=p>=</span> <span class=nc>A</span> <span class=p>|</span> <span class=nc>B</span> <span class=p>|</span> <span class=nc>C</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>add_a</span><span class=p>(</span><span class=n>A</span><span class=p>)</span> <span class=n>=</span> <span class=p>(</span><span class=n>A</span><span class=p>,</span><span class=n>A</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>add_a</span><span class=p>(</span><span class=n>B</span><span class=p>)</span> <span class=n>=</span> <span class=p>(</span><span class=n>B</span><span class=p>,</span><span class=n>A</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>add_a</span> <span class=n>=</span> <span class=p>(</span><span class=n>C</span><span class=p>,</span><span class=n>A</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>add_a</span> <span class=n>:</span> <span class=n>Abc</span> <span class=n>-&gt;</span> <span class=p>(</span><span class=n>Abc</span> <span class=n>*</span> <span class=n>Abc</span><span class=p>))</span>
</span></span></code></pre></div><p>可以利用type variable來打少一點字</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>add_a</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=n>=</span> <span class=p>(</span><span class=n>x</span> <span class=n>*</span> <span class=n>A</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>add_a</span> <span class=n>:</span> <span class=err>‘a</span> <span class=n>-&gt;</span> <span class=p>(</span><span class=err>‘a</span> <span class=n>*</span> <span class=n>Abc</span><span class=p>))</span>
</span></span></code></pre></div><p>這個比較抽象，但是比較詳細的(照著datatype產生的fun)可以找出更多可能的錯誤</p><pre tabindex=0><code>fun has_a(a:Xyz, A, b:Xyz) = true
    | has_a(a:Xyz, b, b:Xyz)) = false
(has_a : (Xyz * Abc * Xyz) -&gt; bool)
</code></pre><h2 id=ch5-type的參數可以不只一個>ch5: type的參數可以不只一個<a hidden class=anchor aria-hidden=true href=#ch5-type的參數可以不只一個>#</a></h2><h3 id=type的參數可以不只一個>type的參數可以不只一個<a hidden class=anchor aria-hidden=true href=#type的參數可以不只一個>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>datatype</span> <span class=err>‘a</span> <span class=n>De</span> <span class=n>=</span> <span class=n>D</span> <span class=n>|</span> <span class=n>E</span> <span class=kr>of</span> <span class=p>(</span><span class=err>‘a</span> <span class=n>*</span> <span class=p>(</span><span class=err>‘a</span> <span class=n>De</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>datatype</span> <span class=kt>Abc</span> <span class=p>=</span> <span class=nc>A</span> <span class=p>|</span> <span class=nc>B</span> <span class=p>|</span> <span class=nc>C</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>rem_a</span><span class=p>(</span><span class=n>D</span><span class=p>)</span> <span class=n>=</span> <span class=n>D</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>rem_a</span><span class=p>(</span><span class=n>E</span><span class=p>(</span><span class=n>A</span><span class=p>,</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>rem_a</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>rem_a</span><span class=p>(</span><span class=n>E</span><span class=p>(</span><span class=n>B</span><span class=p>,</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>E</span><span class=p>(</span><span class=n>B</span><span class=p>,</span><span class=n>rem_a</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>rem_a</span><span class=p>(</span><span class=n>E</span><span class=p>(</span><span class=n>C</span><span class=p>,</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>E</span><span class=p>(</span><span class=n>C</span><span class=p>,</span><span class=n>rem_a</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>(* shorter version *)</span>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>rem_a</span><span class=p>(</span><span class=n>D</span><span class=p>)</span> <span class=n>=</span> <span class=n>D</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>rem_a</span><span class=p>(</span><span class=n>E</span><span class=p>(</span><span class=n>A</span><span class=p>,</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>rem_a</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>rem_a</span><span class=p>(</span><span class=n>E</span><span class=p>(</span><span class=n>y</span><span class=p>,</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>E</span><span class=p>(</span><span class=n>y</span><span class=p>,</span><span class=n>rem_a</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=抽象與組合數>抽象與組合數<a hidden class=anchor aria-hidden=true href=#抽象與組合數>#</a></h3><p>輸入的維度上升，pattern的數量(組合數)上升</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>rem</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>D</span><span class=p>)</span> <span class=n>=</span> <span class=n>D</span>
</span></span><span class=line><span class=cl>     <span class=p>|</span> <span class=nf>rem</span><span class=p>(</span><span class=n>A</span><span class=p>,</span><span class=n>E</span><span class=p>(</span><span class=n>A</span><span class=p>,</span><span class=n>y</span><span class=p>))</span> <span class=n>=</span> <span class=n>rem</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=p>|</span> <span class=nf>rem</span><span class=p>(</span><span class=n>A</span><span class=p>,</span><span class=n>E</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>))</span> <span class=n>=</span> <span class=n>E</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>rem</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=n>y</span><span class=p>))</span>
</span></span><span class=line><span class=cl>     <span class=p>|</span> <span class=nf>rem</span><span class=p>(</span><span class=n>B</span><span class=p>,</span><span class=n>E</span><span class=p>(</span><span class=n>A</span><span class=p>,</span><span class=n>y</span><span class=p>))</span> <span class=n>=</span> <span class=n>rem</span><span class=p>(</span><span class=n>B</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=p>|</span> <span class=nf>rem</span><span class=p>(</span><span class=n>B</span><span class=p>,</span><span class=n>E</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>))</span> <span class=n>=</span> <span class=n>E</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>rem</span><span class=p>(</span><span class=n>B</span><span class=p>,</span> <span class=n>y</span><span class=p>))</span>
</span></span><span class=line><span class=cl>     <span class=p>|</span> <span class=nf>rem</span><span class=p>(</span><span class=n>C</span><span class=p>,</span><span class=n>E</span><span class=p>(</span><span class=n>C</span><span class=p>,</span><span class=n>y</span><span class=p>))</span> <span class=n>=</span> <span class=n>rem</span><span class=p>(</span><span class=n>C</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=p>|</span> <span class=nf>rem</span><span class=p>(</span><span class=n>C</span><span class=p>,</span><span class=n>E</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>))</span> <span class=n>=</span> <span class=n>E</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>rem</span><span class=p>(</span><span class=n>C</span><span class=p>,</span> <span class=n>y</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>rem</span> <span class=n>:</span> <span class=p>(</span><span class=n>Abc</span> <span class=n>*</span> <span class=n>Abc</span> <span class=n>De</span><span class=p>)</span> <span class=n>-&gt;</span> <span class=n>Abc</span> <span class=n>De</span><span class=p>)</span>
</span></span></code></pre></div><p>把其中一個維度抽出來，像</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>eq_Abc</span><span class=p>(</span><span class=n>A</span><span class=p>,</span><span class=n>A</span><span class=p>)</span> <span class=n>=</span> <span class=n>true</span>
</span></span><span class=line><span class=cl>     <span class=p>|</span> <span class=nf>eq_Abc</span><span class=p>(</span><span class=n>B</span><span class=p>,</span><span class=n>B</span><span class=p>)</span> <span class=n>=</span> <span class=n>true</span>
</span></span><span class=line><span class=cl>     <span class=p>|</span> <span class=nf>eq_Abc</span><span class=p>(</span><span class=n>C</span><span class=p>,</span><span class=n>C</span><span class=p>)</span> <span class=n>=</span> <span class=n>true</span>
</span></span><span class=line><span class=cl>     <span class=p>|</span> <span class=nf>eq_Abc</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>)</span> <span class=n>=</span> <span class=n>false</span>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>rem</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>D</span><span class=p>)</span>         <span class=n>=</span> <span class=n>D</span>
</span></span><span class=line><span class=cl>     <span class=p>|</span> <span class=nf>rem</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>E</span><span class=p>(</span><span class=n>y</span><span class=p>,</span><span class=n>z</span><span class=p>))</span> <span class=n>=</span> <span class=kr>if</span> <span class=n>eq_Abc</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                       <span class=kr>then</span> <span class=n>rem</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>z</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                       <span class=kr>else</span> <span class=n>E</span><span class=p>(</span><span class=n>y</span><span class=p>,</span><span class=n>rem</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>z</span><span class=p>))</span>
</span></span></code></pre></div><h2 id=ch6-樹形遞迴>ch6: 樹形遞迴<a hidden class=anchor aria-hidden=true href=#ch6-樹形遞迴>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>datatype</span> <span class=kt>tree</span> <span class=p>=</span> <span class=nc>E</span> <span class=p>|</span> <span class=nc>L</span> <span class=kr>of</span> <span class=n>Abc</span> <span class=n>*</span> <span class=n>tree</span> <span class=p>|</span> <span class=nc>S</span> <span class=kr>of</span> <span class=n>tree</span> <span class=n>*</span> <span class=n>tree</span>
</span></span><span class=line><span class=cl><span class=kr>datatype</span> <span class=err>‘a</span> <span class=n>tree</span> <span class=n>=</span> <span class=n>E</span> <span class=n>|</span> <span class=n>F</span> <span class=kr>of</span> <span class=err>‘a</span> <span class=n>*</span> <span class=err>‘a</span> <span class=n>tree</span> <span class=n>|</span> <span class=n>S</span> <span class=kr>of</span> <span class=err>‘a</span> <span class=n>tree</span> <span class=n>*</span> <span class=err>‘a</span> <span class=n>tree</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>occur_Abc</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>E</span><span class=p>)</span> <span class=n>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>occur_Abc</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>L</span><span class=p>(</span><span class=n>b</span><span class=p>,</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=kr>if</span> <span class=n>eq_Abc</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>)</span> <span class=kr>then</span> <span class=mi>1</span><span class=n>+occur_Abc</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>)</span> <span class=kr>else</span> <span class=n>occur_Abc</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>occur_Abc</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>S</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>))</span> <span class=n>=</span> <span class=n>occur_Abc</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>)</span> <span class=n>+</span> <span class=n>occur_Abc</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>y</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=sexp--slist>sexp & slist<a hidden class=anchor aria-hidden=true href=#sexp--slist>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>datatype</span> <span class=err>‘a</span> <span class=n>SList</span> <span class=n>=</span> <span class=n>NIL</span> <span class=n>|</span> <span class=n>SCONS</span> <span class=kr>of</span> <span class=err>‘a</span> <span class=n>Sexp</span> <span class=n>*</span> <span class=err>‘a</span> <span class=n>SList</span>
</span></span><span class=line><span class=cl><span class=kr>and</span>
</span></span><span class=line><span class=cl>	       <span class=err>‘a</span> <span class=n>Sexp</span> <span class=n>=</span> <span class=n>ATOM</span> <span class=kr>of</span> <span class=err>‘a</span> <span class=n>|</span> <span class=n>SLIST</span> <span class=kr>of</span> <span class=err>‘a</span> <span class=n>SList</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>occur_Abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>Nil</span><span class=p>)</span> <span class=n>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>occur_Abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>SCons</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>))</span> <span class=n>=</span> <span class=n>occur_abc_SE</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>)</span> <span class=n>+</span> <span class=n>occur_abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>and</span>
</span></span><span class=line><span class=cl><span class=nf>fun</span> <span class=n>occur_Abc_SE</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>Atom</span><span class=p>(</span><span class=n>b</span><span class=p>))</span> <span class=n>=</span> <span class=kr>if</span> <span class=n>eq_Abc</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>)</span> <span class=kr>then</span> <span class=mi>1</span> <span class=kr>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>occur_Abc_SE</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>Slist</span><span class=p>(</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>occur_Abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>)</span>
</span></span></code></pre></div><p>先展開<code>occur_Abc_SE</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>occur_Abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>Nil</span><span class=p>)</span> <span class=n>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>occur_Abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>SCons</span><span class=p>(</span><span class=n>Atom</span><span class=p>(</span><span class=n>x</span><span class=p>),</span><span class=n>y</span><span class=p>))</span> <span class=n>=</span> <span class=kr>if</span> <span class=n>eq_Abc</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>)</span> <span class=kr>then</span> <span class=mi>1</span> <span class=n>+</span> <span class=n>occur_abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>y</span><span class=p>)</span> <span class=kr>else</span> <span class=mi>0</span> <span class=n>+</span> <span class=n>occur_abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>occur_Abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>SCons</span><span class=p>(</span><span class=n>Slist</span><span class=p>(</span><span class=n>x</span><span class=p>),</span><span class=n>y</span><span class=p>))</span> <span class=n>=</span> <span class=n>occur_abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>)</span> <span class=n>+</span> <span class=n>occur_abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>y</span><span class=p>)</span>
</span></span></code></pre></div><p>其實<code>SCons</code>的部分都長的很像，做 抽象與合併 !!</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>eq_Abc_atom</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>Atom</span><span class=p>(</span><span class=n>b</span><span class=p>))</span> <span class=n>=</span> <span class=n>eq_Abc</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>eq_Abc_atom</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>Slist</span><span class=p>(</span><span class=n>b</span><span class=p>))</span> <span class=n>=</span> <span class=n>false</span>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>occur_Abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>Nil</span><span class=p>)</span> <span class=n>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>occur_Abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>SCons</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>))</span> <span class=n>=</span> <span class=kr>if</span> <span class=n>eq_Abc_atom</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>)</span> <span class=kr>then</span> <span class=mi>1</span><span class=n>+occur_abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>y</span><span class=p>)</span> <span class=kr>else</span> <span class=n>occur_Abc_SE</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>)</span> <span class=n>+</span> <span class=n>occur_abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>y</span><span class=p>)</span> 
</span></span><span class=line><span class=cl>    <span class=kr>and</span>
</span></span><span class=line><span class=cl><span class=nf>fun</span> <span class=n>occur_Abc_SE</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>Atom</span><span class=p>(</span><span class=n>b</span><span class=p>))</span> <span class=n>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>occur_Abc_SE</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>Slist</span><span class=p>(</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>occur_Abc_SL</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=ch7-first-order-function--stream>ch7: first-order function & stream<a hidden class=anchor aria-hidden=true href=#ch7-first-order-function--stream>#</a></h2><h3 id=first-order-function--type-inference>first-order function & type inference<a hidden class=anchor aria-hidden=true href=#first-order-function--type-inference>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>true_mk</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=n>=</span> <span class=n>true</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>true_mk</span> <span class=n>:</span> <span class=err>‘a</span> <span class=n>-&gt;</span> <span class=n>bool</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>datatype</span> <span class=kt>B_or_I</span> <span class=p>=</span> <span class=nc>HOT</span> <span class=kr>of</span> <span class=n>bool</span> <span class=p>|</span> <span class=nc>COLD</span> <span class=kr>of</span> <span class=n>int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>help</span><span class=p>(</span><span class=n>f</span><span class=p>)</span>
</span></span><span class=line><span class=cl>     <span class=n>=</span> <span class=n>Hot</span><span class=p>(</span><span class=n>true_mk</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=kr>if</span> <span class=n>true_mk</span><span class=p>(__)</span>
</span></span><span class=line><span class=cl>	<span class=kr>then</span> <span class=n>f</span>
</span></span><span class=line><span class=cl>	<span class=kr>else</span> <span class=n>true_mk</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>help</span> <span class=n>:</span> <span class=n>?</span> <span class=n>-&gt;</span> <span class=n>B_or_I</span><span class=p>)</span>
</span></span></code></pre></div><p>f的type是什麼?
then part與else part的type要一樣，故f的type是’a -> bool</p><h3 id=stream>stream<a hidden class=anchor aria-hidden=true href=#stream>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>datatype</span> <span class=kt>chain</span> <span class=p>=</span> <span class=nc>LINK</span> <span class=kr>of</span> <span class=p>(</span><span class=n>int</span> <span class=n>*</span> <span class=p>(</span><span class=n>int</span> <span class=n>-&gt;</span> <span class=n>chain</span><span class=p>))</span>
</span></span></code></pre></div><p>這裡是把function包上datatype，這樣可以把遞迴藏起來，因為是datatype的關係，在使用時一定要先打開來，才可以做下一個動作。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>ints</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=n>=</span> <span class=n>LINK</span><span class=p>(</span><span class=n>n+</span><span class=mi>1</span><span class=p>,</span> <span class=n>ints</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>skips</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=n>=</span> <span class=n>LINK</span><span class=p>(</span><span class=n>n+</span><span class=mi>2</span><span class=p>,</span> <span class=n>skips</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>some_ints</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=n>=</span> <span class=kr>if</span> <span class=n>is_mod_5_or_7</span><span class=p>(</span><span class=n>n+</span><span class=mi>1</span><span class=p>)</span> <span class=kr>then</span> <span class=n>LINK</span><span class=p>(</span><span class=n>n+</span><span class=mi>1</span><span class=p>,</span> <span class=n>some_ints</span><span class=p>)</span> <span class=kr>else</span> <span class=n>some_ints</span><span class=p>(</span><span class=n>n+</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></div><p>上面是產生stream的起點，接著要get stream的值</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>chain_item</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>Link</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>f</span><span class=p>))</span> <span class=n>=</span> <span class=kr>if</span> <span class=n>eq_1</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=kr>then</span> <span class=n>x</span> <span class=kr>else</span> <span class=n>chain_item</span><span class=p>(</span><span class=n>n-</span><span class=mi>1</span><span class=p>,</span><span class=n>f</span><span class=p>(</span><span class=n>n</span><span class=p>))</span>
</span></span></code></pre></div><p>如果有個is_prime</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>primes</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=n>=</span> <span class=kr>if</span> <span class=n>is_prime</span><span class=p>(</span><span class=n>n+</span><span class=mi>1</span><span class=p>)</span> <span class=kr>then</span> <span class=n>LINK</span><span class=p>(</span><span class=n>n+</span><span class=mi>1</span><span class=p>,</span> <span class=n>primes</span><span class=p>)</span> <span class=kr>else</span> <span class=n>primes</span><span class=p>(</span><span class=n>n+</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></div><p>fib 是一定要的</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>fibs</span><span class=p>(</span><span class=n>n</span><span class=p>)(</span><span class=n>m</span><span class=p>)</span> <span class=n>=</span> <span class=n>LINK</span><span class=p>(</span><span class=n>n+m</span><span class=p>,</span> <span class=n>fibs</span><span class=p>(</span><span class=n>m</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>fibs</span> <span class=n>:</span> <span class=n>int</span> <span class=n>-&gt;</span> <span class=p>(</span><span class=n>int</span> <span class=n>-&gt;</span> <span class=n>chain</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>fibs_1</span><span class=p>(</span><span class=n>m</span><span class=p>)</span> <span class=n>=</span> <span class=n>LINK</span><span class=p>(</span><span class=mi>1</span> <span class=n>+</span> <span class=n>m</span><span class=p>,</span> <span class=n>fibs</span><span class=p>(</span><span class=n>m</span><span class=p>))</span> <span class=p>(</span> <span class=n>==</span> <span class=n>fibs</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span>
</span></span></code></pre></div><h2 id=ch8-curried>ch8: curried<a hidden class=anchor aria-hidden=true href=#ch8-curried>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>in_range_c</span><span class=p>(</span><span class=n>s</span><span class=p>,</span><span class=n>l</span><span class=p>)(</span><span class=n>x</span><span class=p>)</span> <span class=n>=</span> <span class=kr>if</span> <span class=n>less_then</span><span class=p>(</span><span class=n>s</span><span class=p>,</span><span class=n>x</span><span class=p>)</span> <span class=kr>then</span> <span class=n>less_than</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>l</span><span class=p>)</span> <span class=kr>else</span> <span class=n>false</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>in_range_c</span> <span class=n>:</span> <span class=p>(</span><span class=n>int</span> <span class=n>*</span> <span class=n>int</span><span class=p>)</span> <span class=n>-&gt;</span> <span class=p>(</span><span class=n>int</span> <span class=n>-&gt;</span> <span class=n>bool</span><span class=p>))</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>combine</span><span class=p>(</span><span class=n>Nil</span><span class=p>,</span><span class=n>Nil</span><span class=p>)</span> <span class=n>=</span> <span class=n>Nil</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>combine</span><span class=p>(</span><span class=n>Nil</span><span class=p>,</span><span class=n>Cons</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=n>Cons</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>combine</span><span class=p>(</span><span class=n>Cons</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>),</span><span class=n>Nil</span><span class=p>)</span> <span class=n>=</span> <span class=n>Cons</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>combine</span><span class=p>(</span><span class=n>Cons</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>)),</span><span class=n>Cons</span><span class=p>(</span><span class=n>b</span><span class=p>,</span><span class=n>y</span><span class=p>))</span> <span class=n>=</span> <span class=n>Cons</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>combine</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>Cons</span><span class=p>(</span><span class=n>b</span><span class=p>,</span><span class=n>y</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>combine</span><span class=p>(</span><span class=n>Nil</span><span class=p>,</span><span class=n>y</span><span class=p>)</span> <span class=n>=</span> <span class=n>y</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>combine</span><span class=p>(</span><span class=n>Cons</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>)),</span><span class=n>y</span><span class=p>)</span> <span class=n>=</span> <span class=n>Cons</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>combine</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>))</span>
</span></span></code></pre></div><p>第一種寫法把所有組合列出來
而第二種是只處理一個維度，剩下遞迴</p><p>而curried後</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>combine_c</span><span class=p>(</span><span class=n>Nil</span><span class=p>)(</span><span class=n>y</span><span class=p>)</span> <span class=n>=</span> <span class=n>y</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>combine_c</span><span class=p>(</span><span class=n>Cons</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>))(</span><span class=n>y</span><span class=p>)</span> <span class=n>=</span> <span class=n>Cons</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>combine_c</span><span class=p>(</span><span class=n>x</span><span class=p>)(</span><span class=n>y</span><span class=p>))</span>
</span></span></code></pre></div><p>可以想像成</p><pre tabindex=0><code>combine_c(Cons(1,Cons(2,Nil))) =&gt; \y -&gt; Cons(1,combine_c(Cons(2,Nil))(y))
</code></pre><p>所以curried的另一種寫法</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>combine_s</span><span class=p>(</span><span class=n>Nil</span><span class=p>)</span> <span class=n>=</span> <span class=kr>fn</span> <span class=n>l2</span> <span class=n>=&gt;</span> <span class=n>l2</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>combine_s</span><span class=p>(</span><span class=n>Cons</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=kr>fn</span> <span class=n>l2</span> <span class=n>=&gt;</span> <span class=n>Cons</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>combine_s</span><span class=p>(</span><span class=n>x</span><span class=p>)(</span><span class=n>l2</span><span class=p>))</span>
</span></span></code></pre></div><h2 id=ch9-exception>ch9: exception<a hidden class=anchor aria-hidden=true href=#ch9-exception>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>datatype</span> <span class=kt>box</span> <span class=p>=</span> <span class=nc>Bacon</span> <span class=p>|</span> <span class=nc>lx</span> <span class=kr>of</span> <span class=n>Int</span>
</span></span><span class=line><span class=cl><span class=kr>exception</span> <span class=nc>No_bacon</span> <span class=kr>of</span> <span class=n>int</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>where_is</span><span class=p>(</span><span class=n>Nil</span><span class=p>)</span> <span class=n>=</span> <span class=kr>raise</span> <span class=n>No_bacon</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>where_is</span><span class=p>(</span><span class=n>Cons</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>x</span><span class=p>))</span> <span class=n>=</span> <span class=kr>if</span> <span class=n>is_bacon</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=kr>then</span> <span class=mi>1</span> <span class=kr>else</span> <span class=mi>1</span><span class=n>+where_is</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>(* where_is(..) handle No_bacon(n) =&gt; n *)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>exception</span> <span class=nc>Out_of_range</span>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>list_item</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>Nil</span><span class=p>)</span> <span class=n>=</span> <span class=kr>raise</span> <span class=n>Out_of_range</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>list_item</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>Cons</span><span class=p>(</span><span class=n>b</span><span class=p>,</span><span class=n>rest</span><span class=p>))</span> <span class=n>=</span> <span class=kr>if</span> <span class=n>eq_int</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=mi>1</span><span class=p>)</span> <span class=kr>then</span> <span class=n>b</span> <span class=kr>else</span> <span class=n>list_item</span><span class=p>(</span><span class=n>n-</span><span class=mi>1</span><span class=p>,</span><span class=n>rest</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>find</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>boxes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>=</span> <span class=p>(</span><span class=n>check</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>boxes</span><span class=p>,</span><span class=n>list_item</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>boxes</span><span class=p>))</span> <span class=kr>handle</span> <span class=n>Out_of_range</span> <span class=n>=&gt;</span> <span class=n>find</span><span class=p>(</span><span class=n>n</span> <span class=n>div</span> <span class=mi>2</span><span class=p>,</span> <span class=n>boxes</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=kr>and</span>
</span></span><span class=line><span class=cl>      <span class=nf>check</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>boxes</span><span class=p>,</span><span class=n>Bacon</span><span class=p>)</span> <span class=n>=</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>check</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>boxes</span><span class=p>,</span><span class=n>lx</span><span class=p>(</span><span class=n>i</span><span class=p>))</span> <span class=n>=</span> <span class=n>find</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>boxes</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>path</span><span class=p>(</span><span class=n>n</span><span class=p>,</span> <span class=n>boxes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>=</span> <span class=n>Cons</span><span class=p>(</span><span class=n>n</span><span class=p>,(</span><span class=n>check</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>boxes</span><span class=p>,</span><span class=n>list_item</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>boxes</span><span class=p>))</span> <span class=kr>handle</span> <span class=n>Out_of_range</span> <span class=n>=&gt;</span> <span class=n>path</span><span class=p>(</span><span class=n>n</span> <span class=n>div</span> <span class=mi>2</span><span class=p>,</span> <span class=n>boxes</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=kr>and</span>
</span></span><span class=line><span class=cl>      <span class=nf>check</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>boxes</span><span class=p>,</span><span class=n>Bacon</span><span class=p>)</span> <span class=n>=</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>    <span class=p>|</span> <span class=nf>check</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>boxes</span><span class=p>,</span><span class=n>lx</span><span class=p>(</span><span class=n>i</span><span class=p>))</span> <span class=n>=</span> <span class=n>path</span><span class=p>(</span><span class=n>i</span><span class=p>,</span><span class=n>boxes</span><span class=p>)</span>
</span></span></code></pre></div><p>這裡的重點是 [X.. (A.. handle _ => B)]，當excepption發生時被接住時，此時會變成[X.. B]。</p><h2 id=ch10-module-system-in-ml>ch10: module system in ML<a hidden class=anchor aria-hidden=true href=#ch10-module-system-in-ml>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=cm>(* interface *)</span>
</span></span><span class=line><span class=cl><span class=kr>signature</span> <span class=nn>N</span> <span class=n>=</span> 
</span></span><span class=line><span class=cl><span class=kr>sig</span>
</span></span><span class=line><span class=cl>    <span class=kr>type</span> <span class=kt>number</span>
</span></span><span class=line><span class=cl>    <span class=kr>exception</span> <span class=nc>Too_small</span>
</span></span><span class=line><span class=cl>    <span class=kr>val</span> <span class=nv>succ</span> <span class=n>:</span> <span class=n>number</span> <span class=n>-&gt;</span> <span class=n>number</span>
</span></span><span class=line><span class=cl>    <span class=kr>val</span> <span class=nv>pred</span> <span class=n>:</span> <span class=n>number</span> <span class=n>-&gt;</span> <span class=n>number</span>
</span></span><span class=line><span class=cl>    <span class=kr>val</span> <span class=nv>is_zero</span> <span class=n>:</span> <span class=n>number</span> <span class=n>-&gt;</span> <span class=n>bool</span>
</span></span><span class=line><span class=cl><span class=kr>end</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>(* class *)</span>
</span></span><span class=line><span class=cl><span class=kr>functor</span> <span class=nn>NumberAsNum</span><span class=p>()</span> <span class=cm>(* 傳入functor需要的參數(structure)與一些constraint(對內的type暴露) *)</span>
</span></span><span class=line><span class=cl>    <span class=n>:&gt;</span> <span class=cm>(* implements *)</span>
</span></span><span class=line><span class=cl>    <span class=n>N</span>
</span></span><span class=line><span class=cl><span class=n>=</span>
</span></span><span class=line><span class=cl>    <span class=kr>struct</span> <span class=p>(</span><span class=n>private</span> <span class=kr>and</span> <span class=nv>implement</span> <span class=n>signatrue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>datatype</span> <span class=kt>num</span> <span class=p>=</span> <span class=nc>Zero</span> <span class=p>|</span> <span class=nc>One_more_than</span> <span class=kr>of</span> <span class=n>num</span>
</span></span><span class=line><span class=cl>    <span class=kr>type</span> <span class=kt>number</span> <span class=p>=</span> <span class=n>num</span>
</span></span><span class=line><span class=cl>    <span class=kr>exception</span> <span class=nc>Too_small</span>
</span></span><span class=line><span class=cl>    <span class=kr>fun</span> <span class=nf>succ</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=n>=</span> <span class=n>One_more_than</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>fun</span> <span class=nf>pred</span><span class=p>(</span><span class=n>Zero</span><span class=p>)</span> <span class=n>=</span> <span class=kr>raise</span> <span class=n>Too_small</span> <span class=p>|</span> <span class=nf>pred</span><span class=p>(</span><span class=n>One_more_than</span><span class=p>(</span><span class=n>n</span><span class=p>))</span> <span class=n>=</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>    <span class=kr>fun</span> <span class=nf>is_zero</span><span class=p>(</span><span class=n>Zero</span><span class=p>)</span> <span class=n>=</span> <span class=n>true</span> <span class=p>|</span> <span class=nf>is_zero</span><span class=p>(</span><span class=n>foo</span><span class=p>)</span> <span class=n>=</span> <span class=n>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl> <span class=kr>end</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>(* object *)</span>
</span></span><span class=line><span class=cl><span class=kr>structure</span> <span class=nn>NumStruct</span> <span class=n>=</span> <span class=n>NumberAsNum</span><span class=p>();</span>
</span></span></code></pre></div><p>另一個plus</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>signature</span> <span class=nn>P</span> <span class=n>=</span>
</span></span><span class=line><span class=cl><span class=kr>sig</span>
</span></span><span class=line><span class=cl>    <span class=kr>type</span> <span class=kt>number</span>
</span></span><span class=line><span class=cl>    <span class=kr>val</span> <span class=nv>plus</span> <span class=n>:</span> <span class=n>number*number</span> <span class=n>-&gt;</span> <span class=n>number</span>
</span></span><span class=line><span class=cl><span class=kr>end</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>functor</span> <span class=nn>PON</span><span class=p>(</span><span class=kr>structure</span> <span class=nn>a_N</span> <span class=n>:</span> <span class=n>N</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>:&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>P</span>
</span></span><span class=line><span class=cl><span class=n>=</span>
</span></span><span class=line><span class=cl><span class=kr>struct</span>
</span></span><span class=line><span class=cl>    <span class=kr>type</span> <span class=kt>number</span> <span class=p>=</span> <span class=nn>a_N.</span><span class=n>number</span>
</span></span><span class=line><span class=cl>    <span class=kr>fun</span> <span class=nf>plus</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>)</span> <span class=n>=</span> <span class=kr>if</span> <span class=nn>a_N.</span><span class=n>is_zero</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=kr>then</span> <span class=n>m</span> <span class=kr>else</span> <span class=nn>a_N.</span><span class=n>succ</span><span class=p>(</span><span class=n>plus</span><span class=p>(</span><span class=nn>a_N.</span><span class=n>pred</span><span class=p>(</span><span class=n>n</span><span class=p>),</span><span class=n>m</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=kr>end</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>structure</span> <span class=nn>NumArith</span> <span class=n>=</span> <span class=n>PON</span><span class=p>(</span><span class=kr>structure</span> <span class=nn>a_N</span> <span class=n>=</span> <span class=n>NumStruct</span><span class=p>);</span>
</span></span></code></pre></div><p>哪兩個可以一起用嗎?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=nn>NumArith.</span><span class=n>plus</span><span class=p>(</span><span class=n>Zero</span><span class=p>,</span> <span class=n>One_more_than</span><span class=p>(</span><span class=n>Zero</span><span class=p>));</span>
</span></span></code></pre></div><p>我們不知道NumArith的number是什麼!!</p><p>要處理這個問題有三個方法</p><ol><li>加入box與unbox的function</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>signature</span> <span class=nn>N_C_R</span> <span class=n>=</span>
</span></span><span class=line><span class=cl><span class=kr>sig</span>
</span></span><span class=line><span class=cl>    <span class=kr>type</span> <span class=kt>number</span>
</span></span><span class=line><span class=cl>    <span class=kr>exception</span> <span class=nc>Too_small</span>
</span></span><span class=line><span class=cl>    <span class=kr>val</span> <span class=nv>conceal</span> <span class=n>:</span> <span class=n>int</span> <span class=n>-&gt;</span> <span class=n>number</span>
</span></span><span class=line><span class=cl>    <span class=kr>val</span> <span class=nv>succ</span> <span class=n>:</span> <span class=n>number</span> <span class=n>-&gt;</span> <span class=n>number</span>
</span></span><span class=line><span class=cl>    <span class=kr>val</span> <span class=nv>pred</span> <span class=n>:</span> <span class=n>number</span> <span class=n>-&gt;</span> <span class=n>number</span>
</span></span><span class=line><span class=cl>    <span class=kr>val</span> <span class=nv>is_zero</span> <span class=n>:</span> <span class=n>number</span> <span class=n>-&gt;</span> <span class=n>bool</span>
</span></span><span class=line><span class=cl>    <span class=kr>val</span> <span class=nv>reveal</span> <span class=n>:</span> <span class=n>number</span> <span class=n>-&gt;</span> <span class=n>int</span>
</span></span><span class=line><span class=cl><span class=kr>end</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>(* NumStruct.reveal( NumArith.plus( NumStruct.conceal(1), NumStruct.conceal(2))); *)</span>
</span></span></code></pre></div><ol start=2><li>用where把type暴露出來</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>functor</span> <span class=nn>PON</span><span class=p>(</span><span class=kr>structure</span> <span class=nn>a_N</span> <span class=n>:</span> <span class=n>N</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>:&gt;</span>
</span></span><span class=line><span class=cl><span class=n>P</span> <span class=kr>where</span> <span class=kr>type</span> <span class=kt>number</span> <span class=p>=</span> <span class=nn>a_N.</span><span class=n>number</span>
</span></span><span class=line><span class=cl><span class=n>=</span>
</span></span><span class=line><span class=cl><span class=kr>struct</span>
</span></span><span class=line><span class=cl>    <span class=kr>type</span> <span class=kt>number</span> <span class=p>=</span> <span class=nn>a_N.</span><span class=n>number</span>
</span></span><span class=line><span class=cl>    <span class=kr>fun</span> <span class=nf>plus</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=n>m</span><span class=p>)</span> <span class=n>=</span> <span class=kr>if</span> <span class=nn>a_N.</span><span class=n>is_zero</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=kr>then</span> <span class=n>m</span> <span class=kr>else</span> <span class=nn>a_N.</span><span class=n>succ</span><span class=p>(</span><span class=n>plus</span><span class=p>(</span><span class=nn>a_N.</span><span class=n>pred</span><span class=p>(</span><span class=n>n</span><span class=p>),</span><span class=n>m</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=kr>end</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>functor</span> <span class=nn>NumberAsInt2</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>:&gt;</span>
</span></span><span class=line><span class=cl><span class=n>N</span> <span class=kr>where</span> <span class=kr>type</span> <span class=kt>number</span> <span class=p>=</span> <span class=n>int</span> <span class=cm>(* 這邊的int是refer到外面的env，不會碰到struct .. end 中的東西，*)</span>
</span></span><span class=line><span class=cl><span class=n>=</span>
</span></span><span class=line><span class=cl><span class=kr>struct</span>
</span></span><span class=line><span class=cl>    <span class=kr>type</span> <span class=kt>number</span> <span class=p>=</span> <span class=n>int</span>
</span></span><span class=line><span class=cl>    <span class=kr>exception</span> <span class=nc>Too_small</span>
</span></span><span class=line><span class=cl>    <span class=kr>fun</span> <span class=nf>succ</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=n>=</span> <span class=n>n</span> <span class=n>+</span> <span class=mi>1</span> <span class=kr>fun</span> <span class=nf>pred</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=n>=</span> <span class=kr>if</span> <span class=n>n=</span><span class=mi>0</span> <span class=kr>then</span> <span class=kr>raise</span> <span class=n>Too_small</span> <span class=kr>else</span> <span class=n>n-</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=kr>fun</span> <span class=nf>is_zero</span><span class=p>(</span><span class=n>n</span><span class=p>)</span> <span class=n>=</span> <span class=n>n=</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=kr>end</span><span class=p>;</span>
</span></span></code></pre></div><ol start=3><li>sharing type標出兩個type要一樣</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>signature</span> <span class=nn>J</span> <span class=n>=</span>
</span></span><span class=line><span class=cl><span class=kr>sig</span>
</span></span><span class=line><span class=cl>    <span class=kr>val</span> <span class=nv>new_plus</span> <span class=n>:</span> <span class=n>int*int</span> <span class=n>-&gt;</span> <span class=n>int</span>
</span></span><span class=line><span class=cl><span class=kr>end</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>functor</span> <span class=nn>NP</span><span class=p>(</span><span class=kr>structure</span> <span class=nn>a_N</span> <span class=n>:</span> <span class=n>N_C_R</span>
</span></span><span class=line><span class=cl>           <span class=kr>structure</span> <span class=nn>a_P</span> <span class=n>:</span> <span class=n>P</span>
</span></span><span class=line><span class=cl>           <span class=kr>sharing</span> <span class=kr>type</span> <span class=kt>a_N</span><span class=err>.number</span> <span class=n>=</span> <span class=nn>a_P.</span><span class=n>number</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>:&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>J</span>
</span></span><span class=line><span class=cl><span class=n>=</span>
</span></span><span class=line><span class=cl><span class=kr>struct</span>
</span></span><span class=line><span class=cl>    <span class=kr>fun</span> <span class=nf>new_plus</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>)</span> <span class=n>=</span> <span class=nn>a_N.</span><span class=n>reveal</span><span class=p>(</span> <span class=nn>a_P.</span><span class=n>plus</span><span class=p>(</span> <span class=nn>a_N.</span><span class=n>conceal</span><span class=p>(</span><span class=n>x</span><span class=p>),</span> <span class=nn>a_N.</span><span class=n>conceal</span><span class=p>(</span><span class=n>y</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=kr>end</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>structure</span> <span class=nn>NPStruct</span> <span class=n>=</span> <span class=n>NP</span><span class=p>(</span><span class=kr>structure</span> <span class=nn>a_N</span> <span class=n>=</span> <span class=n>NumberAsNum</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>structure</span> <span class=nn>a_P</span> <span class=n>=</span> <span class=n>PON</span><span class=p>(</span><span class=kr>structure</span> <span class=nn>a_N</span> <span class=n>=</span> <span class=n>a_N</span><span class=p>));</span>
</span></span></code></pre></div><h3 id=小總結>小總結<a hidden class=anchor aria-hidden=true href=#小總結>#</a></h3><pre tabindex=0><code>functor &lt;&lt;name&gt;&gt;(args with some relations(A.b is equal to B.c, 這也是為什麼fuctor的參數要named的理由)) 
    :&gt;
    &lt;&lt;sig(return type) with some relations(this type is same as ...)&gt;&gt;
=
struct
    code
end;
</code></pre><h2 id=y-in-ml>Y in ML<a hidden class=anchor aria-hidden=true href=#y-in-ml>#</a></h2><p>Y的重點是有一個(g g)這是無限遞迴的，所以要中斷他。
在第七章的stream(chain)中就利用datatype來打斷無限遞迴，所以這裡也要用相同的技巧。
與chain不同的是，我們的函數的參數是自己，所以不用像chain要多一格來存apply到函數的參數。
所以只要存自己就夠了</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sml data-lang=sml><span class=line><span class=cl><span class=kr>datatype</span> <span class=nd>&#39;a</span> <span class=kt>T</span> <span class=p>=</span> <span class=nc>INTO</span> <span class=kr>of</span> <span class=nd>&#39;a</span> <span class=n>T</span> <span class=n>-&gt;</span> <span class=nd>&#39;a</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>Y</span><span class=p>(</span><span class=n>f</span><span class=p>)</span><span class=n>=</span> <span class=n>H</span><span class=p>(</span><span class=n>f</span><span class=p>)(</span><span class=n>INTO</span><span class=p>(</span><span class=n>H</span><span class=p>(</span><span class=n>f</span><span class=p>)))</span>
</span></span><span class=line><span class=cl><span class=kr>and</span> <span class=nf>H</span><span class=p>(</span><span class=n>f</span><span class=p>)(</span><span class=n>a</span><span class=p>)</span> <span class=n>=</span> <span class=n>f</span><span class=p>(</span><span class=n>G</span><span class=p>(</span><span class=n>a</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=kr>and</span> <span class=nf>G</span><span class=p>(</span><span class=n>INTO</span><span class=p>(</span><span class=n>a</span><span class=p>))(</span><span class=n>x</span><span class=p>)</span> <span class=n>=</span> <span class=n>a</span><span class=p>(</span><span class=n>INTO</span><span class=p>(</span><span class=n>a</span><span class=p>))(</span><span class=n>x</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>fun</span> <span class=nf>mk_fact</span><span class=p>(</span><span class=n>fact</span><span class=p>)(</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>=</span> <span class=kr>if</span> <span class=n>n=</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=kr>then</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=kr>else</span> <span class=n>n*fact</span><span class=p>(</span><span class=n>n-</span><span class=mi>1</span><span class=p>);</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://littlebees.github.io/2020/06/%E8%A8%AD%E5%AE%9Avscode%E7%9A%84c-format/><span class=title>« Prev</span><br><span>設定vscode的c++ format</span>
</a><a class=next href=https://littlebees.github.io/2020/05/little-typer-%E5%BE%8C%E7%AF%878~16-%E6%95%B4%E7%90%86%E8%88%87%E7%AD%86%E8%A8%98/><span class=title>Next »</span><br><span>little typer 後篇(8~16) 整理與筆記</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://littlebees.github.io/>記事本</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>